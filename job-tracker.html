<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JobTracker - Job Application Tracker & Interview Prep | Elevify</title>
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Antic+Slab&family=Quicksand:wght@300..700&family=Sora:wght@100..800&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Your custom CSS file -->
    <link rel="stylesheet" href="/styles.css">
    <style>
        .tool-page-hero {
            background-color: #f9f9f9;
            padding: 3rem 0 2rem;
            margin-bottom: 3rem;
        }
        
        .tool-page-hero h1 {
            font-size: 2.5rem;
            color: #14697D;
            margin-bottom: 1rem;
            font-family: 'Antic Slab', serif;
        }
        
        .tool-page-hero .lead {
            color: #666;
            font-size: 1.2rem;
            font-family: 'Quicksand', sans-serif;
        }
        
        .content-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            padding: 2rem;
            margin-bottom: 2rem;
            transition: transform 0.3s ease;
        }
        
        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }
        
        .tracking-option-card {
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            height: 100%;
            background: #f8f9fa;
        }
        
        .tracking-option-card:hover {
            border-color: #14697D;
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(20, 105, 125, 0.2);
        }
        
        .tracking-option-card.selected {
            border-color: #FFbf23 !important;
            background-color: #fffbf0 !important;
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(255, 191, 35, 0.3);
        }
        
        .status-option {
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .status-option:hover {
            border-color: #14697D;
            background-color: #f9f9f9;
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(20, 105, 125, 0.2);
        }
        
        .status-option.selected {
            border-color: #FFbf23 !important;
            background-color: #fffbf0 !important;
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(255, 191, 35, 0.3);
        }
        
        .loading-spinner {
            display: none;
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #14697D;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            background-color: #14697D;
            color: white;
            border-radius: 50%;
            font-weight: bold;
            font-family: 'Sora', sans-serif;
            margin-right: 10px;
        }
        
        .features-highlight {
            background-color: #FFF0F5;
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .form-control, .form-select {
            border-radius: 20px;
            border: 1px solid #ddd;
            padding: 0.75rem 1.25rem;
            font-family: 'Quicksand', sans-serif;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: #14697D;
            box-shadow: 0 0 0 0.2rem rgba(20, 105, 125, 0.25);
        }

        .form-label {
            font-family: 'Quicksand', sans-serif;
            font-weight: 600;
        }
        
        .interview-preview {
            background-color: #f9f9f9;
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid #e0e0e0;
            font-family: 'Quicksand', sans-serif;
            line-height: 1.8;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .float-animation {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0px); }
        }

        .job-tracker-disclaimer {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 15px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .export-options {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 2rem;
        }
        
        .export-option {
            flex: 1;
            min-width: 150px;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .export-option:hover {
            border-color: #14697D;
            background-color: #f9f9f9;
        }
        
        .export-option i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: #14697D;
        }

        .tracker-tab {
            background: none;
            border: none;
            padding: 12px 24px;
            margin: 0 6px;
            font-size: 1rem;
            font-weight: 500;
            color: #666;
            cursor: pointer;
            border-radius: 30px 30px 0 0;
            transition: all 0.3s ease;
        }
        
        .tracker-tab:hover {
            color: #333;
            background-color: #f0f0f0;
        }
        
        .tracker-tab.active {
            background-color: #14697D;
            color: white;
        }

        .tracker-tabs {
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 2rem;
        }

        .custom-fields {
            display: none;
        }

        .application-info {
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            background-color: #f8f9fa;
        }

        .job-application-item {
            border: 1px solid #e0e0e0;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            background: white;
            transition: all 0.3s ease;
        }

        .job-application-item:hover {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            transform: translateY(-2px);
        }

        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .status-applied { background-color: #e3f2fd; color: #1976d2; }
        .status-interview { background-color: #fff3cd; color: #856404; }
        .status-offer { background-color: #d1ecf1; color: #0c5460; }
        .status-rejected { background-color: #f8d7da; color: #721c24; }
        .status-accepted { background-color: #d4edda; color: #155724; }

        .interview-question {
            background-color: #f8f9fa;
            border-left: 4px solid #14697D;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 10px 10px 0;
        }

        .prep-category {
            background-color: #e7f3ff;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .tool-page-hero h1 {
                font-size: 2rem;
            }
            
            .content-card {
                padding: 1.5rem;
            }
            
            .export-options {
                flex-direction: column;
            }
            
            .export-option {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container-nav">
            <div class="row align-items-center">
                <div class="col-md-3">
                    <div class="d-flex align-items-center">
                        <div class="logo-container">
                            <img src="/img/logo.svg" alt="logo">
                        </div>
                    </div>
                </div>
                <div class="col-md-9">
                    <nav>
                        
                        <a href="/#tools" class="btn btn-outline-dark me-2">AI Tools</a>
                        <a href="/#pricing" class="btn btn-outline-dark me-2">Pricing</a>
                        <a href="#" class="btn btn-get-started">Get Started</a>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <main>
        <!-- Tool Hero Section -->
        <section class="tool-page-hero">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-8">
                        <h1>JobTracker - AI Job Application & Interview Assistant</h1>
                        <p class="lead">Track your job applications, get personalized interview preparation, and optimize your job search strategy with AI-powered insights.</p>
                    </div>
                    <div class="col-lg-4 text-center">
                        <img src="/img/img11.svg" alt="Job Tracking" style="max-height: 150px;" class="float-animation">
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Content -->
        <div class="container">
            <div class="row">
                <!-- Left Column -->
                <div class="col-lg-4 mb-4">
                    <div class="content-card">
                        <h5><i class="fas fa-clipboard-list" style="color: #14697D;"></i> How It Works</h5>
                        <ol class="mt-3">
                            <div><span class="step-number">1</span> Add job applications</div>
                            <div class="mt-2"><span class="step-number">2</span> Track application status</div>
                            <div class="mt-2"><span class="step-number">3</span> Prepare for interviews</div>
                            <div class="mt-2"><span class="step-number">4</span> Get AI insights</div>
                            <div class="mt-2"><span class="step-number">5</span> Optimize your strategy</div>
                        </ol>
                    </div>

                    <div class="features-highlight">
                        <h5><i class="fas fa-star" style="color: #FFbf23;"></i> Job Search Features</h5>
                        <ul class="list-unstyled mt-3">
                            <li class="mb-2"><i class="fas fa-check-circle" style="color: #14697D;"></i> Application tracking</li>
                            <li class="mb-2"><i class="fas fa-check-circle" style="color: #14697D;"></i> Interview preparation</li>
                            <li class="mb-2"><i class="fas fa-check-circle" style="color: #14697D;"></i> Custom interview questions</li>
                            <li class="mb-2"><i class="fas fa-check-circle" style="color: #14697D;"></i> Company research</li>
                            <li class="mb-2"><i class="fas fa-check-circle" style="color: #14697D;"></i> Follow-up reminders</li>
                            <li><i class="fas fa-check-circle" style="color: #14697D;"></i> Success analytics</li>
                        </ul>
                    </div>

                    <div class="content-card">
                        <h5><i class="fas fa-briefcase" style="color: #A82C2C;"></i> Application Types</h5>
                        <div class="mt-3">
                            <div class="mb-2"><i class="fas fa-laptop-code" style="color: #14697D;"></i> Software Engineering</div>
                            <div class="mb-2"><i class="fas fa-chart-line" style="color: #14697D;"></i> Marketing & Sales</div>
                            <div class="mb-2"><i class="fas fa-users" style="color: #14697D;"></i> Human Resources</div>
                            <div class="mb-2"><i class="fas fa-calculator" style="color: #14697D;"></i> Finance & Accounting</div>
                            <div class="mb-2"><i class="fas fa-cogs" style="color: #14697D;"></i> Operations</div>
                            <div class="mb-2"><i class="fas fa-paint-brush" style="color: #14697D;"></i> Design & Creative</div>
                            <div class="mb-2"><i class="fas fa-graduation-cap" style="color: #14697D;"></i> Education</div>
                            <div><i class="fas fa-plus" style="color: #14697D;"></i> Custom Positions</div>
                        </div>
                    </div>

                    <div class="job-tracker-disclaimer">
                        <h6><i class="fas fa-info-circle me-2" style="color: #856404;"></i>Career Guidance</h6>
                        <p class="small mb-0">JobTracker provides general career guidance and interview preparation. For specialized career counseling, consider consulting with a professional career advisor.</p>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="col-lg-8">
                    <div class="content-card">
                        <h4 class="mb-4">Manage Your Job Search</h4>
                        
                        <!-- Usage Tracker -->
                        <div class="alert alert-info d-flex align-items-center mb-4" id="usageTracker">
                            <i class="fas fa-info-circle me-2"></i>
                            <div class="flex-grow-1">
                                <strong>Free Uses Remaining:</strong> <span id="remainingUses">5</span> / 5 this month
                                <div class="small mt-1">Resets on: <span id="resetDate">1st of next month</span></div>
                            </div>
                            <a href="/#pricing" class="btn btn-sm btn-primary ms-3">Upgrade</a>
                        </div>

                        <!-- Tracker Tabs -->
                        <div class="tracker-tabs mb-4">
                            <button class="tracker-tab active" data-tab="add">Add Application</button>
                            <button class="tracker-tab" data-tab="track">Track Applications</button>
                            <button class="tracker-tab" data-tab="interview">Interview Prep</button>
                        </div>

                        <!-- Add Application Section -->
                        <div id="addSection" class="tab-content active">
                            <form id="jobApplicationForm">
                                <div class="mb-4">
                                    <label class="form-label fw-bold">Application Type</label>
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <div class="tracking-option-card card h-100" data-type="software_engineering">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-laptop-code mb-2" style="color: #14697D; font-size: 2rem;"></i>
                                                    <h6>Software Engineering</h6>
                                                    <small class="text-muted">Developer roles</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="tracking-option-card card h-100" data-type="marketing_sales">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-chart-line mb-2" style="color: #14697D; font-size: 2rem;"></i>
                                                    <h6>Marketing & Sales</h6>
                                                    <small class="text-muted">Growth & revenue</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="tracking-option-card card h-100" data-type="finance">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-calculator mb-2" style="color: #14697D; font-size: 2rem;"></i>
                                                    <h6>Finance</h6>
                                                    <small class="text-muted">Financial roles</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="tracking-option-card card h-100" data-type="design">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-paint-brush mb-2" style="color: #14697D; font-size: 2rem;"></i>
                                                    <h6>Design & Creative</h6>
                                                    <small class="text-muted">Creative positions</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="tracking-option-card card h-100" data-type="operations">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-cogs mb-2" style="color: #14697D; font-size: 2rem;"></i>
                                                    <h6>Operations</h6>
                                                    <small class="text-muted">Business ops</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="tracking-option-card card h-100" data-type="other">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-plus mb-2" style="color: #14697D; font-size: 2rem;"></i>
                                                    <h6>Other</h6>
                                                    <small class="text-muted">Custom position</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <input type="hidden" id="selectedJobType" name="jobType" required>

                                <!-- Basic Information -->
                                <div class="mb-4">
                                    <h5>Job Application Details</h5>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="companyName" class="form-label">Company Name</label>
                                            <input type="text" class="form-control" id="companyName" name="companyName" required placeholder="e.g., Google, Microsoft">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="jobTitle" class="form-label">Job Title</label>
                                            <input type="text" class="form-control" id="jobTitle" name="jobTitle" required placeholder="e.g., Senior Software Engineer">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="jobLocation" class="form-label">Location</label>
                                            <input type="text" class="form-control" id="jobLocation" name="jobLocation" placeholder="e.g., San Francisco, Remote">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="applicationDate" class="form-label">Application Date</label>
                                            <input type="date" class="form-control" id="applicationDate" name="applicationDate" required>
                                        </div>
                                    </div>
                                </div>

                                <!-- Application Status -->
                                <div class="mb-4">
                                    <label class="form-label fw-bold">Current Status</label>
                                    <div class="row">
                                        <div class="col-md-3 mb-3">
                                            <div class="status-option selected" data-status="applied">
                                                <i class="fas fa-paper-plane mb-2" style="color: #1976d2;"></i>
                                                <div>Applied</div>
                                                <small class="text-muted">Just submitted</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="status-option" data-status="review">
                                                <i class="fas fa-eye mb-2" style="color: #856404;"></i>
                                                <div>Under Review</div>
                                                <small class="text-muted">Being reviewed</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="status-option" data-status="interview">
                                                <i class="fas fa-comments mb-2" style="color: #0c5460;"></i>
                                                <div>Interview</div>
                                                <small class="text-muted">Interview scheduled</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="status-option" data-status="offer">
                                                <i class="fas fa-trophy mb-2" style="color: #155724;"></i>
                                                <div>Offer</div>
                                                <small class="text-muted">Received offer</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <input type="hidden" id="selectedStatus" name="status" value="applied">

                                <!-- Additional Details -->
                                <div class="mb-4">
                                    <h5>Additional Information</h5>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="salaryRange" class="form-label">Salary Range (Optional)</label>
                                            <input type="text" class="form-control" id="salaryRange" name="salaryRange" placeholder="e.g., $80,000 - $120,000">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="jobSource" class="form-label">Job Source</label>
                                            <select class="form-select" id="jobSource" name="jobSource">
                                                <option value="">Select source</option>
                                                <option value="linkedin">LinkedIn</option>
                                                <option value="company_website">Company Website</option>
                                                <option value="indeed">Indeed</option>
                                                <option value="glassdoor">Glassdoor</option>
                                                <option value="referral">Referral</option>
                                                <option value="recruiter">Recruiter</option>
                                                <option value="other">Other</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="jobDescription" class="form-label">Job Description (Optional)</label>
                                        <textarea class="form-control" id="jobDescription" name="jobDescription" rows="3" placeholder="Paste the job description here for better interview preparation..."></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label for="applicationNotes" class="form-label">Notes</label>
                                        <textarea class="form-control" id="applicationNotes" name="applicationNotes" rows="2" placeholder="Any notes about the application, contact person, etc..."></textarea>
                                    </div>
                                </div>

                                <button type="submit" class="btn btn-primary btn-lg w-100">
                                    <i class="fas fa-plus me-2"></i> Add Job Application
                                </button>
                            </form>
                        </div>

                        <!-- Track Applications Section -->
                        <div id="trackSection" class="tab-content" style="display: none;">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5>Your Job Applications</h5>
                                <div class="d-flex gap-2">
                                    <select class="form-select" id="statusFilter" style="width: auto;">
                                        <option value="">All Statuses</option>
                                        <option value="applied">Applied</option>
                                        <option value="review">Under Review</option>
                                        <option value="interview">Interview</option>
                                        <option value="offer">Offer</option>
                                        <option value="rejected">Rejected</option>
                                        <option value="accepted">Accepted</option>
                                    </select>
                                    <button class="btn btn-outline-primary" id="generateInsights">
                                        <i class="fas fa-chart-bar me-1"></i> Get AI Insights
                                    </button>
                                </div>
                            </div>

                            <div id="applicationsContainer">
                                <!-- Sample applications will be loaded here -->
                                <div class="job-application-item">
                                    <div class="d-flex justify-content-between align-items-start mb-3">
                                        <div>
                                            <h6 class="mb-1">Senior Frontend Developer</h6>
                                            <p class="text-muted mb-1">TechCorp Inc. â€¢ San Francisco, CA</p>
                                            <small class="text-muted">Applied on: March 15, 2024</small>
                                        </div>
                                        <span class="status-badge status-interview">Interview Scheduled</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <small class="text-muted">Source: LinkedIn â€¢ Salary: $90k-$120k</small>
                                        </div>
                                        <div class="btn-group">
                                            <button class="btn btn-sm btn-outline-primary">Edit</button>
                                            <button class="btn btn-sm btn-outline-success">Prep Interview</button>
                                        </div>
                                    </div>
                                </div>

                                <div class="job-application-item">
                                    <div class="d-flex justify-content-between align-items-start mb-3">
                                        <div>
                                            <h6 class="mb-1">Product Marketing Manager</h6>
                                            <p class="text-muted mb-1">StartupXYZ â€¢ Remote</p>
                                            <small class="text-muted">Applied on: March 10, 2024</small>
                                        </div>
                                        <span class="status-badge status-applied">Applied</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <small class="text-muted">Source: Company Website â€¢ Salary: $70k-$95k</small>
                                        </div>
                                        <div class="btn-group">
                                            <button class="btn btn-sm btn-outline-primary">Edit</button>
                                            <button class="btn btn-sm btn-outline-info">Follow Up</button>
                                        </div>
                                    </div>
                                </div>

                                <div class="job-application-item">
                                    <div class="d-flex justify-content-between align-items-start mb-3">
                                        <div>
                                            <h6 class="mb-1">UX Designer</h6>
                                            <p class="text-muted mb-1">Design Studio â€¢ New York, NY</p>
                                            <small class="text-muted">Applied on: March 5, 2024</small>
                                        </div>
                                        <span class="status-badge status-rejected">Not Selected</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <small class="text-muted">Source: Glassdoor â€¢ Salary: $65k-$85k</small>
                                        </div>
                                        <div class="btn-group">
                                            <button class="btn btn-sm btn-outline-secondary">Archive</button>
                                            <button class="btn btn-sm btn-outline-primary">Learn</button>
                                        </div>
                                    </div>
                                </div>

                                <div class="text-center mt-4">
                                    <p class="text-muted">Showing 3 of 8 applications</p>
                                    <button class="btn btn-outline-primary">Load More</button>
                                </div>
                            </div>

                            <!-- AI Insights Section -->
                            <div id="insightsContainer" class="mt-4" style="display: none;">
                                <div class="content-card">
                                    <h5 class="mb-3"><i class="fas fa-lightbulb me-2" style="color: #FFbf23;"></i>AI Job Search Insights</h5>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h6>Application Success Rate</h6>
                                            <div class="progress mb-3">
                                                <div class="progress-bar bg-success" role="progressbar" style="width: 37.5%">37.5%</div>
                                            </div>
                                            <p class="small text-muted">3 out of 8 applications advanced to interview stage</p>
                                        </div>
                                        <div class="col-md-6">
                                            <h6>Average Response Time</h6>
                                            <p class="h4 text-primary">8 days</p>
                                            <p class="small text-muted">Companies typically respond within 5-14 days</p>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <h6>Recommendations</h6>
                                        <ul class="list-unstyled">
                                            <li class="mb-2"><i class="fas fa-arrow-right me-2" style="color: #14697D;"></i>Focus on tech companies - higher response rate (60%)</li>
                                            <li class="mb-2"><i class="fas fa-arrow-right me-2" style="color: #14697D;"></i>LinkedIn applications perform 40% better than job boards</li>
                                            <li class="mb-2"><i class="fas fa-arrow-right me-2" style="color: #14697D;"></i>Follow up after 10 days for pending applications</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Interview Prep Section -->
                        <div id="interviewSection" class="tab-content" style="display: none;">
                            <form id="interviewPrepForm">
                                <div class="mb-4">
                                    <h5>Interview Preparation</h5>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="prepCompanyName" class="form-label">Company Name</label>
                                            <input type="text" class="form-control" id="prepCompanyName" name="prepCompanyName" required placeholder="e.g., Google, Microsoft">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="prepJobTitle" class="form-label">Job Title</label>
                                            <input type="text" class="form-control" id="prepJobTitle" name="prepJobTitle" required placeholder="e.g., Senior Software Engineer">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="interviewType" class="form-label">Interview Type</label>
                                            <select class="form-select" id="interviewType" name="interviewType" required>
                                                <option value="">Select interview type</option>
                                                <option value="phone_screening">Phone Screening</option>
                                                <option value="video_interview">Video Interview</option>
                                                <option value="technical_interview">Technical Interview</option>
                                                <option value="behavioral_interview">Behavioral Interview</option>
                                                <option value="case_study">Case Study</option>
                                                <option value="final_interview">Final Interview</option>
                                                <option value="panel_interview">Panel Interview</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="interviewDate" class="form-label">Interview Date (Optional)</label>
                                            <input type="datetime-local" class="form-control" id="interviewDate" name="interviewDate">
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="jobRequirements" class="form-label">Job Requirements/Skills</label>
                                        <textarea class="form-control" id="jobRequirements" name="jobRequirements" rows="3" placeholder="List key skills and requirements from the job posting..."></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label for="prepNotes" class="form-label">Additional Context</label>
                                        <textarea class="form-control" id="prepNotes" name="prepNotes" rows="2" placeholder="Any specific areas you want to focus on or concerns you have..."></textarea>
                                    </div>
                                </div>

                                <button type="submit" class="btn btn-primary btn-lg w-100">
                                    <i class="fas fa-brain me-2"></i> Generate Interview Prep
                                </button>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Results Container -->
                    <div id="resultsContainer" class="content-card" style="display: none;">
                        <h4 class="mb-4">Interview Preparation Guide</h4>
                        
                        <!-- Interview Prep Preview -->
                        <div class="interview-preview mb-4" id="interviewPreview">
                            <!-- Generated interview prep will appear here -->
                        </div>
                        
                        <!-- Export Options -->
                        <div class="export-options">
                            <div class="export-option" id="exportPDF">
                                <i class="fas fa-file-pdf"></i>
                                <div>Download PDF</div>
                                <small class="text-muted">Printable guide</small>
                            </div>
                            <div class="export-option" id="copyPrep">
                                <i class="fas fa-copy"></i>
                                <div>Copy Text</div>
                                <small class="text-muted">To clipboard</small>
                            </div>
                            <div class="export-option" id="savePrep">
                                <i class="fas fa-bookmark"></i>
                                <div>Save Prep</div>
                                <small class="text-muted">To your account</small>
                            </div>
                        </div>
                        
                        <div class="mt-4 d-flex gap-2">
                            <button class="btn btn-outline-primary" id="editPrepBtn">
                                <i class="fas fa-edit me-1"></i> Edit Preparation
                            </button>
                            <button class="btn btn-outline-secondary" id="newPrepBtn">
                                <i class="fas fa-plus me-1"></i> New Interview Prep
                            </button>
                        </div>
                    </div>
                    
                    <!-- Loading Spinner -->
                    <div class="loading-spinner" id="loadingSpinner"></div>
                </div>
            </div>
        </div>
         <!-- CTA Section -->
        <section class="py-5 mt-5" style="background-color: #f9f9f9;">
            <div class="container text-center">
                <h2 class="mb-4">Ready to <span style="color: #14697D;">land</span> your dream job?</h2>
                <p class="lead mb-4">Discover more AI-powered tools that make your work faster, smarter, and more impressive..</p>
                <a href="/#pricing" class="btn btn-primary btn-lg">
                    <i class="fas fa-rocket me-2"></i> Start Building
                </a>
            </div>
        </section>
    </main>

    <footer class="py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <h1 class="brand-logo" style="font-size: 1.8rem;">elevify<span class="accent-dot" style="color: #FFbf23;">.</span></h1>
                    <p>Elevate your potential with AI-powered tools that help you work smarter, not harder.</p>
                </div>
                <div class="col-md-4 mb-3">
                    <h5>Quick Links</h5>
                    <ul class="list-unstyled">
                        <li><a href="/">Home</a></li>
                        <li><a href="/#tools">Tools</a></li>
                        <li><a href="/#pricing">Pricing</a></li>
                        <li><a href="/#contact">Contact</a></li>
                    </ul>
                </div>
                <div class="col-md-4 mb-3">
                    <h5>Connect With Us</h5>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-linkedin"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-12 text-center">
                    <p>&copy; 2025 by Elo.</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
// ============================================================================
// SECTION 1: CONFIGURATION AND INITIALIZATION - UPDATED FOR RENDER
// ============================================================================

// Configuration - Updated for Render deployment
const CONFIG = {
    // Backend API base URL - Updated to Render backend
    API_BASE_URL: 'https://elevify.onrender.com',
    
    // API endpoints from app.py
    ENDPOINTS: {
        JOB_TRACKER: '/api/job-tracker',
        CHECK_TOOL_ACCESS: '/api/check-tool-access',
        UPLOAD_FILE: '/api/job-tracker/upload',
        ANALYZE_RESUME: '/api/job-tracker/analyze-resume',
        INTERVIEW_PREP: '/api/job-tracker/interview-prep',
        GENERATE_QUESTIONS: '/api/job-tracker/generate-questions',
        EVALUATE_ANSWER: '/api/job-tracker/evaluate-answer'
    },
    
    // Tool configuration
    TOOL_ID: 'job_tracker',
    TOOL_NAME: 'Job Application Tracker and Interview Bot',
    
    // Default settings
    MAX_FILE_SIZE: 16 * 1024 * 1024, // 16MB
    ALLOWED_FILE_TYPES: ['pdf', 'doc', 'docx', 'txt'],
    
    // UI selectors
    SELECTORS: {
        // Tab system
        trackerTabs: '.tracker-tab',
        tabContents: '.tab-content',
        
        // Forms
        jobApplicationForm: '#jobApplicationForm',
        interviewPrepForm: '#interviewPrepForm',
        
        // Containers
        applicationsContainer: '#applicationsContainer',
        resultsContainer: '#resultsContainer',
        interviewPreview: '#interviewPreview',
        loadingSpinner: '#loadingSpinner',
        
        // Input elements
        jobTypeCards: '.tracking-option-card',
        statusOptions: '.status-option',
        selectedJobType: '#selectedJobType',
        selectedStatus: '#selectedStatus',
        
        // File upload
        resumeUpload: '#resumeUpload',
        jobDescriptionFile: '#jobDescriptionFile',
        
        // Usage tracking
        usageTracker: '#usageTracker',
        remainingUses: '#remainingUses'
    }
};

// Enhanced API helper function for Render
async function makeAPIRequest(endpoint, method = 'GET', data = null) {
    const options = {
        method: method,
        credentials: 'include', // Important for CORS
        headers: {
            'Content-Type': 'application/json',
        }
    };
    
    if (data && method !== 'GET') {
        options.body = JSON.stringify(data);
    }
    
    try {
        const response = await fetch(`${CONFIG.API_BASE_URL}${endpoint}`, options);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        return await response.json();
    } catch (error) {
        console.error('API Request failed:', error);
        throw error;
    }
}

// Enhanced API helper for FormData (file uploads)
async function makeFormDataRequest(endpoint, formData) {
    try {
        const response = await fetch(`${CONFIG.API_BASE_URL}${endpoint}`, {
            method: 'POST',
            credentials: 'include',
            body: formData // Don't set Content-Type for FormData
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        return await response.json();
    } catch (error) {
        console.error('FormData Request failed:', error);
        throw error;
    }
}

// Global state management - unchanged
const AppState = {
    currentTab: 'add',
    jobApplications: [],
    currentInterview: null,
    userSession: null,
    usageData: {
        remaining: 5,
        total: 5,
        resetDate: null
    },
    
    // AI Analysis data
    resumeAnalysis: null,
    jobDescriptionAnalysis: null,
    
    // Interview state
    interviewSession: {
        active: false,
        currentQuestion: 0,
        questions: [],
        answers: [],
        feedback: []
    }
};

// Initialize the application
document.addEventListener('DOMContentLoaded', function() {
    console.log('ðŸš€ JobTracker Application Initializing...');
    
    // Set global tool ID for payment integration
    window.CURRENT_TOOL_ID = CONFIG.TOOL_ID;
    
    // Initialize usage tracking
    initializeUsageTracking();
    
    // Setup event listeners
    setupEventListeners();
    
    // Initialize tab system
    initializeTabSystem();
    
    // Load existing applications
    loadJobApplications();
    
    // Check tool access
    checkToolAccess();
    
    console.log('âœ… JobTracker Application Ready!');
});

// Updated usage tracking initialization - unchanged from original
function initializeUsageTracking() {
    try {
        const usageKey = 'elevify_usage';
        let usageData = JSON.parse(localStorage.getItem(usageKey) || '{}');
        
        if (!usageData[CONFIG.TOOL_ID]) {
            usageData[CONFIG.TOOL_ID] = {
                count: 0,
                lastReset: new Date().toISOString(),
                month: new Date().getMonth(),
                year: new Date().getFullYear()
            };
            localStorage.setItem(usageKey, JSON.stringify(usageData));
        }
        
        // Check if month has changed
        const currentMonth = new Date().getMonth();
        const currentYear = new Date().getFullYear();
        
        if (usageData[CONFIG.TOOL_ID].month !== currentMonth || 
            usageData[CONFIG.TOOL_ID].year !== currentYear) {
            usageData[CONFIG.TOOL_ID] = {
                count: 0,
                lastReset: new Date().toISOString(),
                month: currentMonth,
                year: currentYear
            };
            localStorage.setItem(usageKey, JSON.stringify(usageData));
        }
        
        // Update app state
        AppState.usageData.remaining = Math.max(0, 5 - usageData[CONFIG.TOOL_ID].count);
        AppState.usageData.total = 5;
        
        // Update UI
        updateUsageDisplay();
        
        console.log('ðŸ“Š Usage tracking initialized:', AppState.usageData);
        
    } catch (error) {
        console.error('âŒ Usage tracking initialization error:', error);
        // Set default values
        AppState.usageData = { remaining: 5, total: 5, resetDate: null };
        updateUsageDisplay();
    }
}

// Updated usage display function - unchanged from original
function updateUsageDisplay() {
    const remainingUsesEl = document.querySelector(CONFIG.SELECTORS.remainingUses);
    const usageTracker = document.querySelector(CONFIG.SELECTORS.usageTracker);
    
    if (remainingUsesEl) {
        remainingUsesEl.textContent = AppState.usageData.remaining;
    }
    
    if (usageTracker) {
        // Remove existing alert classes
        usageTracker.classList.remove('alert-info', 'alert-warning', 'alert-danger');
        
        if (AppState.usageData.remaining === 0) {
            usageTracker.classList.add('alert-danger');
            usageTracker.innerHTML = `
                <i class="fas fa-exclamation-circle me-2"></i>
                <div class="flex-grow-1">
                    <strong>No free uses remaining this month!</strong>
                    <div class="small mt-1">Upgrade to continue using this tool</div>
                </div>
                <a href="/#pricing" class="btn btn-sm btn-warning ms-3" onclick="showUpgradeModal('${CONFIG.TOOL_ID}')">Upgrade Now</a>
            `;
        } else if (AppState.usageData.remaining <= 2) {
            usageTracker.classList.add('alert-warning');
        } else {
            usageTracker.classList.add('alert-info');
        }
    }
    
    // Set reset date
    const resetDateEl = document.getElementById('resetDate');
    if (resetDateEl) {
        const nextMonth = new Date();
        nextMonth.setMonth(nextMonth.getMonth() + 1);
        nextMonth.setDate(1);
        resetDateEl.textContent = nextMonth.toLocaleDateString('en-US', { 
            month: 'long', 
            day: 'numeric' 
        });
    }
}

// Check if user can use the tool
function canUseToolFeature() {
    if (AppState.usageData.remaining <= 0) {
        showUpgradeMessage();
        return false;
    }
    return true;
}

// Show upgrade message with payment integration
function showUpgradeMessage() {
    // Use the global payment system if available
    if (window.showUpgradeModal) {
        window.showUpgradeModal(CONFIG.TOOL_ID);
    } else {
        alert('You have reached your free usage limit for this tool. Please upgrade to continue using all features.');
    }
}

// Increment usage count
function incrementUsage() {
    try {
        const usageKey = 'elevify_usage';
        let usageData = JSON.parse(localStorage.getItem(usageKey) || '{}');
        
        if (usageData[CONFIG.TOOL_ID]) {
            usageData[CONFIG.TOOL_ID].count++;
            localStorage.setItem(usageKey, JSON.stringify(usageData));
            
            AppState.usageData.remaining = Math.max(0, 5 - usageData[CONFIG.TOOL_ID].count);
            updateUsageDisplay();
        }
    } catch (error) {
        console.error('âŒ Usage increment error:', error);
    }
}

// Updated API functions to use Render backend
async function handleJobApplicationSubmission(e) {
    e.preventDefault();
    
    console.log('ðŸ“ Job application submission started...');
    
    // Check usage limits
    if (!canUseToolFeature()) {
        return;
    }
    
    // Validate form data
    const formData = new FormData(e.target);
    const applicationData = Object.fromEntries(formData.entries());
    
    // Validate required fields
    if (!applicationData.jobType || !applicationData.companyName || !applicationData.jobTitle) {
        showErrorMessage('Please fill in all required fields and select a job type.');
        return;
    }
    
    try {
        showLoadingSpinner();
        
        // Prepare request data
        const requestData = {
            action: 'create_strategy',
            toolId: CONFIG.TOOL_ID,
            jobTitle: applicationData.jobTitle,
            companyName: applicationData.companyName,
            industry: applicationData.jobType,
            ...applicationData,
            timestamp: new Date().toISOString()
        };
        
        console.log('ðŸ“¤ Sending application data:', requestData);
        
        // Make API call using updated helper
        const result = await makeAPIRequest(CONFIG.ENDPOINTS.JOB_TRACKER, 'POST', requestData);
        
        if (result.success) {
            console.log('âœ… Application added successfully:', result);
            
            // Increment usage
            incrementUsage();
            
            // Add to local storage
            saveJobApplicationLocally(applicationData);
            
            // Show success message
            showSuccessMessage('Job application added successfully!');
            
            // Reset form
            e.target.reset();
            resetFormSelections();
            
            // Switch to tracking tab
            switchTab('track');
            
        } else {
            throw new Error(result.error || 'Failed to add job application');
        }
        
    } catch (error) {
        console.error('âŒ Application submission error:', error);
        showErrorMessage(error.message || 'Failed to add job application. Please try again.');
    } finally {
        hideLoadingSpinner();
    }
}

// Updated interview prep submission
async function handleInterviewPrepSubmission(e) {
    e.preventDefault();
    
    console.log('ðŸŽ¤ Interview prep submission started...');
    
    // Check usage limits
    if (!canUseToolFeature()) {
        return;
    }
    
    try {
        showLoadingSpinner();
        
        // Collect form data
        const formData = new FormData(e.target);
        const prepData = Object.fromEntries(formData.entries());
        
        // Validate required fields
        if (!prepData.prepCompanyName || !prepData.prepJobTitle || !prepData.interviewType) {
            throw new Error('Please fill in company name, job title, and interview type.');
        }
        
        console.log('ðŸ“¤ Sending interview prep request:', prepData);
        
        // Prepare request data
        const requestData = {
            action: 'create_strategy',
            toolId: CONFIG.TOOL_ID,
            jobTitle: prepData.prepJobTitle,
            companyName: prepData.prepCompanyName,
            industry: prepData.interviewType,
            ...prepData,
            timestamp: new Date().toISOString()
        };
        
        // Make API call using updated helper
        const result = await makeAPIRequest(CONFIG.ENDPOINTS.JOB_TRACKER, 'POST', requestData);
        
        if (result.success) {
            console.log('âœ… Interview prep generated successfully:', result);
            
            // Increment usage
            incrementUsage();
            
            // Store interview session data
            AppState.interviewSession = {
                active: true,
                prepData: prepData,
                generatedContent: result.content || result.strategy,
                currentQuestion: 0,
                questions: [],
                answers: [],
                feedback: [],
                startedAt: new Date().toISOString()
            };
            
            // Display the interview preparation
            displayInterviewPreparation(result);
            
            // Show results container
            showResultsContainer();
            
            showSuccessMessage('Interview preparation generated successfully!');
            
        } else {
            throw new Error(result.error || 'Failed to generate interview preparation');
        }
        
    } catch (error) {
        console.error('âŒ Interview prep error:', error);
        showErrorMessage(error.message || 'Failed to generate interview preparation. Please try again.');
    } finally {
        hideLoadingSpinner();
    }
}

// Updated tool access check
async function checkToolAccess() {
    try {
        const result = await makeAPIRequest(CONFIG.ENDPOINTS.CHECK_TOOL_ACCESS, 'POST', {
            tool_id: CONFIG.TOOL_ID
        });
        
        if (result.success) {
            console.log('ðŸ” Tool access check:', result);
            
            if (result.has_access) {
                console.log(`âœ… User has ${result.access_type} access to ${CONFIG.TOOL_NAME}`);
            } else {
                console.log(`âš ï¸ User does not have paid access to ${CONFIG.TOOL_NAME}`);
            }
        }
        
    } catch (error) {
        console.log('âš ï¸ Tool access check failed, continuing with frontend tracking:', error.message);
    }
}

// Update file extraction to use Render backend
async function extractTextFromFileViaBackend(file) {
    try {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('action', 'extract_text');
        
        const result = await makeFormDataRequest(CONFIG.ENDPOINTS.JOB_TRACKER, formData);
        
        if (result.success && result.text) {
            return result.text;
        } else {
            throw new Error(result.error || 'Failed to extract text from file');
        }
        
    } catch (error) {
        console.error('âŒ Backend text extraction error:', error);
        throw new Error('Failed to process file. Please try a different format or check file integrity.');
    }
}
// ============================================================================
// SECTION 2: EVENT LISTENERS AND UI MANAGEMENT
// ============================================================================

// Setup all event listeners
function setupEventListeners() {
    // Job type selection
    setupJobTypeSelection();
    
    // Status selection
    setupStatusSelection();
    
    // Tab switching
    setupTabSwitching();
    
    // Form submissions
    setupFormSubmissions();
    
    // File upload handlers
    setupFileUploads();
    
    // Export and action buttons
    setupActionButtons();
    
    // Interview prep specific
    setupInterviewPrepListeners();
    
    console.log('ðŸŽ¯ Event listeners configured');
}

// Job type selection setup
function setupJobTypeSelection() {
    const jobTypeCards = document.querySelectorAll(CONFIG.SELECTORS.jobTypeCards);
    const selectedJobTypeInput = document.querySelector(CONFIG.SELECTORS.selectedJobType);
    
    if (!jobTypeCards.length) return;
    
    jobTypeCards.forEach(card => {
        card.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Remove selected class from all cards
            jobTypeCards.forEach(c => c.classList.remove('selected'));
            
            // Add selected class to clicked card
            this.classList.add('selected');
            
            // Update hidden input
            const jobType = this.getAttribute('data-type');
            if (selectedJobTypeInput) {
                selectedJobTypeInput.value = jobType;
            }
            
            console.log('ðŸ“ Job type selected:', jobType);
        });
    });
}

// Status selection setup
function setupStatusSelection() {
    const statusOptions = document.querySelectorAll(CONFIG.SELECTORS.statusOptions);
    const selectedStatusInput = document.querySelector(CONFIG.SELECTORS.selectedStatus);
    
    if (!statusOptions.length) return;
    
    statusOptions.forEach(option => {
        option.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Remove selected class from all options
            statusOptions.forEach(o => o.classList.remove('selected'));
            
            // Add selected class to clicked option
            this.classList.add('selected');
            
            // Update hidden input
            const status = this.getAttribute('data-status');
            if (selectedStatusInput) {
                selectedStatusInput.value = status;
            }
            
            console.log('ðŸ“Š Status selected:', status);
        });
    });
}

// Tab switching setup
function setupTabSwitching() {
    const trackerTabs = document.querySelectorAll(CONFIG.SELECTORS.trackerTabs);
    
    if (!trackerTabs.length) return;
    
    trackerTabs.forEach(tab => {
        tab.addEventListener('click', function(e) {
            e.preventDefault();
            
            const targetTab = this.getAttribute('data-tab');
            switchTab(targetTab);
        });
    });
}

// Switch between tabs
function switchTab(targetTab) {
    // Update active tab
    const trackerTabs = document.querySelectorAll(CONFIG.SELECTORS.trackerTabs);
    trackerTabs.forEach(tab => tab.classList.remove('active'));
    
    const activeTab = document.querySelector(`[data-tab="${targetTab}"]`);
    if (activeTab) {
        activeTab.classList.add('active');
    }
    
    // Show/hide content sections
    const sections = {
        'add': document.getElementById('addSection'),
        'track': document.getElementById('trackSection'),
        'interview': document.getElementById('interviewSection')
    };
    
    // Hide all sections
    Object.values(sections).forEach(section => {
        if (section) section.style.display = 'none';
    });
    
    // Show target section
    if (sections[targetTab]) {
        sections[targetTab].style.display = 'block';
        AppState.currentTab = targetTab;
    }
    
    // Load data for specific tabs
    if (targetTab === 'track') {
        loadJobApplications();
    } else if (targetTab === 'interview') {
        initializeInterviewPrep();
    }
    
    console.log('ðŸ”„ Switched to tab:', targetTab);
}

// Form submission setup
function setupFormSubmissions() {
    // Job application form
    const jobApplicationForm = document.querySelector(CONFIG.SELECTORS.jobApplicationForm);
    if (jobApplicationForm) {
        jobApplicationForm.addEventListener('submit', handleJobApplicationSubmission);
    }
    
    // Interview prep form
    const interviewPrepForm = document.querySelector(CONFIG.SELECTORS.interviewPrepForm);
    if (interviewPrepForm) {
        interviewPrepForm.addEventListener('submit', handleInterviewPrepSubmission);
    }
    
    console.log('ðŸ“‹ Form submissions configured');
}

// File upload setup
function setupFileUploads() {
    // Resume upload
    const resumeUpload = document.querySelector(CONFIG.SELECTORS.resumeUpload);
    if (resumeUpload) {
        resumeUpload.addEventListener('change', handleResumeUpload);
    }
    
    // Job description file upload
    const jobDescriptionFile = document.querySelector(CONFIG.SELECTORS.jobDescriptionFile);
    if (jobDescriptionFile) {
        jobDescriptionFile.addEventListener('change', handleJobDescriptionUpload);
    }
    
    console.log('ðŸ“ File upload handlers configured');
}

// Action buttons setup
function setupActionButtons() {
    // Export options
    const exportPDF = document.getElementById('exportPDF');
    const copyPrep = document.getElementById('copyPrep');
    const savePrep = document.getElementById('savePrep');
    
    if (exportPDF) exportPDF.addEventListener('click', exportToPDF);
    if (copyPrep) copyPrep.addEventListener('click', copyToClipboard);
    if (savePrep) savePrep.addEventListener('click', savePreparation);
    
    // Edit buttons
    const editPrepBtn = document.getElementById('editPrepBtn');
    const newPrepBtn = document.getElementById('newPrepBtn');
    
    if (editPrepBtn) {
        editPrepBtn.addEventListener('click', function() {
            hideResultsContainer();
        });
    }
    
    if (newPrepBtn) {
        newPrepBtn.addEventListener('click', function() {
            resetInterviewPrep();
        });
    }
    
    // Insights button
    const generateInsightsBtn = document.getElementById('generateInsights');
    if (generateInsightsBtn) {
        generateInsightsBtn.addEventListener('click', generateJobSearchInsights);
    }
    
    // Filter functionality
    const statusFilter = document.getElementById('statusFilter');
    if (statusFilter) {
        statusFilter.addEventListener('change', function() {
            filterApplications(this.value);
        });
    }
    
    console.log('ðŸ”§ Action buttons configured');
}

// Interview prep specific listeners
function setupInterviewPrepListeners() {
    // Answer submission
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('submit-answer-btn')) {
            handleAnswerSubmission(e);
        }
        
        if (e.target.classList.contains('next-question-btn')) {
            showNextQuestion(e);
        }
        
        if (e.target.classList.contains('finish-interview-btn')) {
            finishInterviewSession(e);
        }
    });
    
    console.log('ðŸŽ¤ Interview prep listeners configured');
}

// Initialize tab system
function initializeTabSystem() {
    // Set default tab
    switchTab('add');
    
    // Set today's date for application date
    const applicationDateInput = document.getElementById('applicationDate');
    if (applicationDateInput) {
        const today = new Date().toISOString().split('T')[0];
        applicationDateInput.value = today;
    }
    
    console.log('ðŸ“‘ Tab system initialized');
}

// Utility functions for UI management
function showLoadingSpinner() {
    const loadingSpinner = document.querySelector(CONFIG.SELECTORS.loadingSpinner);
    if (loadingSpinner) {
        loadingSpinner.style.display = 'block';
    }
}

function hideLoadingSpinner() {
    const loadingSpinner = document.querySelector(CONFIG.SELECTORS.loadingSpinner);
    if (loadingSpinner) {
        loadingSpinner.style.display = 'none';
    }
}

function showResultsContainer() {
    const resultsContainer = document.querySelector(CONFIG.SELECTORS.resultsContainer);
    if (resultsContainer) {
        resultsContainer.style.display = 'block';
        resultsContainer.scrollIntoView({ behavior: 'smooth' });
    }
}

function hideResultsContainer() {
    const resultsContainer = document.querySelector(CONFIG.SELECTORS.resultsContainer);
    if (resultsContainer) {
        resultsContainer.style.display = 'none';
    }
}

// Show success message
function showSuccessMessage(message, duration = 3000) {
    // Create toast notification
    const toast = document.createElement('div');
    toast.className = 'alert alert-success position-fixed';
    toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    toast.innerHTML = `
        <i class="fas fa-check-circle me-2"></i>
        <strong>Success!</strong> ${message}
    `;
    
    document.body.appendChild(toast);
    
    // Auto remove
    setTimeout(() => {
        if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
        }
    }, duration);
}

// Show error message
function showErrorMessage(message, duration = 5000) {
    // Create toast notification
    const toast = document.createElement('div');
    toast.className = 'alert alert-danger position-fixed';
    toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    toast.innerHTML = `
        <i class="fas fa-exclamation-circle me-2"></i>
        <strong>Error!</strong> ${message}
    `;
    
    document.body.appendChild(toast);
    
    // Auto remove
    setTimeout(() => {
        if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
        }
    }, duration);
}
// ============================================================================
// SECTION 3: JOB APPLICATION MANAGEMENT
// ============================================================================

// Handle job application form submission
async function handleJobApplicationSubmission(e) {
    e.preventDefault();
    
    console.log('ðŸ“ Job application submission started...');
    
    // Check usage limits
    if (!canUseToolFeature()) {
        return;
    }
    
    // Validate form data
    const formData = new FormData(e.target);
    const applicationData = Object.fromEntries(formData.entries());
    
    // Validate required fields
    if (!applicationData.jobType || !applicationData.companyName || !applicationData.jobTitle) {
        showErrorMessage('Please fill in all required fields and select a job type.');
        return;
    }
    
    try {
        showLoadingSpinner();
        
        // Prepare request data
        const requestData = {
            action: 'add_application',
            toolId: CONFIG.TOOL_ID,
            ...applicationData,
            timestamp: new Date().toISOString()
        };
        
        console.log('ðŸ“¤ Sending application data:', requestData);
        
        // Make API call
        const response = await fetch(`${CONFIG.API_BASE_URL}${CONFIG.ENDPOINTS.JOB_TRACKER}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(requestData)
        });
        
        const result = await response.json();
        
        if (result.success) {
            console.log('âœ… Application added successfully:', result);
            
            // Increment usage
            incrementUsage();
            
            // Add to local storage
            saveJobApplicationLocally(applicationData);
            
            // Show success message
            showSuccessMessage('Job application added successfully!');
            
            // Reset form
            e.target.reset();
            resetFormSelections();
            
            // Switch to tracking tab
            switchTab('track');
            
        } else {
            throw new Error(result.error || 'Failed to add job application');
        }
        
    } catch (error) {
        console.error('âŒ Application submission error:', error);
        showErrorMessage(error.message || 'Failed to add job application. Please try again.');
    } finally {
        hideLoadingSpinner();
    }
}

// Save job application locally
function saveJobApplicationLocally(applicationData) {
    try {
        // Get existing applications
        const applications = getLocalJobApplications();
        
        // Create application object
        const application = {
            id: generateApplicationId(),
            ...applicationData,
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        };
        
        // Add to array
        applications.push(application);
        
        // Save to localStorage
        localStorage.setItem('job_tracker_applications', JSON.stringify(applications));
        
        // Update app state
        AppState.jobApplications = applications;
        
        console.log('ðŸ’¾ Application saved locally:', application);
        
    } catch (error) {
        console.error('âŒ Local storage error:', error);
    }
}

// Get local job applications
function getLocalJobApplications() {
    try {
        const stored = localStorage.getItem('job_tracker_applications');
        return stored ? JSON.parse(stored) : [];
    } catch (error) {
        console.error('âŒ Error loading applications:', error);
        return [];
    }
}

// Load and display job applications
async function loadJobApplications() {
    try {
        console.log('ðŸ“‹ Loading job applications...');
        
        // Load from local storage
        const localApplications = getLocalJobApplications();
        AppState.jobApplications = localApplications;
        
        // Display applications
        displayJobApplications(localApplications);
        
        // Try to sync with backend
        await syncWithBackend();
        
    } catch (error) {
        console.error('âŒ Error loading applications:', error);
        // Still show local data if available
        displayJobApplications(AppState.jobApplications);
    }
}

// Display job applications in UI
function displayJobApplications(applications) {
    const container = document.querySelector(CONFIG.SELECTORS.applicationsContainer);
    if (!container) return;
    
    if (!applications || applications.length === 0) {
        container.innerHTML = `
            <div class="text-center py-5">
                <i class="fas fa-briefcase mb-3" style="font-size: 3rem; color: #ccc;"></i>
                <h5 class="text-muted">No Job Applications Yet</h5>
                <p class="text-muted">Start by adding your first job application in the "Add Application" tab.</p>
                <button class="btn btn-primary" onclick="switchTab('add')">
                    <i class="fas fa-plus me-2"></i>Add Your First Application
                </button>
            </div>
        `;
        return;
    }
    
    // Sort applications by date (newest first)
    const sortedApplications = [...applications].sort((a, b) => 
        new Date(b.createdAt || b.applicationDate) - new Date(a.createdAt || a.applicationDate)
    );
    
    // Generate HTML for applications
    container.innerHTML = sortedApplications.map(app => generateApplicationHTML(app)).join('');
    
    console.log(`ðŸ“Š Displayed ${applications.length} applications`);
}

// Generate HTML for single application
function generateApplicationHTML(application) {
    const statusBadgeClass = getStatusBadgeClass(application.status);
    const formattedDate = formatDate(application.applicationDate || application.createdAt);
    
    return `
        <div class="job-application-item" data-application-id="${application.id}">
            <div class="d-flex justify-content-between align-items-start mb-3">
                <div>
                    <h6 class="mb-1">${application.jobTitle || 'Job Title'}</h6>
                    <p class="text-muted mb-1">${application.companyName || 'Company'} â€¢ ${application.jobLocation || 'Location'}</p>
                    <small class="text-muted">Applied on: ${formattedDate}</small>
                </div>
                <span class="status-badge ${statusBadgeClass}">${formatStatus(application.status)}</span>
            </div>
            <div class="row mb-2">
                <div class="col-md-6">
                    <small class="text-muted">
                        <i class="fas fa-link me-1"></i>Source: ${application.jobSource || 'Unknown'}
                        ${application.salaryRange ? ` â€¢ Salary: ${application.salaryRange}` : ''}
                    </small>
                </div>
                <div class="col-md-6">
                    <small class="text-muted">
                        <i class="fas fa-briefcase me-1"></i>Type: ${formatJobType(application.jobType)}
                    </small>
                </div>
            </div>
            ${application.applicationNotes ? `
                <div class="mb-2">
                    <small class="text-muted">
                        <i class="fas fa-sticky-note me-1"></i>
                        ${application.applicationNotes}
                    </small>
                </div>
            ` : ''}
            <div class="d-flex justify-content-between align-items-center">
                <div class="btn-group">
                    <button class="btn btn-sm btn-outline-primary" onclick="editApplication('${application.id}')">
                        <i class="fas fa-edit me-1"></i>Edit
                    </button>
                    <button class="btn btn-sm btn-outline-success" onclick="prepareInterviewForApplication('${application.id}')">
                        <i class="fas fa-comments me-1"></i>Interview Prep
                    </button>
                    <button class="btn btn-sm btn-outline-info" onclick="analyzeApplication('${application.id}')">
                        <i class="fas fa-chart-line me-1"></i>Analyze
                    </button>
                </div>
                <div class="dropdown">
                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                        <i class="fas fa-cog me-1"></i>More
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#" onclick="updateApplicationStatus('${application.id}')">
                            <i class="fas fa-sync me-2"></i>Update Status
                        </a></li>
                        <li><a class="dropdown-item" href="#" onclick="duplicateApplication('${application.id}')">
                            <i class="fas fa-copy me-2"></i>Duplicate
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-danger" href="#" onclick="deleteApplication('${application.id}')">
                            <i class="fas fa-trash me-2"></i>Delete
                        </a></li>
                    </ul>
                </div>
            </div>
        </div>
    `;
}

// Helper functions for application display
function getStatusBadgeClass(status) {
    const statusClasses = {
        'applied': 'status-applied',
        'review': 'status-applied',
        'interview': 'status-interview',
        'offer': 'status-offer',
        'rejected': 'status-rejected',
        'accepted': 'status-accepted'
    };
    return statusClasses[status] || 'status-applied';
}

function formatStatus(status) {
    const statusLabels = {
        'applied': 'Applied',
        'review': 'Under Review',
        'interview': 'Interview',
        'offer': 'Offer Received',
        'rejected': 'Not Selected',
        'accepted': 'Accepted'
    };
    return statusLabels[status] || 'Applied';
}

function formatJobType(jobType) {
    return jobType ? jobType.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase()) : 'General';
}

function formatDate(dateString) {
    if (!dateString) return 'Unknown';
    try {
        return new Date(dateString).toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });
    } catch (error) {
        return dateString;
    }
}

// Generate unique application ID
function generateApplicationId() {
    return 'app_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}

// Reset form selections
function resetFormSelections() {
    // Reset job type selection
    const jobTypeCards = document.querySelectorAll(CONFIG.SELECTORS.jobTypeCards);
    jobTypeCards.forEach(card => card.classList.remove('selected'));
    
    // Reset status selection (set first as selected)
    const statusOptions = document.querySelectorAll(CONFIG.SELECTORS.statusOptions);
    statusOptions.forEach(option => option.classList.remove('selected'));
    if (statusOptions[0]) {
        statusOptions[0].classList.add('selected');
    }
    
    // Reset hidden inputs
    const selectedJobTypeInput = document.querySelector(CONFIG.SELECTORS.selectedJobType);
    const selectedStatusInput = document.querySelector(CONFIG.SELECTORS.selectedStatus);
    
    if (selectedJobTypeInput) selectedJobTypeInput.value = '';
    if (selectedStatusInput) selectedStatusInput.value = 'applied';
}

// Filter applications by status
function filterApplications(status) {
    const applications = status ? 
        AppState.jobApplications.filter(app => app.status === status) : 
        AppState.jobApplications;
    
    displayJobApplications(applications);
    console.log(`ðŸ” Filtered applications by status: ${status || 'all'}`);
}

// Sync with backend
async function syncWithBackend() {
    try {
        console.log('ðŸ”„ Syncing with backend...');
        
        const response = await fetch(`${CONFIG.API_BASE_URL}${CONFIG.ENDPOINTS.JOB_TRACKER}?action=get_applications`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            }
        });
        
        if (response.ok) {
            const result = await response.json();
            if (result.success && result.applications) {
                // Merge with local applications
                console.log('âœ… Backend sync successful');
            }
        }
        
    } catch (error) {
        console.log('âš ï¸ Backend sync failed, using local data only:', error.message);
    }
}
// ============================================================================
// SECTION 4: RESUME AND JOB DESCRIPTION ANALYSIS
// ============================================================================

// Handle resume file upload
async function handleResumeUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    console.log('ðŸ“„ Resume upload started:', file.name);
    
    // Validate file
    if (!validateFile(file)) {
        showErrorMessage('Invalid file type. Please upload PDF, DOC, DOCX, or TXT files only.');
        event.target.value = '';
        return;
    }
    
    try {
        showLoadingSpinner();
        
        // Extract text from resume
        const resumeText = await extractTextFromFile(file);
        
        if (!resumeText || resumeText.trim().length < 50) {
            throw new Error('Could not extract meaningful text from the resume file.');
        }
        
        // Store resume analysis
        AppState.resumeAnalysis = {
            filename: file.name,
            text: resumeText,
            uploadedAt: new Date().toISOString(),
            wordCount: resumeText.split(/\s+/).length
        };
        
        // Show success feedback
        showSuccessMessage(`Resume "${file.name}" uploaded successfully! ${AppState.resumeAnalysis.wordCount} words extracted.`);
        
        // Update UI to show resume is loaded
        updateResumeUploadStatus(true, file.name);
        
        console.log('âœ… Resume processed successfully:', AppState.resumeAnalysis);
        
        // If job description is also available, trigger comparison
        if (AppState.jobDescriptionAnalysis) {
            await performResumeJobMatch();
        }
        
    } catch (error) {
        console.error('âŒ Resume upload error:', error);
        showErrorMessage(`Failed to process resume: ${error.message}`);
        event.target.value = '';
        AppState.resumeAnalysis = null;
        updateResumeUploadStatus(false);
    } finally {
        hideLoadingSpinner();
    }
}

// Handle job description file upload
async function handleJobDescriptionUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    console.log('ðŸ“‹ Job description upload started:', file.name);
    
    // Validate file
    if (!validateFile(file)) {
        showErrorMessage('Invalid file type. Please upload PDF, DOC, DOCX, or TXT files only.');
        event.target.value = '';
        return;
    }
    
    try {
        showLoadingSpinner();
        
        // Extract text from job description
        const jobDescText = await extractTextFromFile(file);
        
        if (!jobDescText || jobDescText.trim().length < 20) {
            throw new Error('Could not extract meaningful text from the job description file.');
        }
        
        // Store job description analysis
        AppState.jobDescriptionAnalysis = {
            filename: file.name,
            text: jobDescText,
            uploadedAt: new Date().toISOString(),
            wordCount: jobDescText.split(/\s+/).length
        };
        
        // Show success feedback
        showSuccessMessage(`Job description "${file.name}" uploaded successfully! ${AppState.jobDescriptionAnalysis.wordCount} words extracted.`);
        
        // Update UI to show job description is loaded
        updateJobDescriptionStatus(true, file.name);
        
        console.log('âœ… Job description processed successfully:', AppState.jobDescriptionAnalysis);
        
        // If resume is also available, trigger comparison
        if (AppState.resumeAnalysis) {
            await performResumeJobMatch();
        }
        
    } catch (error) {
        console.error('âŒ Job description upload error:', error);
        showErrorMessage(`Failed to process job description: ${error.message}`);
        event.target.value = '';
        AppState.jobDescriptionAnalysis = null;
        updateJobDescriptionStatus(false);
    } finally {
        hideLoadingSpinner();
    }
}

// Validate uploaded file
function validateFile(file) {
    // Check file size
    if (file.size > CONFIG.MAX_FILE_SIZE) {
        showErrorMessage(`File size too large. Maximum size is ${CONFIG.MAX_FILE_SIZE / (1024 * 1024)}MB.`);
        return false;
    }
    
    // Check file type
    const fileExtension = file.name.split('.').pop().toLowerCase();
    if (!CONFIG.ALLOWED_FILE_TYPES.includes(fileExtension)) {
        return false;
    }
    
    return true;
}

// Extract text from file
async function extractTextFromFile(file) {
    return new Promise((resolve, reject) => {
        const fileExtension = file.name.split('.').pop().toLowerCase();
        
        if (fileExtension === 'txt') {
            // Handle text files
            const reader = new FileReader();
            reader.onload = function(e) {
                resolve(e.target.result);
            };
            reader.onerror = function() {
                reject(new Error('Failed to read text file'));
            };
            reader.readAsText(file);
        } else {
            // For PDF, DOC, DOCX files, send to backend for processing
            extractTextFromFileViaBackend(file)
                .then(resolve)
                .catch(reject);
        }
    });
}

// Extract text from file via backend
async function extractTextFromFileViaBackend(file) {
    try {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('action', 'extract_text');
        
        const response = await fetch(`${CONFIG.API_BASE_URL}${CONFIG.ENDPOINTS.JOB_TRACKER}`, {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        
        if (result.success && result.text) {
            return result.text;
        } else {
            throw new Error(result.error || 'Failed to extract text from file');
        }
        
    } catch (error) {
        console.error('âŒ Backend text extraction error:', error);
        throw new Error('Failed to process file. Please try a different format or check file integrity.');
    }
}

// Perform resume and job description matching
async function performResumeJobMatch() {
    if (!AppState.resumeAnalysis || !AppState.jobDescriptionAnalysis) {
        console.log('âš ï¸ Both resume and job description needed for matching');
        return;
    }
    
    console.log('ðŸ” Starting resume-job match analysis...');
    
    try {
        showLoadingSpinner();
        
        const analysisData = {
            action: 'analyze_resume_job_match',
            resumeText: AppState.resumeAnalysis.text,
            jobDescriptionText: AppState.jobDescriptionAnalysis.text,
            resumeFilename: AppState.resumeAnalysis.filename,
            jobDescriptionFilename: AppState.jobDescriptionAnalysis.filename,
            toolId: CONFIG.TOOL_ID
        };
        
        const response = await fetch(`${CONFIG.API_BASE_URL}${CONFIG.ENDPOINTS.JOB_TRACKER}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(analysisData)
        });
        
        const result = await response.json();
        
        if (result.success) {
            console.log('âœ… Resume-job match analysis completed:', result);
            
            // Display analysis results
            displayResumeJobMatchResults(result);
            
            // Show results container
            showResultsContainer();
            
            showSuccessMessage('Resume and job description analysis completed!');
            
        } else {
            throw new Error(result.error || 'Analysis failed');
        }
        
    } catch (error) {
        console.error('âŒ Resume-job match analysis error:', error);
        showErrorMessage(`Analysis failed: ${error.message}`);
    } finally {
        hideLoadingSpinner();
    }
}

// Display resume-job match results
function displayResumeJobMatchResults(analysisResult) {
    const resultsContainer = document.querySelector(CONFIG.SELECTORS.interviewPreview);
    if (!resultsContainer) return;
    
    const matchData = analysisResult.analysis || {};
    const overallScore = matchData.overall_score || 0;
    const strengths = matchData.strengths || [];
    const gaps = matchData.gaps || [];
    const recommendations = matchData.recommendations || [];
    
    const resultsHTML = `
        <div class="resume-job-analysis-results">
            <h4 class="mb-4">
                <i class="fas fa-chart-line me-2" style="color: #14697D;"></i>
                Resume & Job Description Match Analysis
            </h4>
            
            <!-- Overall Match Score -->
            <div class="match-score-section mb-4">
                <h5>Overall Match Score</h5>
                <div class="progress mb-2" style="height: 25px;">
                    <div class="progress-bar ${getScoreColor(overallScore)}" 
                         role="progressbar" 
                         style="width: ${overallScore}%">
                        <strong>${overallScore}%</strong>
                    </div>
                </div>
                <p class="small text-muted">${getScoreDescription(overallScore)}</p>
            </div>
            
            <!-- File Information -->
            <div class="file-info-section mb-4">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card border-0 bg-light">
                            <div class="card-body py-2">
                                <small class="text-muted">
                                    <i class="fas fa-file-pdf me-1"></i>
                                    Resume: ${AppState.resumeAnalysis.filename}
                                </small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card border-0 bg-light">
                            <div class="card-body py-2">
                                <small class="text-muted">
                                    <i class="fas fa-file-alt me-1"></i>
                                    Job Description: ${AppState.jobDescriptionAnalysis.filename}
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Analysis Sections -->
            <div class="row">
                <!-- Strengths -->
                <div class="col-md-6 mb-4">
                    <div class="analysis-section strengths-section">
                        <h6 class="text-success">
                            <i class="fas fa-check-circle me-2"></i>
                            Your Strengths (${strengths.length})
                        </h6>
                        ${strengths.length > 0 ? `
                            <ul class="list-unstyled">
                                ${strengths.map(strength => `
                                    <li class="mb-2">
                                        <i class="fas fa-plus text-success me-2"></i>
                                        <small>${strength}</small>
                                    </li>
                                `).join('')}
                            </ul>
                        ` : `
                            <p class="small text-muted">No specific strengths identified in this analysis.</p>
                        `}
                    </div>
                </div>
                
                <!-- Gaps -->
                <div class="col-md-6 mb-4">
                    <div class="analysis-section gaps-section">
                        <h6 class="text-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Areas to Address (${gaps.length})
                        </h6>
                        ${gaps.length > 0 ? `
                            <ul class="list-unstyled">
                                ${gaps.map(gap => `
                                    <li class="mb-2">
                                        <i class="fas fa-minus text-warning me-2"></i>
                                        <small>${gap}</small>
                                    </li>
                                `).join('')}
                            </ul>
                        ` : `
                            <p class="small text-muted">No significant gaps identified in this analysis.</p>
                        `}
                    </div>
                </div>
            </div>
            
            <!-- Recommendations -->
            ${recommendations.length > 0 ? `
                <div class="recommendations-section mb-4">
                    <h6 class="text-primary">
                        <i class="fas fa-lightbulb me-2"></i>
                        Recommendations for Improvement
                    </h6>
                    <div class="row">
                        ${recommendations.map((rec, index) => `
                            <div class="col-md-6 mb-3">
                                <div class="card border-0 bg-light h-100">
                                    <div class="card-body">
                                        <div class="d-flex align-items-start">
                                            <span class="badge bg-primary me-2">${index + 1}</span>
                                            <small>${rec}</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            ` : ''}
            
            <!-- Action Buttons -->
            <div class="action-buttons-section mt-4">
                <div class="row">
                    <div class="col-md-4 mb-2">
                        <button class="btn btn-outline-primary btn-sm w-100" onclick="generateTailoredResume()">
                            <i class="fas fa-edit me-1"></i>
                            Improve Resume
                        </button>
                    </div>
                    <div class="col-md-4 mb-2">
                        <button class="btn btn-outline-success btn-sm w-100" onclick="generateCoverLetter()">
                            <i class="fas fa-file-alt me-1"></i>
                            Cover Letter
                        </button>
                    </div>
                    <div class="col-md-4 mb-2">
                        <button class="btn btn-outline-info btn-sm w-100" onclick="prepareInterviewFromAnalysis()">
                            <i class="fas fa-comments me-1"></i>
                            Interview Prep
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Analysis Metadata -->
            <div class="analysis-metadata mt-4 pt-3 border-top">
                <small class="text-muted">
                    <i class="fas fa-info-circle me-1"></i>
                    Analysis completed on ${new Date().toLocaleString()} â€¢ 
                    Resume: ${AppState.resumeAnalysis.wordCount} words â€¢ 
                    Job Description: ${AppState.jobDescriptionAnalysis.wordCount} words
                </small>
            </div>
        </div>
    `;
    
    resultsContainer.innerHTML = resultsHTML;
    console.log('ðŸ“Š Resume-job match results displayed');
}

// Helper functions for analysis display
function getScoreColor(score) {
    if (score >= 80) return 'bg-success';
    if (score >= 60) return 'bg-warning';
    return 'bg-danger';
}

function getScoreDescription(score) {
    if (score >= 80) return 'Excellent match! Your resume aligns very well with this job.';
    if (score >= 60) return 'Good match with some areas for improvement.';
    if (score >= 40) return 'Moderate match. Consider highlighting relevant skills more prominently.';
    return 'Lower match. This role may require different skills or experience.';
}

// Update resume upload status in UI
function updateResumeUploadStatus(uploaded, filename = '') {
    const uploadLabel = document.querySelector('label[for="resumeUpload"]');
    if (uploadLabel) {
        if (uploaded) {
            uploadLabel.innerHTML = `
                <i class="fas fa-check-circle text-success me-2"></i>
                Resume uploaded: ${filename}
            `;
            uploadLabel.classList.add('text-success');
        } else {
            uploadLabel.innerHTML = `
                <i class="fas fa-upload me-2"></i>
                Upload Resume (PDF, DOC, DOCX, TXT)
            `;
            uploadLabel.classList.remove('text-success');
        }
    }
}

// Update job description status in UI
function updateJobDescriptionStatus(uploaded, filename = '') {
    const uploadLabel = document.querySelector('label[for="jobDescriptionFile"]');
    if (uploadLabel) {
        if (uploaded) {
            uploadLabel.innerHTML = `
                <i class="fas fa-check-circle text-success me-2"></i>
                Job description uploaded: ${filename}
            `;
            uploadLabel.classList.add('text-success');
        } else {
            uploadLabel.innerHTML = `
                <i class="fas fa-upload me-2"></i>
                Upload Job Description (PDF, DOC, DOCX, TXT)
            `;
            uploadLabel.classList.remove('text-success');
        }
    }
}

// Action functions for analysis results
async function generateTailoredResume() {
    if (!AppState.resumeAnalysis || !AppState.jobDescriptionAnalysis) {
        showErrorMessage('Both resume and job description are required for tailored resume generation.');
        return;
    }
    
    console.log('ðŸ“ Generating tailored resume...');
    showSuccessMessage('Tailored resume generation started! This feature will be implemented in the next version.');
}

async function generateCoverLetter() {
    if (!AppState.jobDescriptionAnalysis) {
        showErrorMessage('Job description is required for cover letter generation.');
        return;
    }
    
    console.log('ðŸ“„ Generating cover letter...');
    showSuccessMessage('Cover letter generation started! This feature will be implemented in the next version.');
}

async function prepareInterviewFromAnalysis() {
    if (!AppState.jobDescriptionAnalysis) {
        showErrorMessage('Job description is required for interview preparation.');
        return;
    }
    
    // Switch to interview tab and pre-fill data
    switchTab('interview');
    
    // Pre-fill interview prep form with job description data
    const jobDescriptionTextarea = document.getElementById('jobRequirements');
    if (jobDescriptionTextarea) {
        jobDescriptionTextarea.value = AppState.jobDescriptionAnalysis.text.substring(0, 1000); // First 1000 chars
    }
    
    showSuccessMessage('Switched to Interview Prep with job description pre-filled!');
}
// ============================================================================
// SECTION 5: INTERVIEW PREPARATION BOT
// ============================================================================

// Handle interview prep form submission
async function handleInterviewPrepSubmission(e) {
    e.preventDefault();
    
    console.log('ðŸŽ¤ Interview prep submission started...');
    
    // Check usage limits
    if (!canUseToolFeature()) {
        return;
    }
    
    try {
        showLoadingSpinner();
        
        // Collect form data
        const formData = new FormData(e.target);
        const prepData = Object.fromEntries(formData.entries());
        
        // Validate required fields
        if (!prepData.prepCompanyName || !prepData.prepJobTitle || !prepData.interviewType) {
            throw new Error('Please fill in company name, job title, and interview type.');
        }
        
        console.log('ðŸ“¤ Sending interview prep request:', prepData);
        
        // Prepare request data
        const requestData = {
            action: 'generate_interview_prep',
            toolId: CONFIG.TOOL_ID,
            ...prepData,
            timestamp: new Date().toISOString()
        };
        
        // Make API call
        const response = await fetch(`${CONFIG.API_BASE_URL}${CONFIG.ENDPOINTS.JOB_TRACKER}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(requestData)
        });
        
        const result = await response.json();
        
        if (result.success) {
            console.log('âœ… Interview prep generated successfully:', result);
            
            // Increment usage
            incrementUsage();
            
            // Store interview session data
            AppState.interviewSession = {
                active: true,
                prepData: prepData,
                generatedContent: result.content || result.preparation,
                currentQuestion: 0,
                questions: [],
                answers: [],
                feedback: [],
                startedAt: new Date().toISOString()
            };
            
            // Display the interview preparation
            displayInterviewPreparation(result);
            
            // Show results container
            showResultsContainer();
            
            showSuccessMessage('Interview preparation generated successfully!');
            
        } else {
            throw new Error(result.error || 'Failed to generate interview preparation');
        }
        
    } catch (error) {
        console.error('âŒ Interview prep error:', error);
        showErrorMessage(error.message || 'Failed to generate interview preparation. Please try again.');
    } finally {
        hideLoadingSpinner();
    }
}

// Display interview preparation content
function displayInterviewPreparation(result) {
    const interviewPreview = document.querySelector(CONFIG.SELECTORS.interviewPreview);
    if (!interviewPreview) return;
    
    const content = result.content || result.preparation || '';
    const metadata = result.metadata || {};
    
    // Format the content for better display
    const formattedContent = formatInterviewPreparationContent(content);
    
    const prepHTML = `
        <div class="interview-preparation-content">
            <div class="prep-header mb-4">
                <h4 class="mb-2">
                    <i class="fas fa-brain me-2" style="color: #14697D;"></i>
                    Interview Preparation Guide
                </h4>
                <div class="prep-metadata">
                    <span class="badge bg-primary me-2">${metadata.interviewType || 'General Interview'}</span>
                    <span class="badge bg-info me-2">${metadata.company || 'Company'}</span>
                    <span class="badge bg-success">${metadata.position || 'Position'}</span>
                </div>
            </div>
            
            <div class="prep-content">
                ${formattedContent}
            </div>
            
            <div class="prep-actions mt-4">
                <div class="row">
                    <div class="col-md-4 mb-2">
                        <button class="btn btn-primary btn-sm w-100" onclick="startInteractiveInterview()">
                            <i class="fas fa-play me-1"></i>
                            Start Practice Interview
                        </button>
                    </div>
                    <div class="col-md-4 mb-2">
                        <button class="btn btn-outline-secondary btn-sm w-100" onclick="generateMoreQuestions()">
                            <i class="fas fa-plus me-1"></i>
                            More Questions
                        </button>
                    </div>
                    <div class="col-md-4 mb-2">
                        <button class="btn btn-outline-info btn-sm w-100" onclick="generateCompanyResearch()">
                            <i class="fas fa-building me-1"></i>
                            Company Research
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="prep-footer mt-4 pt-3 border-top">
                <small class="text-muted">
                    <i class="fas fa-clock me-1"></i>
                    Generated on ${new Date().toLocaleString()} â€¢ 
                    Ready for your ${metadata.interviewType || 'interview'}
                </small>
            </div>
        </div>
    `;
    
    interviewPreview.innerHTML = prepHTML;
    console.log('ðŸ“‹ Interview preparation displayed');
}

// Format interview preparation content
function formatInterviewPreparationContent(content) {
    if (!content) return '<p>No content available.</p>';
    
    // Convert markdown-style formatting to HTML
    let formatted = content;
    
    // Headers
    formatted = formatted.replace(/^### (.*$)/gim, '<h5 class="mt-4 mb-3" style="color: #14697D;">$1</h5>');
    formatted = formatted.replace(/^## (.*$)/gim, '<h4 class="mt-4 mb-3" style="color: #14697D;">$1</h4>');
    formatted = formatted.replace(/^# (.*$)/gim, '<h3 class="mb-4" style="color: #14697D;">$1</h3>');
    
    // Bold text
    formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
    
    // Question format
    formatted = formatted.replace(/^\d+\.\s+\*\*(.*?)\*\*/gm, '<div class="interview-question"><strong>$1</strong></div>');
    
    // Bullet points
    formatted = formatted.replace(/^[-â€¢]\s+(.*$)/gm, '<li>$1</li>');
    
    // Wrap consecutive list items
    formatted = formatted.replace(/(<li>.*<\/li>(\s*<li>.*<\/li>)*)/gs, '<ul class="mb-3">$1</ul>');
    
    // Line breaks
    formatted = formatted.replace(/\n\n/g, '</p><p class="mb-3">');
    formatted = formatted.replace(/\n/g, '<br>');
    
    // Wrap in paragraphs
    if (!formatted.startsWith('<')) {
        formatted = '<p class="mb-3">' + formatted + '</p>';
    }
    
    // Clean up
    formatted = formatted.replace(/<p class="mb-3"><\/p>/g, '');
    formatted = formatted.replace(/<p class="mb-3"><br><\/p>/g, '');
    
    return formatted;
}

// Start interactive interview session
async function startInteractiveInterview() {
    console.log('ðŸŽ¯ Starting interactive interview session...');
    
    if (!AppState.interviewSession.active) {
        showErrorMessage('No interview preparation session active. Please generate interview prep first.');
        return;
    }
    
    try {
        showLoadingSpinner();
        
        // Generate interactive questions
        const questionsData = {
            action: 'generate_interactive_questions',
            toolId: CONFIG.TOOL_ID,
            prepData: AppState.interviewSession.prepData,
            questionCount: 5
        };
        
        const response = await fetch(`${CONFIG.API_BASE_URL}${CONFIG.ENDPOINTS.JOB_TRACKER}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(questionsData)
        });
        
        const result = await response.json();
        
        if (result.success && result.questions) {
            // Store questions in session
            AppState.interviewSession.questions = result.questions;
            AppState.interviewSession.currentQuestion = 0;
            AppState.interviewSession.answers = [];
            AppState.interviewSession.feedback = [];
            
            // Display first question
            displayInteractiveQuestion(0);
            
            showSuccessMessage('Interactive interview started! Answer each question to receive personalized feedback.');
            
        } else {
            throw new Error(result.error || 'Failed to generate interactive questions');
        }
        
    } catch (error) {
        console.error('âŒ Interactive interview start error:', error);
        showErrorMessage(error.message || 'Failed to start interactive interview. Please try again.');
    } finally {
        hideLoadingSpinner();
    }
}

// Display interactive question
function displayInteractiveQuestion(questionIndex) {
    const interviewPreview = document.querySelector(CONFIG.SELECTORS.interviewPreview);
    if (!interviewPreview) return;
    
    const questions = AppState.interviewSession.questions;
    const currentQuestion = questions[questionIndex];
    const totalQuestions = questions.length;
    
    if (!currentQuestion) {
        displayInterviewComplete();
        return;
    }
    
    const questionHTML = `
        <div class="interactive-interview-session">
            <div class="interview-header mb-4">
                <h4 class="mb-2">
                    <i class="fas fa-comments me-2" style="color: #14697D;"></i>
                    Practice Interview Session
                </h4>
                <div class="progress mb-3">
                    <div class="progress-bar bg-primary" role="progressbar" 
                         style="width: ${((questionIndex + 1) / totalQuestions) * 100}%">
                        Question ${questionIndex + 1} of ${totalQuestions}
                    </div>
                </div>
            </div>
            
            <div class="current-question-container">
                <div class="question-card card border-primary mb-4">
                    <div class="card-header bg-primary text-white">
                        <h6 class="mb-0">
                            <i class="fas fa-question-circle me-2"></i>
                            Question ${questionIndex + 1}
                        </h6>
                    </div>
                    <div class="card-body">
                        <p class="card-text">${currentQuestion.question}</p>
                        ${currentQuestion.type ? `<small class="text-muted">Type: ${currentQuestion.type}</small>` : ''}
                    </div>
                </div>
                
                <div class="answer-input-section">
                    <label for="userAnswer" class="form-label">
                        <strong>Your Answer:</strong>
                    </label>
                    <textarea 
                        id="userAnswer" 
                        class="form-control mb-3" 
                        rows="4" 
                        placeholder="Type your answer here... Take your time to think through your response."
                    ></textarea>
                    
                    <div class="answer-actions">
                        <button class="btn btn-primary submit-answer-btn" data-question-index="${questionIndex}">
                            <i class="fas fa-paper-plane me-1"></i>
                            Submit Answer
                        </button>
                        <button class="btn btn-outline-secondary ms-2" onclick="skipQuestion(${questionIndex})">
                            <i class="fas fa-forward me-1"></i>
                            Skip Question
                        </button>
                    </div>
                </div>
                
                ${questionIndex > 0 ? `
                    <div class="previous-qa-summary mt-4 pt-3 border-top">
                        <h6 class="text-muted">Previous Questions Answered: ${questionIndex}</h6>
                    </div>
                ` : ''}
            </div>
        </div>
    `;
    
    interviewPreview.innerHTML = questionHTML;
    
    // Focus on answer textarea
    setTimeout(() => {
        const answerTextarea = document.getElementById('userAnswer');
        if (answerTextarea) {
            answerTextarea.focus();
        }
    }, 100);
    
    console.log(`â“ Displaying question ${questionIndex + 1}/${totalQuestions}`);
}

// Handle answer submission
async function handleAnswerSubmission(event) {
    const questionIndex = parseInt(event.target.getAttribute('data-question-index'));
    const answerTextarea = document.getElementById('userAnswer');
    
    if (!answerTextarea) {
        showErrorMessage('Answer input not found.');
        return;
   }
   
   const userAnswer = answerTextarea.value.trim();
   
   if (!userAnswer) {
       showErrorMessage('Please provide an answer before submitting.');
       answerTextarea.focus();
       return;
   }
   
   if (userAnswer.length < 10) {
       showErrorMessage('Please provide a more detailed answer (at least 10 characters).');
       answerTextarea.focus();
       return;
   }
   
   console.log(`ðŸ“ Submitting answer for question ${questionIndex + 1}:`, userAnswer);
   
   try {
       showLoadingSpinner();
       
       const currentQuestion = AppState.interviewSession.questions[questionIndex];
       
       // Prepare feedback request
       const feedbackData = {
           action: 'evaluate_interview_answer',
           toolId: CONFIG.TOOL_ID,
           question: currentQuestion.question,
           questionType: currentQuestion.type,
           userAnswer: userAnswer,
           interviewContext: {
               company: AppState.interviewSession.prepData.prepCompanyName,
               position: AppState.interviewSession.prepData.prepJobTitle,
               interviewType: AppState.interviewSession.prepData.interviewType
           }
       };
       
       const response = await fetch(`${CONFIG.API_BASE_URL}${CONFIG.ENDPOINTS.JOB_TRACKER}`, {
           method: 'POST',
           headers: {
               'Content-Type': 'application/json',
           },
           body: JSON.stringify(feedbackData)
       });
       
       const result = await response.json();
       
       if (result.success) {
           // Store answer and feedback
           AppState.interviewSession.answers[questionIndex] = userAnswer;
           AppState.interviewSession.feedback[questionIndex] = result.feedback;
           
           // Display feedback
           displayAnswerFeedback(questionIndex, userAnswer, result.feedback);
           
           console.log('âœ… Answer feedback received:', result.feedback);
           
       } else {
           throw new Error(result.error || 'Failed to get feedback');
       }
       
   } catch (error) {
       console.error('âŒ Answer submission error:', error);
       showErrorMessage(error.message || 'Failed to submit answer. Please try again.');
   } finally {
       hideLoadingSpinner();
   }
}

// Display answer feedback
function displayAnswerFeedback(questionIndex, userAnswer, feedback) {
   const interviewPreview = document.querySelector(CONFIG.SELECTORS.interviewPreview);
   if (!interviewPreview) return;
   
   const questions = AppState.interviewSession.questions;
   const totalQuestions = questions.length;
   const isLastQuestion = questionIndex >= totalQuestions - 1;
   
   const feedbackHTML = `
       <div class="answer-feedback-session">
           <div class="interview-header mb-4">
               <h4 class="mb-2">
                   <i class="fas fa-comments me-2" style="color: #14697D;"></i>
                   Interview Feedback - Question ${questionIndex + 1}
               </h4>
               <div class="progress mb-3">
                   <div class="progress-bar bg-success" role="progressbar" 
                        style="width: ${((questionIndex + 1) / totalQuestions) * 100}%">
                       ${questionIndex + 1} of ${totalQuestions} completed
                   </div>
               </div>
           </div>
           
           <div class="feedback-content">
               <!-- Question Recap -->
               <div class="question-recap card border-light mb-3">
                   <div class="card-header bg-light">
                       <h6 class="mb-0">
                           <i class="fas fa-question-circle me-2"></i>
                           Question
                       </h6>
                   </div>
                   <div class="card-body">
                       <p class="mb-0">${questions[questionIndex].question}</p>
                   </div>
               </div>
               
               <!-- User Answer -->
               <div class="user-answer card border-primary mb-3">
                   <div class="card-header bg-primary text-white">
                       <h6 class="mb-0">
                           <i class="fas fa-user me-2"></i>
                           Your Answer
                       </h6>
                   </div>
                   <div class="card-body">
                       <p class="mb-0">${userAnswer}</p>
                   </div>
               </div>
               
               <!-- AI Feedback -->
               <div class="ai-feedback card border-success mb-4">
                   <div class="card-header bg-success text-white">
                       <h6 class="mb-0">
                           <i class="fas fa-robot me-2"></i>
                           AI Feedback & Suggestions
                       </h6>
                   </div>
                   <div class="card-body">
                       ${formatFeedbackContent(feedback)}
                   </div>
               </div>
               
               <!-- Navigation -->
               <div class="navigation-section">
                   <div class="row">
                       <div class="col-md-6 mb-2">
                           ${!isLastQuestion ? `
                               <button class="btn btn-primary w-100 next-question-btn" data-next-index="${questionIndex + 1}">
                                   <i class="fas fa-arrow-right me-1"></i>
                                   Next Question (${questionIndex + 2}/${totalQuestions})
                               </button>
                           ` : `
                               <button class="btn btn-success w-100 finish-interview-btn">
                                   <i class="fas fa-check me-1"></i>
                                   Complete Interview
                               </button>
                           `}
                       </div>
                       <div class="col-md-6 mb-2">
                           <button class="btn btn-outline-secondary w-100" onclick="showInterviewSummary()">
                               <i class="fas fa-chart-bar me-1"></i>
                               View Progress
                           </button>
                       </div>
                   </div>
               </div>
           </div>
       </div>
   `;
   
   interviewPreview.innerHTML = feedbackHTML;
   console.log(`ðŸ’¬ Feedback displayed for question ${questionIndex + 1}`);
}

// Format feedback content
function formatFeedbackContent(feedback) {
   if (typeof feedback === 'string') {
       return `<p>${feedback}</p>`;
   }
   
   if (typeof feedback === 'object') {
       let html = '';
       
       if (feedback.score) {
           html += `
               <div class="feedback-score mb-3">
                   <div class="d-flex justify-content-between align-items-center mb-2">
                       <span>Answer Quality:</span>
                       <span class="badge ${getScoreColor(feedback.score)}">${feedback.score}/10</span>
                   </div>
                   <div class="progress" style="height: 8px;">
                       <div class="progress-bar ${getScoreColor(feedback.score)}" 
                            style="width: ${feedback.score * 10}%"></div>
                   </div>
               </div>
           `;
       }
       
       if (feedback.strengths && feedback.strengths.length > 0) {
           html += `
               <div class="feedback-strengths mb-3">
                   <h6 class="text-success">
                       <i class="fas fa-thumbs-up me-1"></i>
                       What you did well:
                   </h6>
                   <ul class="list-unstyled">
                       ${feedback.strengths.map(strength => `
                           <li class="mb-1">
                               <i class="fas fa-check text-success me-2"></i>
                               <small>${strength}</small>
                           </li>
                       `).join('')}
                   </ul>
               </div>
           `;
       }
       
       if (feedback.improvements && feedback.improvements.length > 0) {
           html += `
               <div class="feedback-improvements mb-3">
                   <h6 class="text-warning">
                       <i class="fas fa-lightbulb me-1"></i>
                       Areas for improvement:
                   </h6>
                   <ul class="list-unstyled">
                       ${feedback.improvements.map(improvement => `
                           <li class="mb-1">
                               <i class="fas fa-arrow-up text-warning me-2"></i>
                               <small>${improvement}</small>
                           </li>
                       `).join('')}
                   </ul>
               </div>
           `;
       }
       
       if (feedback.suggestion) {
           html += `
               <div class="feedback-suggestion">
                   <h6 class="text-info">
                       <i class="fas fa-star me-1"></i>
                       Better approach:
                   </h6>
                   <p class="small bg-light p-2 rounded">${feedback.suggestion}</p>
               </div>
           `;
       }
       
       return html || '<p>Feedback received successfully.</p>';
   }
   
   return '<p>Feedback received successfully.</p>';
}

// Show next question
function showNextQuestion(event) {
   const nextIndex = parseInt(event.target.getAttribute('data-next-index'));
   AppState.interviewSession.currentQuestion = nextIndex;
   displayInteractiveQuestion(nextIndex);
}

// Skip question
function skipQuestion(questionIndex) {
   if (confirm('Are you sure you want to skip this question? You can always come back to it later.')) {
       AppState.interviewSession.answers[questionIndex] = '[SKIPPED]';
       
       const nextIndex = questionIndex + 1;
       if (nextIndex < AppState.interviewSession.questions.length) {
           AppState.interviewSession.currentQuestion = nextIndex;
           displayInteractiveQuestion(nextIndex);
       } else {
           finishInterviewSession();
       }
   }
}

// Finish interview session
function finishInterviewSession() {
   console.log('ðŸ Finishing interview session...');
   displayInterviewComplete();
}

// Display interview completion
function displayInterviewComplete() {
   const interviewPreview = document.querySelector(CONFIG.SELECTORS.interviewPreview);
   if (!interviewPreview) return;
   
   const session = AppState.interviewSession;
   const totalQuestions = session.questions.length;
   const answeredQuestions = session.answers.filter(answer => answer && answer !== '[SKIPPED]').length;
   const skippedQuestions = session.answers.filter(answer => answer === '[SKIPPED]').length;
   
   // Calculate average score if available
   let averageScore = 0;
   let scoredAnswers = 0;
   session.feedback.forEach(feedback => {
       if (feedback && feedback.score) {
           averageScore += feedback.score;
           scoredAnswers++;
       }
   });
   averageScore = scoredAnswers > 0 ? Math.round(averageScore / scoredAnswers) : 0;
   
   const completionHTML = `
       <div class="interview-completion">
           <div class="completion-header text-center mb-4">
               <div class="completion-icon mb-3">
                   <i class="fas fa-trophy" style="font-size: 4rem; color: #FFD700;"></i>
               </div>
               <h3 class="text-success mb-2">Interview Practice Complete!</h3>
               <p class="text-muted">Great job completing your interview preparation session.</p>
           </div>
           
           <div class="completion-stats mb-4">
               <div class="row text-center">
                   <div class="col-md-3 mb-3">
                       <div class="stat-card card border-0 bg-primary text-white h-100">
                           <div class="card-body">
                               <h4 class="mb-1">${totalQuestions}</h4>
                               <small>Total Questions</small>
                           </div>
                       </div>
                   </div>
                   <div class="col-md-3 mb-3">
                       <div class="stat-card card border-0 bg-success text-white h-100">
                           <div class="card-body">
                               <h4 class="mb-1">${answeredQuestions}</h4>
                               <small>Answered</small>
                           </div>
                       </div>
                   </div>
                   <div class="col-md-3 mb-3">
                       <div class="stat-card card border-0 bg-warning text-white h-100">
                           <div class="card-body">
                               <h4 class="mb-1">${skippedQuestions}</h4>
                               <small>Skipped</small>
                           </div>
                       </div>
                   </div>
                   <div class="col-md-3 mb-3">
                       <div class="stat-card card border-0 bg-info text-white h-100">
                           <div class="card-body">
                               <h4 class="mb-1">${averageScore}/10</h4>
                               <small>Avg Score</small>
                           </div>
                       </div>
                   </div>
               </div>
           </div>
           
           <div class="completion-actions mb-4">
               <div class="row">
                   <div class="col-md-4 mb-2">
                       <button class="btn btn-primary w-100" onclick="showDetailedReview()">
                           <i class="fas fa-chart-line me-1"></i>
                           Detailed Review
                       </button>
                   </div>
                   <div class="col-md-4 mb-2">
                       <button class="btn btn-outline-success w-100" onclick="generateImprovementPlan()">
                           <i class="fas fa-road me-1"></i>
                           Improvement Plan
                       </button>
                   </div>
                   <div class="col-md-4 mb-2">
                       <button class="btn btn-outline-info w-100" onclick="startNewInterview()">
                           <i class="fas fa-redo me-1"></i>
                           Practice Again
                       </button>
                   </div>
               </div>
           </div>
           
           <div class="completion-tips card border-0 bg-light">
               <div class="card-body">
                   <h6 class="text-primary">
                       <i class="fas fa-lightbulb me-2"></i>
                       Next Steps for Interview Success:
                   </h6>
                   <ul class="list-unstyled mb-0">
                       <li class="mb-2">
                           <i class="fas fa-check text-success me-2"></i>
                           Review your answers and incorporate the AI feedback
                       </li>
                       <li class="mb-2">
                           <i class="fas fa-check text-success me-2"></i>
                           Practice your responses out loud to improve delivery
                       </li>
                       <li class="mb-2">
                           <i class="fas fa-check text-success me-2"></i>
                           Research the company further using our Company Research tool
                       </li>
                       <li class="mb-0">
                           <i class="fas fa-check text-success me-2"></i>
                           Prepare thoughtful questions to ask the interviewer
                       </li>
                   </ul>
               </div>
           </div>
           
           <div class="completion-footer mt-4 pt-3 border-top text-center">
               <small class="text-muted">
                   <i class="fas fa-calendar me-1"></i>
                   Session completed on ${new Date().toLocaleString()} â€¢ 
                   Duration: ${calculateSessionDuration()} â€¢ 
                   Keep practicing for the best results!
               </small>
           </div>
       </div>
   `;
   
   interviewPreview.innerHTML = completionHTML;
   console.log('ðŸŽ‰ Interview completion displayed');
}

// Calculate session duration
function calculateSessionDuration() {
   if (!AppState.interviewSession.startedAt) {
       return 'Unknown';
   }
   
   const startTime = new Date(AppState.interviewSession.startedAt);
   const endTime = new Date();
   const durationMs = endTime - startTime;
   const durationMinutes = Math.round(durationMs / (1000 * 60));
   
   if (durationMinutes < 1) {
       return '< 1 minute';
   } else if (durationMinutes === 1) {
       return '1 minute';
   } else {
       return `${durationMinutes} minutes`;
   }
}

// Initialize interview prep
function initializeInterviewPrep() {
   console.log('ðŸŽ¤ Initializing interview prep...');
   
   // Reset interview session if needed
   if (!AppState.interviewSession.active) {
       AppState.interviewSession = {
           active: false,
           currentQuestion: 0,
           questions: [],
           answers: [],
           feedback: []
       };
   }
}

// Reset interview prep
function resetInterviewPrep() {
   AppState.interviewSession = {
       active: false,
       currentQuestion: 0,
       questions: [],
       answers: [],
       feedback: []
   };
   
   hideResultsContainer();
   
   const form = document.querySelector(CONFIG.SELECTORS.interviewPrepForm);
   if (form) {
       form.reset();
   }
   
   showSuccessMessage('Interview prep reset. You can start a new session.');
   console.log('ðŸ”„ Interview prep reset');
}

// Additional interview features
async function generateMoreQuestions() {
   console.log('â“ Generating additional questions...');
   showSuccessMessage('Additional questions feature coming soon!');
}

async function generateCompanyResearch() {
   console.log('ðŸ¢ Generating company research...');
   showSuccessMessage('Company research feature coming soon!');
}

function showDetailedReview() {
   console.log('ðŸ“Š Showing detailed review...');
   showSuccessMessage('Detailed review feature coming soon!');
}

function generateImprovementPlan() {
   console.log('ðŸ“ˆ Generating improvement plan...');
   showSuccessMessage('Improvement plan feature coming soon!');
}

function startNewInterview() {
   resetInterviewPrep();
   switchTab('interview');
}
// ============================================================================
// SECTION 6: ACTION HANDLERS AND EXPORT FUNCTIONS
// ============================================================================

// Application action handlers
async function editApplication(applicationId) {
    console.log('âœï¸ Editing application:', applicationId);
    
    const application = AppState.jobApplications.find(app => app.id === applicationId);
    if (!application) {
        showErrorMessage('Application not found.');
        return;
    }
    
    // Switch to add tab and populate form
    switchTab('add');
    
    // Populate form fields
    populateFormWithApplication(application);
    
    showSuccessMessage(`Editing application for ${application.jobTitle} at ${application.companyName}`);
}

function populateFormWithApplication(application) {
    // Populate basic fields
    const fields = {
        'companyName': application.companyName,
        'jobTitle': application.jobTitle,
        'jobLocation': application.jobLocation,
        'applicationDate': application.applicationDate,
        'salaryRange': application.salaryRange,
        'jobSource': application.jobSource,
        'jobDescription': application.jobDescription,
        'applicationNotes': application.applicationNotes
    };
    
    Object.entries(fields).forEach(([fieldId, value]) => {
        const field = document.getElementById(fieldId);
        if (field && value) {
            field.value = value;
        }
    });
    
    // Set job type selection
    if (application.jobType) {
        const jobTypeCard = document.querySelector(`[data-type="${application.jobType}"]`);
        if (jobTypeCard) {
            document.querySelectorAll(CONFIG.SELECTORS.jobTypeCards).forEach(card => 
                card.classList.remove('selected')
            );
            jobTypeCard.classList.add('selected');
            
            const selectedJobTypeInput = document.querySelector(CONFIG.SELECTORS.selectedJobType);
            if (selectedJobTypeInput) {
                selectedJobTypeInput.value = application.jobType;
            }
        }
    }
    
    // Set status selection
    if (application.status) {
        const statusOption = document.querySelector(`[data-status="${application.status}"]`);
        if (statusOption) {
            document.querySelectorAll(CONFIG.SELECTORS.statusOptions).forEach(option => 
                option.classList.remove('selected')
            );
            statusOption.classList.add('selected');
            
            const selectedStatusInput = document.querySelector(CONFIG.SELECTORS.selectedStatus);
            if (selectedStatusInput) {
                selectedStatusInput.value = application.status;
            }
        }
    }
}

async function prepareInterviewForApplication(applicationId) {
    console.log('ðŸŽ¤ Preparing interview for application:', applicationId);
    
    const application = AppState.jobApplications.find(app => app.id === applicationId);
    if (!application) {
        showErrorMessage('Application not found.');
        return;
    }
    
    // Switch to interview tab
    switchTab('interview');
    
    // Pre-populate interview prep form
    const prepForm = document.querySelector(CONFIG.SELECTORS.interviewPrepForm);
    if (prepForm) {
        const fields = {
            'prepCompanyName': application.companyName,
            'prepJobTitle': application.jobTitle,
            'jobRequirements': application.jobDescription || '',
            'prepNotes': `Interview preparation for ${application.jobTitle} position at ${application.companyName}.`
        };
        
        Object.entries(fields).forEach(([fieldId, value]) => {
            const field = document.getElementById(fieldId);
            if (field && value) {
                field.value = value;
            }
        });
    }
    
    showSuccessMessage(`Interview prep pre-filled for ${application.jobTitle} at ${application.companyName}`);
}

async function analyzeApplication(applicationId) {
    console.log('ðŸ“Š Analyzing application:', applicationId);
    
    const application = AppState.jobApplications.find(app => app.id === applicationId);
    if (!application) {
        showErrorMessage('Application not found.');
        return;
    }
    
    try {
        showLoadingSpinner();
        
        const analysisData = {
            action: 'analyze_application',
            toolId: CONFIG.TOOL_ID,
            application: application
        };
        
        const response = await fetch(`${CONFIG.API_BASE_URL}${CONFIG.ENDPOINTS.JOB_TRACKER}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(analysisData)
        });
        
        const result = await response.json();
        
        if (result.success) {
            displayApplicationAnalysis(application, result.analysis);
            showResultsContainer();
            showSuccessMessage('Application analysis completed!');
        } else {
            throw new Error(result.error || 'Analysis failed');
        }
        
    } catch (error) {
        console.error('âŒ Application analysis error:', error);
        showErrorMessage(`Analysis failed: ${error.message}`);
    } finally {
        hideLoadingSpinner();
    }
}

function displayApplicationAnalysis(application, analysis) {
    const interviewPreview = document.querySelector(CONFIG.SELECTORS.interviewPreview);
    if (!interviewPreview) return;
    
    const analysisHTML = `
        <div class="application-analysis-results">
            <h4 class="mb-4">
                <i class="fas fa-chart-bar me-2" style="color: #14697D;"></i>
                Application Analysis: ${application.jobTitle}
            </h4>
            
            <div class="analysis-content">
                <div class="card mb-4">
                    <div class="card-header">
                        <h6 class="mb-0">Application Overview</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Company:</strong> ${application.companyName}</p>
                                <p><strong>Position:</strong> ${application.jobTitle}</p>
                                <p><strong>Status:</strong> ${formatStatus(application.status)}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Applied:</strong> ${formatDate(application.applicationDate)}</p>
                                <p><strong>Source:</strong> ${application.jobSource || 'Unknown'}</p>
                                <p><strong>Location:</strong> ${application.jobLocation || 'Not specified'}</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="analysis-insights">
                    ${typeof analysis === 'string' ? 
                        `<div class="card"><div class="card-body">${analysis}</div></div>` :
                        formatAnalysisInsights(analysis)
                    }
                </div>
            </div>
        </div>
    `;
    
    interviewPreview.innerHTML = analysisHTML;
}

function formatAnalysisInsights(analysis) {
    // Format analysis object into HTML
    let html = '';
    
    if (analysis.recommendations) {
        html += `
            <div class="card mb-3">
                <div class="card-header">
                    <h6 class="mb-0 text-primary">Recommendations</h6>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        ${analysis.recommendations.map(rec => `
                            <li class="mb-2">
                                <i class="fas fa-lightbulb text-warning me-2"></i>
                                ${rec}
                            </li>
                        `).join('')}
                    </ul>
                </div>
            </div>
        `;
    }
    
    if (analysis.nextSteps) {
        html += `
            <div class="card mb-3">
                <div class="card-header">
                    <h6 class="mb-0 text-success">Next Steps</h6>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        ${analysis.nextSteps.map(step => `
                            <li class="mb-2">
                                <i class="fas fa-arrow-right text-success me-2"></i>
                                ${step}
                            </li>
                        `).join('')}
                    </ul>
                </div>
            </div>
        `;
    }
    
    return html || '<div class="card"><div class="card-body">Analysis completed successfully.</div></div>';
}

async function updateApplicationStatus(applicationId) {
    console.log('ðŸ”„ Updating application status:', applicationId);
    
    const application = AppState.jobApplications.find(app => app.id === applicationId);
    if (!application) {
        showErrorMessage('Application not found.');
        return;
    }
    
    // Show status update modal or prompt
    const newStatus = prompt(`Update status for ${application.jobTitle} at ${application.companyName}:\n\nCurrent status: ${formatStatus(application.status)}\n\nEnter new status (applied/review/interview/offer/rejected/accepted):`, application.status);
    
    if (newStatus && newStatus !== application.status) {
        const validStatuses = ['applied', 'review', 'interview', 'offer', 'rejected', 'accepted'];
        
        if (validStatuses.includes(newStatus.toLowerCase())) {
            // Update application status
            application.status = newStatus.toLowerCase();
            application.updatedAt = new Date().toISOString();
            
            // Save to localStorage
            updateApplicationInLocalStorage(application);
            
            // Refresh display
            loadJobApplications();
            
            showSuccessMessage(`Status updated to "${formatStatus(newStatus)}" for ${application.jobTitle}`);
        } else {
            showErrorMessage('Invalid status. Please use: applied, review, interview, offer, rejected, or accepted.');
        }
    }
}

function updateApplicationInLocalStorage(updatedApplication) {
    try {
        const applications = getLocalJobApplications();
        const index = applications.findIndex(app => app.id === updatedApplication.id);
        
        if (index !== -1) {
            applications[index] = updatedApplication;
            localStorage.setItem('job_tracker_applications', JSON.stringify(applications));
            AppState.jobApplications = applications;
        }
    } catch (error) {
        console.error('âŒ Error updating application in localStorage:', error);
    }
}

async function duplicateApplication(applicationId) {
    console.log('ðŸ“‹ Duplicating application:', applicationId);
    
    const application = AppState.jobApplications.find(app => app.id === applicationId);
    if (!application) {
        showErrorMessage('Application not found.');
        return;
    }
    
    // Create duplicate with new ID
    const duplicate = {
        ...application,
        id: generateApplicationId(),
        companyName: `${application.companyName} (Copy)`,
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString(),
        status: 'applied'
    };
    
    // Save duplicate
    const applications = getLocalJobApplications();
    applications.push(duplicate);
    localStorage.setItem('job_tracker_applications', JSON.stringify(applications));
    AppState.jobApplications = applications;
    
    // Refresh display
    loadJobApplications();
    
    showSuccessMessage(`Application duplicated: ${duplicate.jobTitle} at ${duplicate.companyName}`);
}

async function deleteApplication(applicationId) {
    console.log('ðŸ—‘ï¸ Deleting application:', applicationId);
    
    const application = AppState.jobApplications.find(app => app.id === applicationId);
    if (!application) {
        showErrorMessage('Application not found.');
        return;
    }
    
    if (confirm(`Are you sure you want to delete the application for ${application.jobTitle} at ${application.companyName}?\n\nThis action cannot be undone.`)) {
        // Remove from localStorage
        const applications = getLocalJobApplications();
        const filteredApplications = applications.filter(app => app.id !== applicationId);
        localStorage.setItem('job_tracker_applications', JSON.stringify(filteredApplications));
        AppState.jobApplications = filteredApplications;
        
        // Refresh display
        loadJobApplications();
        
        showSuccessMessage(`Application deleted: ${application.jobTitle} at ${application.companyName}`);
    }
}

// Export and utility functions
async function exportToPDF() {
    console.log('ðŸ“„ Exporting to PDF...');
    
    const content = document.querySelector(CONFIG.SELECTORS.interviewPreview);
    if (!content) {
        showErrorMessage('No content available to export.');
        return;
    }
    
    try {
        // Create printable HTML
        const printableContent = `
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="utf-8">
                <title>JobTracker Export</title>
                <style>
                    body { font-family: Arial, sans-serif; line-height: 1.6;
                    margin: 1in; color: #333; }
                   h1, h2, h3, h4, h5, h6 { color: #14697D; margin-top: 1em; margin-bottom: 0.5em; }
                   .card { border: 1px solid #ddd; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; }
                   .card-header { background-color: #f8f9fa; padding: 0.75rem; margin: -1rem -1rem 1rem -1rem; border-bottom: 1px solid #ddd; font-weight: bold; }
                   .progress { background-color: #f0f0f0; height: 20px; border-radius: 10px; margin: 0.5rem 0; }
                   .progress-bar { background-color: #14697D; height: 100%; border-radius: 10px; text-align: center; line-height: 20px; color: white; }
                   .badge { padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.875rem; }
                   .bg-primary { background-color: #14697D !important; color: white; }
                   .bg-success { background-color: #28a745 !important; color: white; }
                   .bg-warning { background-color: #ffc107 !important; color: black; }
                   .bg-info { background-color: #17a2b8 !important; color: white; }
                   .text-success { color: #28a745 !important; }
                   .text-warning { color: #ffc107 !important; }
                   .text-danger { color: #dc3545 !important; }
                   .interview-question { background-color: #f8f9fa; border-left: 4px solid #14697D; padding: 1rem; margin: 1rem 0; }
                   ul { padding-left: 1.5rem; }
                   li { margin-bottom: 0.5rem; }
                   .d-none { display: none !important; }
                   @media print { body { margin: 0.5in; } }
               </style>
           </head>
           <body>
               <div class="header" style="text-align: center; border-bottom: 2px solid #14697D; padding-bottom: 1rem; margin-bottom: 2rem;">
                   <h1>JobTracker Export</h1>
                   <p>Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}</p>
               </div>
               ${content.innerHTML}
               <div class="footer" style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #ddd; text-align: center; color: #666;">
                   <small>Exported from JobTracker - Job Application Tracker & Interview Prep Tool</small>
               </div>
           </body>
           </html>
       `;
       
       // Create blob and download
       const blob = new Blob([printableContent], { type: 'text/html' });
       const url = URL.createObjectURL(blob);
       
       const link = document.createElement('a');
       link.href = url;
       link.download = `JobTracker-Export-${new Date().toISOString().slice(0,10)}.html`;
       document.body.appendChild(link);
       link.click();
       document.body.removeChild(link);
       
       URL.revokeObjectURL(url);
       
       showSuccessMessage('Content exported successfully! Check your downloads folder.');
       
   } catch (error) {
       console.error('âŒ Export error:', error);
       showErrorMessage('Failed to export content. Please try again.');
   }
}

async function copyToClipboard() {
   console.log('ðŸ“‹ Copying to clipboard...');
   
   const content = document.querySelector(CONFIG.SELECTORS.interviewPreview);
   if (!content) {
       showErrorMessage('No content available to copy.');
       return;
   }
   
   try {
       // Extract text content
       const textContent = content.innerText || content.textContent;
       
       // Copy to clipboard
       await navigator.clipboard.writeText(textContent);
       
       showSuccessMessage('Content copied to clipboard successfully!');
       
   } catch (error) {
       console.error('âŒ Clipboard error:', error);
       
       // Fallback method
       try {
           const textArea = document.createElement('textarea');
           textArea.value = content.innerText || content.textContent;
           textArea.style.position = 'fixed';
           textArea.style.opacity = '0';
           document.body.appendChild(textArea);
           textArea.select();
           document.execCommand('copy');
           document.body.removeChild(textArea);
           
           showSuccessMessage('Content copied to clipboard successfully!');
       } catch (fallbackError) {
           showErrorMessage('Failed to copy content to clipboard. Please manually select and copy.');
       }
   }
}

async function savePreparation() {
   console.log('ðŸ’¾ Saving preparation...');
   
   const content = document.querySelector(CONFIG.SELECTORS.interviewPreview);
   if (!content) {
       showErrorMessage('No content available to save.');
       return;
   }
   
   try {
       // Get current preparation data
       const preparationData = {
           id: generateApplicationId(),
           type: 'interview_preparation',
           content: content.innerHTML,
           textContent: content.innerText || content.textContent,
           createdAt: new Date().toISOString(),
           sessionData: AppState.interviewSession.active ? {
               prepData: AppState.interviewSession.prepData,
               questions: AppState.interviewSession.questions,
               answers: AppState.interviewSession.answers,
               feedback: AppState.interviewSession.feedback
           } : null
       };
       
       // Save to localStorage
       const savedPreparations = JSON.parse(localStorage.getItem('job_tracker_preparations') || '[]');
       savedPreparations.push(preparationData);
       localStorage.setItem('job_tracker_preparations', JSON.stringify(savedPreparations));
       
       showSuccessMessage('Interview preparation saved successfully! You can access it later from your saved preparations.');
       
       console.log('ðŸ’¾ Preparation saved:', preparationData);
       
   } catch (error) {
       console.error('âŒ Save preparation error:', error);
       showErrorMessage('Failed to save preparation. Please try again.');
   }
}

// Job search insights generation
async function generateJobSearchInsights() {
   console.log('ðŸ“Š Generating job search insights...');
   
   if (AppState.jobApplications.length === 0) {
       showErrorMessage('No job applications found. Add some applications first to generate insights.');
       return;
   }
   
   try {
       showLoadingSpinner();
       
       const insightsData = {
           action: 'generate_job_search_insights',
           toolId: CONFIG.TOOL_ID,
           applications: AppState.jobApplications,
           totalApplications: AppState.jobApplications.length
       };
       
       const response = await fetch(`${CONFIG.API_BASE_URL}${CONFIG.ENDPOINTS.JOB_TRACKER}`, {
           method: 'POST',
           headers: {
               'Content-Type': 'application/json',
           },
           body: JSON.stringify(insightsData)
       });
       
       const result = await response.json();
       
       if (result.success) {
           displayJobSearchInsights(result.insights);
           showSuccessMessage('Job search insights generated successfully!');
       } else {
           // Generate local insights as fallback
           const localInsights = generateLocalInsights();
           displayJobSearchInsights(localInsights);
           showSuccessMessage('Job search insights generated from your local data!');
       }
       
   } catch (error) {
       console.error('âŒ Insights generation error:', error);
       
       // Generate local insights as fallback
       const localInsights = generateLocalInsights();
       displayJobSearchInsights(localInsights);
       showSuccessMessage('Job search insights generated from your local data!');
   } finally {
       hideLoadingSpinner();
   }
}

function generateLocalInsights() {
   const applications = AppState.jobApplications;
   const total = applications.length;
   
   if (total === 0) {
       return {
           summary: 'No applications to analyze yet.',
           metrics: {},
           recommendations: ['Start adding job applications to track your progress!']
       };
   }
   
   // Calculate metrics
   const statusCounts = {};
   const sourceCounts = {};
   const companyCounts = {};
   const jobTypeCounts = {};
   
   applications.forEach(app => {
       // Status distribution
       statusCounts[app.status] = (statusCounts[app.status] || 0) + 1;
       
       // Source distribution
       if (app.jobSource) {
           sourceCounts[app.jobSource] = (sourceCounts[app.jobSource] || 0) + 1;
       }
       
       // Company distribution
       if (app.companyName) {
           companyCounts[app.companyName] = (companyCounts[app.companyName] || 0) + 1;
       }
       
       // Job type distribution
       if (app.jobType) {
           jobTypeCounts[app.jobType] = (jobTypeCounts[app.jobType] || 0) + 1;
       }
   });
   
   // Calculate success rates
   const interviews = statusCounts.interview || 0;
   const offers = statusCounts.offer || 0;
   const accepted = statusCounts.accepted || 0;
   
   const interviewRate = total > 0 ? Math.round((interviews / total) * 100) : 0;
   const offerRate = interviews > 0 ? Math.round((offers / interviews) * 100) : 0;
   
   // Find most successful source
   const bestSource = Object.entries(sourceCounts).sort((a, b) => b[1] - a[1])[0];
   
   // Generate recommendations
   const recommendations = [];
   
   if (interviewRate < 20) {
       recommendations.push('Your interview rate is below average. Consider improving your resume and cover letter.');
   }
   
   if (bestSource) {
       recommendations.push(`Your most successful job source is ${bestSource[0]}. Consider focusing more effort there.`);
   }
   
   if (statusCounts.applied > statusCounts.interview + statusCounts.offer + statusCounts.accepted) {
       recommendations.push('Follow up on pending applications after 1-2 weeks if you haven\'t heard back.');
   }
   
   if (recommendations.length === 0) {
       recommendations.push('Great job tracking your applications! Keep up the good work.');
   }
   
   return {
       summary: `You have ${total} applications tracked with a ${interviewRate}% interview rate.`,
       metrics: {
           totalApplications: total,
           interviewRate: interviewRate,
           offerRate: offerRate,
           statusDistribution: statusCounts,
           sourceDistribution: sourceCounts,
           topCompanies: Object.entries(companyCounts).sort((a, b) => b[1] - a[1]).slice(0, 5),
           jobTypeDistribution: jobTypeCounts
       },
       recommendations: recommendations
   };
}

function displayJobSearchInsights(insights) {
   const insightsContainer = document.getElementById('insightsContainer');
   if (!insightsContainer) return;
   
   const metrics = insights.metrics || {};
   const recommendations = insights.recommendations || [];
   
   const insightsHTML = `
       <div class="job-search-insights">
           <h5 class="mb-3">
               <i class="fas fa-lightbulb me-2" style="color: #FFbf23;"></i>
               AI Job Search Insights
           </h5>
           
           <div class="insights-summary mb-4">
               <div class="alert alert-info">
                   <i class="fas fa-info-circle me-2"></i>
                   ${insights.summary || 'Analysis completed successfully.'}
               </div>
           </div>
           
           <div class="row mb-4">
               <div class="col-md-6">
                   <h6>Application Success Rate</h6>
                   <div class="progress mb-3">
                       <div class="progress-bar bg-success" role="progressbar" 
                            style="width: ${metrics.interviewRate || 0}%">
                           ${metrics.interviewRate || 0}%
                       </div>
                   </div>
                   <p class="small text-muted">
                       ${metrics.totalApplications || 0} applications â€¢ 
                       ${metrics.interviewRate || 0}% interview rate
                   </p>
               </div>
               <div class="col-md-6">
                   <h6>Average Response Time</h6>
                   <p class="h4 text-primary">8 days</p>
                   <p class="small text-muted">Based on application patterns</p>
               </div>
           </div>
           
           ${recommendations.length > 0 ? `
               <div class="recommendations-section">
                   <h6>Recommendations</h6>
                   <ul class="list-unstyled">
                       ${recommendations.map(rec => `
                           <li class="mb-2">
                               <i class="fas fa-arrow-right me-2" style="color: #14697D;"></i>
                               ${rec}
                           </li>
                       `).join('')}
                   </ul>
               </div>
           ` : ''}
           
           <div class="insights-footer mt-3 pt-3 border-top">
               <small class="text-muted">
                   <i class="fas fa-chart-bar me-1"></i>
                   Insights generated on ${new Date().toLocaleString()} â€¢ 
                   Based on ${metrics.totalApplications || 0} applications
               </small>
           </div>
       </div>
   `;
   
   insightsContainer.innerHTML = insightsHTML;
   insightsContainer.style.display = 'block';
   
   console.log('ðŸ“Š Job search insights displayed');
}

// Check tool access
async function checkToolAccess() {
   try {
       const response = await fetch(`${CONFIG.API_BASE_URL}${CONFIG.ENDPOINTS.CHECK_TOOL_ACCESS}`, {
           method: 'POST',
           headers: {
               'Content-Type': 'application/json',
           },
           body: JSON.stringify({
               tool_id: CONFIG.TOOL_ID
           })
       });
       
       const result = await response.json();
       
       if (result.success) {
           console.log('ðŸ” Tool access check:', result);
           
           if (result.has_access) {
               console.log(`âœ… User has ${result.access_type} access to ${CONFIG.TOOL_NAME}`);
           } else {
               console.log(`âš ï¸ User does not have paid access to ${CONFIG.TOOL_NAME}`);
           }
       }
       
   } catch (error) {
       console.log('âš ï¸ Tool access check failed, continuing with frontend tracking:', error.message);
   }
}

// Utility function to show interview summary
function showInterviewSummary() {
   if (!AppState.interviewSession.active || AppState.interviewSession.questions.length === 0) {
       showErrorMessage('No interview session active.');
       return;
   }
   
   const session = AppState.interviewSession;
   const answered = session.answers.filter(answer => answer && answer !== '[SKIPPED]').length;
   const total = session.questions.length;
   const current = session.currentQuestion + 1;
   
   const summaryMessage = `
Interview Progress Summary:

Total Questions: ${total}
Current Question: ${current}
Answered: ${answered}
Remaining: ${total - answered}

Continue with your interview preparation!
   `;
   
   alert(summaryMessage);
}

// Initialize show/hide functionality for results
function toggleInsightsContainer() {
   const insightsContainer = document.getElementById('insightsContainer');
   if (insightsContainer) {
       if (insightsContainer.style.display === 'none' || insightsContainer.style.display === '') {
           generateJobSearchInsights();
       } else {
           insightsContainer.style.display = 'none';
       }
   }
}

// Add event listener for insights toggle
document.addEventListener('DOMContentLoaded', function() {
   const generateInsightsBtn = document.getElementById('generateInsights');
   if (generateInsightsBtn) {
       generateInsightsBtn.removeEventListener('click', generateJobSearchInsights);
       generateInsightsBtn.addEventListener('click', toggleInsightsContainer);
   }
});

console.log('âœ… Section 6: Action Handlers and Export Functions loaded');
// ============================================================================
// SECTION 7: INTEGRATION AND FINALIZATION
// ============================================================================

// Advanced search and filtering
function setupAdvancedFiltering() {
    const searchInput = document.createElement('input');
    searchInput.type = 'text';
    searchInput.className = 'form-control mb-3';
    searchInput.placeholder = 'Search applications by company, title, or notes...';
    searchInput.id = 'applicationSearch';
    
    const applicationsContainer = document.querySelector(CONFIG.SELECTORS.applicationsContainer);
    if (applicationsContainer && applicationsContainer.parentNode) {
        applicationsContainer.parentNode.insertBefore(searchInput, applicationsContainer);
        
        searchInput.addEventListener('input', function(e) {
            filterApplicationsBySearch(e.target.value);
        });
    }
}

function filterApplicationsBySearch(searchTerm) {
    if (!searchTerm.trim()) {
        displayJobApplications(AppState.jobApplications);
        return;
    }
    
    const filtered = AppState.jobApplications.filter(app => {
        const searchFields = [
            app.companyName,
            app.jobTitle,
            app.jobLocation,
            app.applicationNotes,
            app.jobSource,
            formatJobType(app.jobType)
        ].map(field => (field || '').toLowerCase());
        
        return searchFields.some(field => 
            field.includes(searchTerm.toLowerCase())
        );
    });
    
    displayJobApplications(filtered);
    console.log(`ðŸ” Search filtered: ${filtered.length}/${AppState.jobApplications.length} applications`);
}

// Data export functionality
async function exportApplicationsData() {
    if (AppState.jobApplications.length === 0) {
        showErrorMessage('No applications to export.');
        return;
    }
    
    try {
        const exportData = {
            exportDate: new Date().toISOString(),
            totalApplications: AppState.jobApplications.length,
            applications: AppState.jobApplications.map(app => ({
                ...app,
                statusFormatted: formatStatus(app.status),
                jobTypeFormatted: formatJobType(app.jobType),
                applicationDateFormatted: formatDate(app.applicationDate)
            }))
        };
        
        // Create CSV format
        const csvHeaders = [
            'Company Name',
            'Job Title',
            'Job Location',
            'Application Date',
            'Status',
            'Job Type',
            'Job Source',
            'Salary Range',
            'Notes'
        ];
        
        const csvRows = AppState.jobApplications.map(app => [
            app.companyName || '',
            app.jobTitle || '',
            app.jobLocation || '',
            app.applicationDate || '',
            formatStatus(app.status),
            formatJobType(app.jobType),
            app.jobSource || '',
            app.salaryRange || '',
            (app.applicationNotes || '').replace(/"/g, '""') // Escape quotes
        ]);
        
        const csvContent = [
            csvHeaders.join(','),
            ...csvRows.map(row => 
                row.map(field => `"${field}"`).join(',')
            )
        ].join('\n');
        
        // Download CSV
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `JobTracker-Applications-${new Date().toISOString().slice(0,10)}.csv`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
        
        showSuccessMessage(`Exported ${AppState.jobApplications.length} applications to CSV file!`);
        
    } catch (error) {
        console.error('âŒ Export error:', error);
        showErrorMessage('Failed to export applications data.');
    }
}

// Import applications data
async function importApplicationsData(file) {
    if (!file) return;
    
    try {
        showLoadingSpinner();
        
        const text = await file.text();
        const lines = text.split('\n');
        
        if (lines.length < 2) {
            throw new Error('Invalid CSV file format');
        }
        
        const headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim());
        const importedApplications = [];
        
        for (let i = 1; i < lines.length; i++) {
            const line = lines[i].trim();
            if (!line) continue;
            
            const values = line.split(',').map(v => v.replace(/"/g, '').trim());
            
            if (values.length >= headers.length) {
                const app = {
                    id: generateApplicationId(),
                    companyName: values[0] || '',
                    jobTitle: values[1] || '',
                    jobLocation: values[2] || '',
                    applicationDate: values[3] || '',
                    status: values[4] || 'applied',
                    jobType: values[5] || 'other',
                    jobSource: values[6] || '',
                    salaryRange: values[7] || '',
                    applicationNotes: values[8] || '',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    imported: true
                };
                
                importedApplications.push(app);
            }
        }
        
        if (importedApplications.length > 0) {
            // Merge with existing applications
            const existingApplications = getLocalJobApplications();
            const allApplications = [...existingApplications, ...importedApplications];
            
            localStorage.setItem('job_tracker_applications', JSON.stringify(allApplications));
            AppState.jobApplications = allApplications;
            
            // Refresh display
            loadJobApplications();
            
            showSuccessMessage(`Successfully imported ${importedApplications.length} applications!`);
        } else {
            throw new Error('No valid applications found in the file');
        }
        
    } catch (error) {
        console.error('âŒ Import error:', error);
        showErrorMessage(`Import failed: ${error.message}`);
    } finally {
        hideLoadingSpinner();
    }
}

// Backup and restore functionality
function createBackup() {
    try {
        const backupData = {
            version: '1.0',
            createdAt: new Date().toISOString(),
            applications: getLocalJobApplications(),
            preparations: JSON.parse(localStorage.getItem('job_tracker_preparations') || '[]'),
            settings: {
                usageData: AppState.usageData
            }
        };
        
        const backupJson = JSON.stringify(backupData, null, 2);
        const blob = new Blob([backupJson], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        
        const link = document.createElement('a');
        link.href = url;
        link.download = `JobTracker-Backup-${new Date().toISOString().slice(0,10)}.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
        
        showSuccessMessage('Backup created successfully!');
        
    } catch (error) {
        console.error('âŒ Backup error:', error);
        showErrorMessage('Failed to create backup.');
    }
}

async function restoreBackup(file) {
    if (!file) return;
    
    try {
        showLoadingSpinner();
        
        const text = await file.text();
        const backupData = JSON.parse(text);
        
        if (!backupData.version || !backupData.applications) {
            throw new Error('Invalid backup file format');
        }
        
        // Confirm restore
        if (!confirm(`This will restore ${backupData.applications.length} applications and replace your current data. Continue?`)) {
            return;
        }
        
        // Restore data
        localStorage.setItem('job_tracker_applications', JSON.stringify(backupData.applications));
        
        if (backupData.preparations) {
            localStorage.setItem('job_tracker_preparations', JSON.stringify(backupData.preparations));
        }
        
        AppState.jobApplications = backupData.applications;
        
        // Refresh display
        loadJobApplications();
        
        showSuccessMessage(`Successfully restored ${backupData.applications.length} applications from backup!`);
        
    } catch (error) {
        console.error('âŒ Restore error:', error);
        showErrorMessage(`Restore failed: ${error.message}`);
    } finally {
        hideLoadingSpinner();
    }
}

// Analytics and reporting
function generateDetailedReport() {
    const applications = AppState.jobApplications;
    
    if (applications.length === 0) {
        showErrorMessage('No applications to analyze for detailed report.');
        return;
    }
    
    const report = {
        generatedAt: new Date().toISOString(),
        summary: generateReportSummary(applications),
        trends: generateTrendAnalysis(applications),
        recommendations: generateDetailedRecommendations(applications)
    };
    
    displayDetailedReport(report);
}

function generateReportSummary(applications) {
    const total = applications.length;
    const statusCounts = {};
    const recentApplications = applications.filter(app => {
        const appDate = new Date(app.applicationDate || app.createdAt);
        const thirtyDaysAgo = new Date();
        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
        return appDate >= thirtyDaysAgo;
    });
    
    applications.forEach(app => {
        statusCounts[app.status] = (statusCounts[app.status] || 0) + 1;
    });
    
    return {
        totalApplications: total,
        recentApplications: recentApplications.length,
        statusBreakdown: statusCounts,
        successRate: total > 0 ? Math.round(((statusCounts.offer || 0) + (statusCounts.accepted || 0)) / total * 100) : 0,
        responseRate: total > 0 ? Math.round(((statusCounts.interview || 0) + (statusCounts.offer || 0) + (statusCounts.accepted || 0)) / total * 100) : 0
    };
}

function generateTrendAnalysis(applications) {
    // Analyze application trends over time
    const monthlyData = {};
    const sourceEffectiveness = {};
    
    applications.forEach(app => {
        const date = new Date(app.applicationDate || app.createdAt);
        const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
        
        if (!monthlyData[monthKey]) {
            monthlyData[monthKey] = { applied: 0, interviews: 0, offers: 0 };
        }
        
        monthlyData[monthKey].applied++;
        
        if (app.status === 'interview') monthlyData[monthKey].interviews++;
        if (app.status === 'offer' || app.status === 'accepted') monthlyData[monthKey].offers++;
        
        // Source effectiveness
        if (app.jobSource) {
            if (!sourceEffectiveness[app.jobSource]) {
                sourceEffectiveness[app.jobSource] = { total: 0, responses: 0 };
            }
            sourceEffectiveness[app.jobSource].total++;
            if (['interview', 'offer', 'accepted'].includes(app.status)) {
                sourceEffectiveness[app.jobSource].responses++;
            }
        }
    });
    
    return {
        monthlyData,
        sourceEffectiveness
    };
}

function generateDetailedRecommendations(applications) {
    const recommendations = [];
    const total = applications.length;
    const statusCounts = {};
    
    applications.forEach(app => {
        statusCounts[app.status] = (statusCounts[app.status] || 0) + 1;
    });
    
    const responseRate = total > 0 ? ((statusCounts.interview || 0) + (statusCounts.offer || 0) + (statusCounts.accepted || 0)) / total * 100 : 0;
    
    if (responseRate < 15) {
        recommendations.push({
            type: 'critical',
            title: 'Low Response Rate',
            description: 'Your response rate is below industry average. Consider revising your resume and cover letter strategy.',
            action: 'Review and update your application materials'
        });
    }
    
    if (statusCounts.applied > (statusCounts.interview || 0) * 5) {
        recommendations.push({
            type: 'important',
            title: 'Follow-up Strategy',
            description: 'Many applications are pending. Implement a systematic follow-up approach.',
            action: 'Set reminders to follow up after 1-2 weeks'
        });
    }
    
    if (total < 10) {
        recommendations.push({
            type: 'suggestion',
            title: 'Application Volume',
            description: 'Consider increasing your application volume to improve your chances.',
            action: 'Aim for 5-10 applications per week'
        });
    }
    
    return recommendations;
}

function displayDetailedReport(report) {
    const interviewPreview = document.querySelector(CONFIG.SELECTORS.interviewPreview);
    if (!interviewPreview) return;
    
    const reportHTML = `
        <div class="detailed-report">
            <h4 class="mb-4">
                <i class="fas fa-chart-line me-2" style="color: #14697D;"></i>
                Detailed Job Search Report
            </h4>
            
            <div class="report-summary card mb-4">
                <div class="card-header">
                    <h6 class="mb-0">Executive Summary</h6>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-3">
                            <h3 class="text-primary">${report.summary.totalApplications}</h3>
                            <small>Total Applications</small>
                        </div>
                        <div class="col-md-3">
                            <h3 class="text-success">${report.summary.responseRate}%</h3>
                            <small>Response Rate</small>
                        </div>
                        <div class="col-md-3">
                            <h3 class="text-info">${report.summary.successRate}%</h3>
                            <small>Success Rate </small>
                            </div>
                       <div class="col-md-3">
                           <h3 class="text-warning">${report.summary.recentApplications}</h3>
                           <small>Recent (30 days)</small>
                       </div>
                   </div>
               </div>
           </div>
           
           <div class="report-recommendations mb-4">
               <h6 class="mb-3">Key Recommendations</h6>
               ${report.recommendations.map(rec => `
                   <div class="alert alert-${rec.type === 'critical' ? 'danger' : rec.type === 'important' ? 'warning' : 'info'} mb-2">
                       <div class="d-flex">
                           <div class="me-3">
                               <i class="fas fa-${rec.type === 'critical' ? 'exclamation-triangle' : rec.type === 'important' ? 'exclamation-circle' : 'lightbulb'}"></i>
                           </div>
                           <div>
                               <h6 class="alert-heading">${rec.title}</h6>
                               <p class="mb-1">${rec.description}</p>
                               <small><strong>Action:</strong> ${rec.action}</small>
                           </div>
                       </div>
                   </div>
               `).join('')}
           </div>
           
           <div class="report-actions">
               <div class="row">
                   <div class="col-md-4 mb-2">
                       <button class="btn btn-primary btn-sm w-100" onclick="exportApplicationsData()">
                           <i class="fas fa-download me-1"></i>
                           Export Data
                       </button>
                   </div>
                   <div class="col-md-4 mb-2">
                       <button class="btn btn-outline-info btn-sm w-100" onclick="createBackup()">
                           <i class="fas fa-shield-alt me-1"></i>
                           Create Backup
                       </button>
                   </div>
                   <div class="col-md-4 mb-2">
                       <button class="btn btn-outline-secondary btn-sm w-100" onclick="printReport()">
                           <i class="fas fa-print me-1"></i>
                           Print Report
                       </button>
                   </div>
               </div>
           </div>
           
           <div class="report-footer mt-4 pt-3 border-top">
               <small class="text-muted">
                   <i class="fas fa-calendar me-1"></i>
                   Report generated on ${new Date().toLocaleString()} â€¢ 
                   Based on ${report.summary.totalApplications} applications
               </small>
           </div>
       </div>
   `;
   
   interviewPreview.innerHTML = reportHTML;
   showResultsContainer();
   
   console.log('ðŸ“Š Detailed report displayed');
}

// Print functionality
function printReport() {
   const content = document.querySelector(CONFIG.SELECTORS.interviewPreview);
   if (!content) {
       showErrorMessage('No report content to print.');
       return;
   }
   
   const printWindow = window.open('', '_blank');
   printWindow.document.write(`
       <!DOCTYPE html>
       <html>
       <head>
           <title>JobTracker Report</title>
           <style>
               body { font-family: Arial, sans-serif; margin: 1in; line-height: 1.6; }
               h1, h2, h3, h4, h5, h6 { color: #14697D; }
               .alert { border: 1px solid #ddd; padding: 1rem; margin: 1rem 0; border-radius: 4px; }
               .alert-danger { border-color: #dc3545; background-color: #f8d7da; }
               .alert-warning { border-color: #ffc107; background-color: #fff3cd; }
               .alert-info { border-color: #17a2b8; background-color: #d1ecf1; }
               .card { border: 1px solid #ddd; margin: 1rem 0; }
               .card-header { background-color: #f8f9fa; padding: 0.75rem; font-weight: bold; }
               .card-body { padding: 1rem; }
               .row { display: flex; }
               .col-md-3 { flex: 1; text-align: center; padding: 0.5rem; }
               .text-primary { color: #14697D !important; }
               .text-success { color: #28a745 !important; }
               .text-info { color: #17a2b8 !important; }
               .text-warning { color: #ffc107 !important; }
               @media print { body { margin: 0.5in; } }
           </style>
       </head>
       <body>
           <h1>JobTracker Report</h1>
           ${content.innerHTML}
       </body>
       </html>
   `);
   printWindow.document.close();
   printWindow.print();
}

// Keyboard shortcuts
function setupKeyboardShortcuts() {
   document.addEventListener('keydown', function(e) {
       // Ctrl/Cmd + shortcuts
       if (e.ctrlKey || e.metaKey) {
           switch(e.key) {
               case 'n':
                   e.preventDefault();
                   switchTab('add');
                   break;
               case 't':
                   e.preventDefault();
                   switchTab('track');
                   break;
               case 'i':
                   e.preventDefault();
                   switchTab('interview');
                   break;
               case 's':
                   e.preventDefault();
                   if (AppState.jobApplications.length > 0) {
                       exportApplicationsData();
                   }
                   break;
               case 'b':
                   e.preventDefault();
                   createBackup();
                   break;
           }
       }
       
       // Escape key
       if (e.key === 'Escape') {
           hideResultsContainer();
       }
   });
   
   console.log('âŒ¨ï¸ Keyboard shortcuts activated');
}

// Performance monitoring
function setupPerformanceMonitoring() {
   // Monitor page load performance
   window.addEventListener('load', function() {
       const perfData = performance.getEntriesByType('navigation')[0];
       const loadTime = perfData.loadEventEnd - perfData.loadEventStart;
       
       console.log('âš¡ Performance metrics:', {
           loadTime: `${loadTime}ms`,
           domContentLoaded: `${perfData.domContentLoadedEventEnd - perfData.domContentLoadedEventStart}ms`,
           totalApplications: AppState.jobApplications.length,
           timestamp: new Date().toISOString()
       });
   });
   
   // Monitor API response times
   const originalFetch = window.fetch;
   window.fetch = function(...args) {
       const startTime = performance.now();
       return originalFetch.apply(this, args).then(response => {
           const endTime = performance.now();
           const duration = endTime - startTime;
           
           if (args[0].includes(CONFIG.API_BASE_URL)) {
               console.log(`ðŸŒ API call: ${args[0]} - ${duration.toFixed(2)}ms`);
           }
           
           return response;
       });
   };
}

// Error boundary and recovery
function setupErrorRecovery() {
   window.addEventListener('error', function(e) {
       console.error('ðŸš¨ Global error caught:', e.error);
       
       // Show user-friendly error message
       showErrorMessage('An unexpected error occurred. The application will attempt to recover.');
       
       // Attempt to recover state
       try {
           initializeUsageTracking();
           loadJobApplications();
           console.log('ðŸ”„ Application state recovered');
       } catch (recoveryError) {
           console.error('âŒ Recovery failed:', recoveryError);
           showErrorMessage('Unable to recover application state. Please refresh the page.');
       }
   });
   
   window.addEventListener('unhandledrejection', function(e) {
       console.error('ðŸš¨ Unhandled promise rejection:', e.reason);
       showErrorMessage('A network or processing error occurred. Please try again.');
       hideLoadingSpinner();
   });
}

// Data validation and integrity
function validateApplicationData(application) {
   const required = ['companyName', 'jobTitle'];
   const missing = required.filter(field => !application[field] || !application[field].trim());
   
   if (missing.length > 0) {
       throw new Error(`Missing required fields: ${missing.join(', ')}`);
   }
   
   // Validate status
   const validStatuses = ['applied', 'review', 'interview', 'offer', 'rejected', 'accepted'];
   if (application.status && !validStatuses.includes(application.status)) {
       application.status = 'applied'; // Default to applied if invalid
   }
   
   // Validate dates
   if (application.applicationDate) {
       const date = new Date(application.applicationDate);
       if (isNaN(date.getTime())) {
           application.applicationDate = new Date().toISOString().split('T')[0];
       }
   }
   
   return true;
}

// Auto-save functionality
function setupAutoSave() {
   let autoSaveTimer;
   
   function triggerAutoSave() {
       clearTimeout(autoSaveTimer);
       autoSaveTimer = setTimeout(() => {
           try {
               // Save current state
               const currentState = {
                   applications: AppState.jobApplications,
                   lastAutoSave: new Date().toISOString()
               };
               
               localStorage.setItem('job_tracker_autosave', JSON.stringify(currentState));
               console.log('ðŸ’¾ Auto-save completed');
               
           } catch (error) {
               console.error('âŒ Auto-save failed:', error);
           }
       }, 2000); // Save after 2 seconds of inactivity
   }
   
   // Set up auto-save triggers
   document.addEventListener('input', triggerAutoSave);
   document.addEventListener('change', triggerAutoSave);
   
   // Recovery from auto-save
   try {
       const autoSaveData = localStorage.getItem('job_tracker_autosave');
       if (autoSaveData) {
           const parsed = JSON.parse(autoSaveData);
           console.log('ðŸ”„ Auto-save data found:', new Date(parsed.lastAutoSave));
       }
   } catch (error) {
       console.error('âŒ Auto-save recovery failed:', error);
   }
}

// Accessibility enhancements
function setupAccessibility() {
   // Add ARIA labels
   const buttons = document.querySelectorAll('button:not([aria-label])');
   buttons.forEach(button => {
       if (button.textContent) {
           button.setAttribute('aria-label', button.textContent.trim());
       }
   });
   
   // Add keyboard navigation
   const tabs = document.querySelectorAll(CONFIG.SELECTORS.trackerTabs);
   tabs.forEach((tab, index) => {
       tab.setAttribute('role', 'tab');
       tab.setAttribute('tabindex', index === 0 ? '0' : '-1');
       
       tab.addEventListener('keydown', function(e) {
           if (e.key === 'Enter' || e.key === ' ') {
               e.preventDefault();
               tab.click();
           }
       });
   });
   
   // Focus management
   document.addEventListener('keydown', function(e) {
       if (e.key === 'Tab') {
           document.body.classList.add('keyboard-navigation');
       }
   });
   
   document.addEventListener('mousedown', function() {
       document.body.classList.remove('keyboard-navigation');
   });
   
   console.log('â™¿ Accessibility enhancements activated');
}

// Progressive Web App features
function setupPWAFeatures() {
   // Check if running as PWA
   if (window.matchMedia('(display-mode: standalone)').matches) {
       console.log('ðŸ“± Running as PWA');
       document.body.classList.add('pwa-mode');
   }
   
   // Add install prompt
   let deferredPrompt;
   
   window.addEventListener('beforeinstallprompt', (e) => {
       e.preventDefault();
       deferredPrompt = e;
       
       // Show install button
       const installBtn = document.createElement('button');
       installBtn.textContent = 'Install App';
       installBtn.className = 'btn btn-outline-primary btn-sm';
       installBtn.onclick = async () => {
           if (deferredPrompt) {
               deferredPrompt.prompt();
               const result = await deferredPrompt.userChoice;
               console.log('PWA install result:', result);
               deferredPrompt = null;
               installBtn.remove();
           }
       };
       
       // Add to header if space available
       const nav = document.querySelector('nav');
       if (nav) {
           nav.appendChild(installBtn);
       }
   });
}

// Final initialization and startup
function finalizeApplication() {
   console.log('ðŸ Finalizing JobTracker application...');
   
   // Setup advanced features
   setupAdvancedFiltering();
   setupKeyboardShortcuts();
   setupPerformanceMonitoring();
   setupErrorRecovery();
   setupAutoSave();
   setupAccessibility();
   setupPWAFeatures();
   
   // Add import/export UI elements
   addImportExportUI();
   
   // Register service worker if available
   if ('serviceWorker' in navigator) {
       navigator.serviceWorker.register('/sw.js')
           .then(registration => console.log('ðŸ“‹ Service Worker registered'))
           .catch(error => console.log('âš ï¸ Service Worker registration failed'));
   }
   
   // Final state validation
   try {
       validateApplicationState();
       console.log('âœ… Application state validated');
   } catch (error) {
       console.error('âŒ Application state validation failed:', error);
       showErrorMessage('Application state validation failed. Some features may not work correctly.');
   }
   
   // Performance metrics
   const endTime = performance.now();
   const loadTime = endTime - (window.jobTrackerStartTime || endTime);
   
   console.log(`ðŸŽ‰ JobTracker Application Ready! Loaded in ${loadTime.toFixed(2)}ms`);
   console.log('ðŸ“Š Current state:', {
       applications: AppState.jobApplications.length,
       currentTab: AppState.currentTab,
       usageRemaining: AppState.usageData.remaining,
       interviewActive: AppState.interviewSession.active
   });
   
   // Show welcome message for new users
   if (AppState.jobApplications.length === 0 && !localStorage.getItem('jobtracker_welcomed')) {
       setTimeout(() => {
           showWelcomeMessage();
           localStorage.setItem('jobtracker_welcomed', 'true');
       }, 1000);
   }
}

function addImportExportUI() {
   const trackSection = document.getElementById('trackSection');
   if (!trackSection) return;
   
   const importExportDiv = document.createElement('div');
   importExportDiv.className = 'import-export-section mt-3 mb-3';
   importExportDiv.innerHTML = `
       <div class="row">
           <div class="col-md-6">
               <input type="file" id="importFile" accept=".csv,.json" style="display: none;">
               <button class="btn btn-outline-info btn-sm w-100" onclick="document.getElementById('importFile').click()">
                   <i class="fas fa-upload me-1"></i>
                   Import Applications
               </button>
           </div>
           <div class="col-md-6">
               <button class="btn btn-outline-success btn-sm w-100" onclick="generateDetailedReport()">
                   <i class="fas fa-chart-bar me-1"></i>
                   Detailed Report
               </button>
           </div>
       </div>
   `;
   
   // Insert before applications container
   const applicationsContainer = document.querySelector(CONFIG.SELECTORS.applicationsContainer);
   if (applicationsContainer && applicationsContainer.parentNode) {
       applicationsContainer.parentNode.insertBefore(importExportDiv, applicationsContainer);
   }
   
   // Add import file handler
   document.getElementById('importFile').addEventListener('change', function(e) {
       const file = e.target.files[0];
       if (file) {
           if (file.name.endsWith('.csv')) {
               importApplicationsData(file);
           } else if (file.name.endsWith('.json')) {
               restoreBackup(file);
           } else {
               showErrorMessage('Please select a CSV or JSON file.');
           }
           e.target.value = '';
       }
   });
}

function validateApplicationState() {
   // Validate applications data
   if (AppState.jobApplications) {
       AppState.jobApplications.forEach((app, index) => {
           try {
               validateApplicationData(app);
           } catch (error) {
               console.warn(`âš ï¸ Application ${index} validation failed:`, error.message);
           }
       });
   }
   
   // Validate usage data
   if (!AppState.usageData || typeof AppState.usageData.remaining !== 'number') {
       AppState.usageData = { remaining: 5, total: 5, resetDate: null };
       updateUsageDisplay();
   }
   
   // Validate interview session
   if (!AppState.interviewSession || typeof AppState.interviewSession.active !== 'boolean') {
       AppState.interviewSession = {
           active: false,
           currentQuestion: 0,
           questions: [],
           answers: [],
           feedback: []
       };
   }
   
   return true;
}

function showWelcomeMessage() {
   const welcomeHTML = `
       <div class="welcome-modal position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center" 
            style="background-color: rgba(0,0,0,0.8); z-index: 10000;">
           <div class="welcome-content bg-white rounded-4 p-4 mx-3" style="max-width: 500px;">
               <div class="text-center mb-4">
                   <i class="fas fa-briefcase" style="font-size: 3rem; color: #14697D;"></i>
                   <h3 class="mt-3 mb-2">Welcome to JobTracker!</h3>
                   <p class="text-muted">Your AI-powered job search assistant</p>
               </div>
               
               <div class="welcome-features mb-4">
                   <div class="row text-center">
                       <div class="col-4">
                           <i class="fas fa-plus-circle text-primary mb-2"></i>
                           <small class="d-block">Track Applications</small>
                       </div>
                       <div class="col-4">
                           <i class="fas fa-chart-line text-success mb-2"></i>
                           <small class="d-block">Resume Analysis</small>
                       </div>
                       <div class="col-4">
                           <i class="fas fa-comments text-info mb-2"></i>
                           <small class="d-block">Interview Prep</small>
                       </div>
                   </div>
               </div>
               
               <div class="text-center">
                   <button class="btn btn-primary" onclick="closeWelcomeMessage()">
                       <i class="fas fa-rocket me-2"></i>
                       Get Started
                   </button>
               </div>
           </div>
       </div>
   `;
   
   document.body.insertAdjacentHTML('beforeend', welcomeHTML);
}

function closeWelcomeMessage() {
   const welcomeModal = document.querySelector('.welcome-modal');
   if (welcomeModal) {
       welcomeModal.remove();
   }
   
   // Switch to add tab to help user get started
   switchTab('add');
}

// Mark start time for performance measurement
window.jobTrackerStartTime = performance.now();

// Initialize when DOM is ready
if (document.readyState === 'loading') {
   document.addEventListener('DOMContentLoaded', finalizeApplication);
} else {
   finalizeApplication();
}

// Export functions for global access
window.JobTracker = {
   switchTab,
   editApplication,
   prepareInterviewForApplication,
   analyzeApplication,
   updateApplicationStatus,
   duplicateApplication,
   deleteApplication,
   exportApplicationsData,
   generateDetailedReport,
   createBackup,
   exportToPDF,
   copyToClipboard,
   savePreparation,
   generateJobSearchInsights,
   startInteractiveInterview,
   skipQuestion,
   showInterviewSummary,
   closeWelcomeMessage,
   printReport
};

console.log('âœ… Section 7: Integration and Finalization completed');
console.log('ðŸŽ¯ JobTracker Application Fully Loaded and Ready!');
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LegalEase - Professional Legal Document Drafting | Elevify</title>
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Antic+Slab&family=Quicksand:wght@300..700&family=Sora:wght@100..800&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Your custom CSS file -->
    <link rel="stylesheet" href="./styles.css">
    <style>
        .tool-page-hero {
            background-color: #f9f9f9;
            padding: 3rem 0 2rem;
            margin-bottom: 3rem;
        }
        
        .tool-page-hero h1 {
            font-size: 2.5rem;
            color: #14697D;
            margin-bottom: 1rem;
            font-family: 'Antic Slab', serif;
        }
        
        .tool-page-hero .lead {
            color: #666;
            font-size: 1.2rem;
            font-family: 'Quicksand', sans-serif;
        }
        
        .content-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            padding: 2rem;
            margin-bottom: 2rem;
            transition: transform 0.3s ease;
        }
        
        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }
        
        .document-type-card {
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            height: 100%;
            background: #f8f9fa;
        }
        
        .document-type-card:hover {
            border-color: #14697D;
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(20, 105, 125, 0.2);
        }
        
        .document-type-card.selected {
            border-color: #FFbf23 !important;
            background-color: #fffbf0 !important;
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(255, 191, 35, 0.3);
        }
        
        .language-option {
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .language-option:hover {
            border-color: #14697D;
            background-color: #f9f9f9;
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(20, 105, 125, 0.2);
        }
        
        .language-option.selected {
            border-color: #FFbf23 !important;
            background-color: #fffbf0 !important;
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(255, 191, 35, 0.3);
        }
        
        .loading-spinner {
            display: none;
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #14697D;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            background-color: #14697D;
            color: white;
            border-radius: 50%;
            font-weight: bold;
            font-family: 'Sora', sans-serif;
            margin-right: 10px;
        }
        
        .features-highlight {
            background-color: #FFF0F5;
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .form-control, .form-select {
            border-radius: 20px;
            border: 1px solid #ddd;
            padding: 0.75rem 1.25rem;
            font-family: 'Quicksand', sans-serif;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: #14697D;
            box-shadow: 0 0 0 0.2rem rgba(20, 105, 125, 0.25);
        }

        .form-label {
            font-family: 'Quicksand', sans-serif;
            font-weight: 600;
        }
        
        .document-preview {
            background-color: #f9f9f9;
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid #e0e0e0;
            font-family: 'Times New Roman', serif;
            line-height: 1.8;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .float-animation {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0px); }
        }

        .legal-disclaimer {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 15px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .export-options {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 2rem;
        }
        
        .export-option {
            flex: 1;
            min-width: 150px;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .export-option:hover {
            border-color: #14697D;
            background-color: #f9f9f9;
        }
        
        .export-option i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: #14697D;
        }

        .doc-tab {
            background: none;
            border: none;
            padding: 12px 24px;
            margin: 0 6px;
            font-size: 1rem;
            font-weight: 500;
            color: #666;
            cursor: pointer;
            border-radius: 30px 30px 0 0;
            transition: all 0.3s ease;
        }
        
        .doc-tab:hover {
            color: #333;
            background-color: #f0f0f0;
        }
        
        .doc-tab.active {
            background-color: #14697D;
            color: white;
        }

        .document-tabs {
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 2rem;
        }

        .party-info {
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            background-color: #f8f9fa;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
        
        .popup-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            min-width: 300px;
            max-width: 400px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            border-left: 4px solid #28a745;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .popup-notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .popup-notification.error {
            border-left-color: #dc3545;
        }

        .popup-notification-content {
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .popup-notification-icon {
            font-size: 1.2rem;
            color: #28a745;
        }

        .popup-notification.error .popup-notification-icon {
            color: #dc3545;
        }

        .popup-notification-text {
            flex: 1;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .popup-notification-close {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .popup-notification-close:hover {
            background-color: #f0f0f0;
        }

        .translation-progress {
            background: linear-gradient(90deg, #14697D 0%, #FFbf23 100%);
            height: 4px;
            border-radius: 2px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .translation-progress-bar {
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 2px;
        }

        .is-invalid {
            border-color: #dc3545 !important;
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
        }
        
        #specificFields {
            display: none;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        #specificFields.show {
            display: block;
            opacity: 1;
        }

        .field-group {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e9ecef;
        }

        .field-group h6 {
            color: #14697D;
            font-weight: 600;
            margin-bottom: 1rem;
            border-bottom: 2px solid #14697D;
            padding-bottom: 0.5rem;
        }

        /* Enhanced party label styling */
        .party1-label, .party2-label {
            transition: all 0.3s ease;
            font-weight: 600;
            color: #14697D;
        }

        @media (max-width: 768px) {
            .tool-page-hero h1 {
                font-size: 2rem;
            }
            
            .content-card {
                padding: 1.5rem;
            }
            
            .export-options {
                flex-direction: column;
            }
            
            .export-option {
                min-width: auto;
            }

            .popup-notification {
                right: 10px;
                left: 10px;
                min-width: auto;
                max-width: none;
            }
        }
         /* ===== UPGRADE MODAL STYLES ===== */

/* Modal container and layout */
.modal-xl {
    max-width: 1000px;
}

@media (max-width: 992px) {
    .modal-xl {
        max-width: 800px;
    }
}

@media (max-width: 768px) {
    .modal-xl {
        margin: 1rem;
    }
}

/* Modal content styling */
#upgradeModal .modal-content {
    border-radius: 20px;
    border: none;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
}

#upgradeModal .modal-header {
    border-bottom: 1px solid #e0e0e0;
    padding: 1.5rem 2rem 1rem;
}

#upgradeModal .modal-title {
    font-family: 'Antic Slab', serif;
    color: #14697D;
    font-weight: 400;
    font-size: 1.5rem;
}

#upgradeModal .modal-body {
    padding: 2rem;
}

#upgradeModal .modal-body p {
    font-family: 'Quicksand', sans-serif;
    color: #666;
    font-size: 1.1rem;
}

/* ===== PRICING TIER CARDS ===== */

/* Base card styling */
.pricing-tier-card {
    border: 2px solid transparent;
    transition: all 0.3s ease;
    cursor: pointer;
    height: 100%;
    background: #f8f9fa;
    position: relative;
    overflow: visible;
    border-radius: 15px;
}

/* Card body styling */
.pricing-tier-card .card-body {
    padding: 2rem 1.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    height: 100%;
}

/* Icon styling */
.pricing-tier-card i {
    color: #14697D;
    font-size: 2.5rem;
    margin-bottom: 1rem;
}

/* Card title styling */
.pricing-tier-card h6 {
    font-family: 'Antic Slab', serif;
    font-weight: 400;
    font-size: 1.2rem;
    color: #333;
    margin-bottom: 0.5rem;
}

/* Card description */
.pricing-tier-card small {
    font-family: 'Quicksand', sans-serif;
    color: #666;
    margin-bottom: 1rem;
    display: block;
}

/* Price display styling */
.price-display {
    font-family: 'Sora', sans-serif;
    margin-bottom: 1.5rem;
}

.price-display span {
    font-size: 2.2rem;
    font-weight: bold;
    color: #14697D;
}

.price-display small {
    font-size: 0.9rem;
    color: #666;
    font-weight: normal;
}

/* Features list styling */
.features-list {
    min-height: 80px;
    width: 100%;
    text-align: left;
    margin-top: auto;
}

.features-list div {
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
}

.features-list small {
    font-family: 'Quicksand', sans-serif;
    font-size: 0.85rem;
    margin: 0;
}

.features-list i {
    font-size: 0.8rem;
    margin-right: 0.5rem;
    width: 12px;
}

/* Badge styling */
.pricing-tier-card .badge {
    position: absolute;
    top: 12px;
    right: 12px;
    font-size: 0.7rem;
    padding: 0.4rem 0.6rem;
    border-radius: 8px;
    font-family: 'Sora', sans-serif;
    font-weight: 600;
    z-index: 5;
}

/* ===== HOVER EFFECTS ===== */
.pricing-tier-card:hover {
    border-color: #14697D;
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(20, 105, 125, 0.2);
    background-color: #ffffff;
}

.pricing-tier-card:hover i {
    color: #0f5566;
}

/* ===== SELECTED STATE (YELLOW HIGHLIGHT) ===== */
.pricing-tier-card.selected {
    border-color: #FFbf23 !important;
    background-color: #fffbf0 !important;
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 12px 35px rgba(255, 191, 35, 0.4);
    z-index: 10;
}

.pricing-tier-card.selected h6 {
    color: #14697D;
}

.pricing-tier-card.selected i {
    color: #FFbf23;
    transform: scale(1.1);
}

.pricing-tier-card.selected .price-display span {
    color: #FFbf23;
}

/* ===== GET SELECTED PLAN BUTTON ===== */
#getSelectedPlan {
    font-family: 'Sora', sans-serif;
    font-weight: 600;
    font-size: 1.1rem;
    padding: 1rem 2rem;
    border-radius: 15px;
    transition: all 0.3s ease;
    border: none;
    width: 100%;
    margin-top: 1.5rem;
}

#getSelectedPlan:disabled {
    background-color: #6c757d;
    border-color: #6c757d;
    cursor: not-allowed;
    opacity: 0.6;
}

#getSelectedPlan:enabled {
    background-color: #14697D;
    border-color: #14697D;
    color: white;
}

#getSelectedPlan:enabled:hover {
    background-color: #0f5566;
    border-color: #0f5566;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(20, 105, 125, 0.3);
}

#getSelectedPlan:enabled:active {
    transform: translateY(0);
}

/* Button icon */
#getSelectedPlan i {
    margin-right: 0.5rem;
}

/* ===== RESPONSIVE DESIGN ===== */

/* Tablet and below */
@media (max-width: 992px) {
    .pricing-tier-card .card-body {
        padding: 1.5rem 1rem;
    }
    
    .pricing-tier-card i {
        font-size: 2rem;
    }
    
    .price-display span {
        font-size: 1.8rem;
    }
    
    .features-list {
        min-height: 70px;
    }
}

/* Mobile devices */
@media (max-width: 768px) {
    #upgradeModal .modal-body {
        padding: 1.5rem;
    }
    
    .pricing-tier-card {
        margin-bottom: 1rem;
    }
    
    .pricing-tier-card.selected {
        transform: translateY(-5px) scale(1.01);
        box-shadow: 0 8px 25px rgba(255, 191, 35, 0.3);
    }
    
    .pricing-tier-card .card-body {
        padding: 1.5rem;
    }
    
    #getSelectedPlan {
        font-size: 1rem;
        padding: 0.875rem 1.5rem;
    }
}

/* Small mobile devices */
@media (max-width: 576px) {
    #upgradeModal .modal-body {
        padding: 1rem;
    }
    
    .price-display span {
        font-size: 1.6rem !important;
    }
    
    .features-list {
        text-align: center !important;
        min-height: 60px;
    }
    
    .pricing-tier-card h6 {
        font-size: 1.1rem;
    }
    
    .pricing-tier-card i {
        font-size: 1.8rem;
    }
    
    .pricing-tier-card .badge {
        font-size: 0.6rem;
        padding: 0.3rem 0.5rem;
    }
}

/* ===== ANIMATION ENHANCEMENTS ===== */

/* Smooth transitions for all interactive elements */
.pricing-tier-card,
.pricing-tier-card i,
.pricing-tier-card h6,
.pricing-tier-card .price-display span,
#getSelectedPlan {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Subtle pulse animation for selected state */
.pricing-tier-card.selected {
    animation: selectedPulse 0.6s ease-out;
}

@keyframes selectedPulse {
    0% {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 12px 35px rgba(255, 191, 35, 0.4);
    }
    50% {
        transform: translateY(-10px) scale(1.03);
        box-shadow: 0 15px 40px rgba(255, 191, 35, 0.5);
    }
    100% {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 12px 35px rgba(255, 191, 35, 0.4);
    }
}

/* Modal entrance animation */
#upgradeModal.fade .modal-dialog {
    transition: transform 0.4s ease-out, opacity 0.4s ease-out;
}

#upgradeModal.fade:not(.show) .modal-dialog {
    transform: translate(0, -25px) scale(0.95);
    opacity: 0;
}

#upgradeModal.fade.show .modal-dialog {
    transform: translate(0, 0) scale(1);
    opacity: 1;
}

/* ===== ACCESSIBILITY ===== */

/* Focus states for keyboard navigation */
.pricing-tier-card:focus {
    outline: 3px solid rgba(255, 191, 35, 0.5);
    outline-offset: 2px;
}

#getSelectedPlan:focus {
    outline: 3px solid rgba(20, 105, 125, 0.5);
    outline-offset: 2px;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
    .pricing-tier-card {
        border-width: 3px;
    }
    
    .pricing-tier-card.selected {
        border-width: 4px;
    }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
    .pricing-tier-card,
    .pricing-tier-card i,
    .pricing-tier-card h6,
    .pricing-tier-card .price-display span,
    #getSelectedPlan {
        transition: none;
    }
    
    .pricing-tier-card:hover,
    .pricing-tier-card.selected {
        transform: none;
    }
    
    .selectedPulse {
        animation: none;
    }
}
/* Rich text editor styles */
.rich-text-editor {
    transition: all 0.3s ease;
}

.rich-text-editor:focus {
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

.editing-toolbar .btn.active {
    background-color: #007bff;
    color: white;
    border-color: #007bff;
}

.editing-toolbar .btn:hover {
    background-color: #e9ecef;
}

/* Copy success message animation */
.alert.position-fixed {
    animation: slideInRight 0.3s ease-out;
}

@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}
    </style>
</head>
<body>
    <header>
        <div class="container-nav">
            <div class="row align-items-center">
                <div class="col-md-3">
                    <div class="d-flex align-items-center">
                        <div class="logo-container">
                            <img src="/img/logo.svg" alt="logo">
                        </div>
                    </div>
                </div>
                <div class="col-md-9">
                    <nav>
                        <a href="/" class="btn btn-outline-dark me-2">Home</a>
                        <a href="/#tools" class="btn btn-outline-dark me-2">AI Tools</a>
                        <a href="/#pricing" class="btn btn-outline-dark me-2">Pricing</a>
                        <a href="#" class="btn btn-get-started">Get Started</a>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <main>
        <!-- Tool Hero Section -->
        <section class="tool-page-hero">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-8">
                        <h1>LegalEase - Professional Legal Document Assistant</h1>
                        <p class="lead">Generate comprehensive, legally-compliant documents with AI-powered precision.</p>
                    </div>
                    <div class="col-lg-4 text-center">
                        <img src="/img/img18.svg" alt="Legal Documents" style="max-height: 150px;" class="float-animation">
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Main Content -->
        <div class="container">
            <div class="row">
                <!-- Left Column -->
                <div class="col-lg-4 mb-4">
                    <div class="content-card">
                        <h5><i class="fas fa-gavel" style="color: #14697D;"></i> How It Works</h5>
                        <ol class="mt-3">
                            <div><span class="step-number">1</span> Choose document type</div>
                            <div class="mt-2"><span class="step-number">2</span> Provide comprehensive details</div>
                            <div class="mt-2"><span class="step-number">3</span> AI generates full legal document</div>
                            <div class="mt-2"><span class="step-number">4</span> Review complete document</div>
                            <div class="mt-2"><span class="step-number">5</span> Download professionally formatted file</div>
                        </ol>
                    </div>

                    <div class="features-highlight">
                        <h5><i class="fas fa-shield-alt" style="color: #FFbf23;"></i> Professional Features</h5>
                        <ul class="list-unstyled mt-3">
                            <li class="mb-2"><i class="fas fa-check-circle" style="color: #14697D;"></i> Full legal document generation</li>
                            <li class="mb-2"><i class="fas fa-check-circle" style="color: #14697D;"></i> Jurisdiction-specific compliance</li>
                            <li class="mb-2"><i class="fas fa-check-circle" style="color: #14697D;"></i> Professional legal terminology</li>
                            <li class="mb-2"><i class="fas fa-check-circle" style="color: #14697D;"></i> Complete clause libraries</li>
                            <li class="mb-2"><i class="fas fa-check-circle" style="color: #14697D;"></i> Multi-language support</li>
                            <li><i class="fas fa-check-circle" style="color: #14697D;"></i> Court-ready formatting</li>
                        </ul>
                    </div>

                    <div class="content-card">
                        <h5><i class="fas fa-file-contract" style="color: #A82C2C;"></i> Document Types</h5>
                        <div class="mt-3">
                            <div class="mb-2"><i class="fas fa-handshake" style="color: #14697D;"></i> Service Agreements</div>
                            <div class="mb-2"><i class="fas fa-home" style="color: #14697D;"></i> Rental/Lease Contracts</div>
                            <div class="mb-2"><i class="fas fa-user-secret" style="color: #14697D;"></i> Non-Disclosure Agreements</div>
                            <div class="mb-2"><i class="fas fa-briefcase" style="color: #14697D;"></i> Employment Contracts</div>
                            <div class="mb-2"><i class="fas fa-users" style="color: #14697D;"></i> Partnership Agreements</div>
                            <div class="mb-2"><i class="fas fa-scroll" style="color: #14697D;"></i> Will & Testament</div>
                            <div class="mb-2"><i class="fas fa-file-signature" style="color: #14697D;"></i> General Contracts</div>
                            <div class="mb-2"><i class="fas fa-shopping-cart" style="color: #14697D;"></i> Sale of Goods</div>
                            <div class="mb-2"><i class="fas fa-money-bill-wave" style="color: #14697D;"></i> Loan Agreements</div>
                            <div class="mb-2"><i class="fas fa-lightbulb" style="color: #14697D;"></i> IP Licenses</div>
                            <div><i class="fas fa-user-tie" style="color: #14697D;"></i> Consulting Agreements</div>
                        </div>
                    </div>

                    <div class="legal-disclaimer">
                        <h6><i class="fas fa-exclamation-triangle me-2" style="color: #856404;"></i>Professional Legal Notice</h6>
                        <p class="small mb-0">This tool generates comprehensive legal documents using advanced AI. While professionally structured, complex legal matters should be reviewed by qualified legal counsel. All documents are generated for immediate professional use.</p>
                    </div>
                </div>
                
                <!-- Right Column -->
                <div class="col-lg-8">
                    <div class="content-card">
                        <h4 class="mb-4">Generate Professional Legal Document</h4>
                        
                        <!-- Usage Tracker -->
                        <div class="alert alert-info d-flex align-items-center mb-4" id="usageTracker">
                            <i class="fas fa-info-circle me-2"></i>
                            <div class="flex-grow-1">
                                <strong>Professional Uses Remaining:</strong> <span id="remainingUses">5</span> / 5 this month
                                <div class="small mt-1">Resets on: <span id="resetDate">1st of next month</span></div>
                            </div>
                             <button class="btn btn-primary" onclick="showUpgradeModal()">Upgrade</button>
                        </div>

                        <!-- Document Tabs -->
                        <div class="document-tabs mb-4">
                            <button class="doc-tab active" data-tab="draft">Draft Document</button>
                            <button class="doc-tab" data-tab="translate">Translate Document</button>
                        </div>
                        
                        <!-- Draft Document Section -->
                        <div id="draftSection" class="tab-content active">
                            <form id="legalDocumentForm">
                                <div class="mb-4">
                                    <label class="form-label fw-bold">Select Document Type</label>
                                    <div class="row" id="documentTypeSelector">
                                        <div class="col-md-4 mb-3">
                                            <div class="document-type-card card h-100" data-type="service_agreement">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-handshake mb-2" style="color: #14697D; font-size: 2rem;"></i>
                                                    <h6>Service Agreement</h6>
                                                    <small class="text-muted">Professional services</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="document-type-card card h-100" data-type="rental_lease">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-home mb-2" style="color: #14697D; font-size: 2rem;"></i>
                                                    <h6>Rental/Lease</h6>
                                                    <small class="text-muted">Property agreements</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="document-type-card card h-100" data-type="nda">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-user-secret mb-2" style="color: #14697D; font-size: 2rem;"></i>
                                                    <h6>Non-Disclosure</h6>
                                                    <small class="text-muted">Confidentiality</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="document-type-card card h-100" data-type="employment">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-briefcase mb-2" style="color: #14697D; font-size: 2rem;"></i>
                                                    <h6>Employment</h6>
                                                    <small class="text-muted">Job contracts</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="document-type-card card h-100" data-type="partnership">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-users mb-2" style="color: #14697D; font-size: 2rem;"></i>
                                                    <h6>Partnership</h6>
                                                    <small class="text-muted">Business partners</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="document-type-card card h-100" data-type="will_testament">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-scroll mb-2" style="color: #14697D; font-size: 2rem;"></i>
                                                    <h6>Will & Testament</h6>
                                                    <small class="text-muted">Estate planning</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="document-type-card card h-100" data-type="general_contract">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-file-signature mb-2" style="color: #14697D; font-size: 2rem;"></i>
                                                    <h6>General Contract</h6>
                                                    <small class="text-muted">Custom agreements</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="document-type-card card h-100" data-type="sale_of_goods">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-shopping-cart mb-2" style="color: #14697D; font-size: 2rem;"></i>
                                                    <h6>Sale of Goods</h6>
                                                    <small class="text-muted">Product sales</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="document-type-card card h-100" data-type="loan_agreement">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-money-bill-wave mb-2" style="color: #14697D; font-size: 2rem;"></i>
                                                    <h6>Loan Agreement</h6>
                                                    <small class="text-muted">Financial lending</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="document-type-card card h-100" data-type="ip_license">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-lightbulb mb-2" style="color: #14697D; font-size: 2rem;"></i>
                                                    <h6>IP License</h6>
                                                    <small class="text-muted">Intellectual property</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <div class="document-type-card card h-100" data-type="consulting_agreement">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-user-tie mb-2" style="color: #14697D; font-size: 2rem;"></i>
                                                    <h6>Consulting Agreement</h6>
                                                    <small class="text-muted">Professional consulting</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <input type="hidden" id="selectedDocType" name="documentType" required>
                                
                                <!-- Basic Information -->
                                <div class="mb-4">
                                    <h5>Legal Document Information</h5>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="jurisdiction" class="form-label">Legal Jurisdiction *</label>
                                            <select class="form-select" id="jurisdiction" name="jurisdiction" required>
                                                <option value="">Select jurisdiction</option>
                                                <option value="us_general">United States (Federal)</option>
                                                <option value="us_california">California, USA</option>
                                                <option value="us_new_york">New York, USA</option>
                                                <option value="us_texas">Texas, USA</option>
                                                <option value="uk_england">United Kingdom (England & Wales)</option>
                                                <option value="canada_general">Canada (Federal)</option>
                                                <option value="australia_general">Australia (Federal)</option>
                                                <option value="kenya">Kenya</option>
                                                <option value="nigeria">Nigeria</option>
                                                <option value="south_africa">South Africa</option>
                                                <option value="uganda">Uganda</option>
                                                <option value="ghana">Ghana</option>
                                                <option value="international">International (General)</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="documentTitle" class="form-label">Document Title</label>
                                            <input type="text" class="form-control" id="documentTitle" name="documentTitle" placeholder="e.g., Professional Service Agreement">
                                        </div>
                                    </div>
                                </div>

                                <!-- Party Information -->
                                <div class="mb-4">
                                    <h5>Contracting Parties</h5>
                                    <!-- First Party -->
                                    <div class="party-info">
                                        <h6 class="party1-label">First Party (Provider/Lessor/Seller/Employer)</h6>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="party1Name" class="form-label">Full Name/Company Name *</label>
                                                <input type="text" class="form-control" id="party1Name" name="party1Name" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="party1Address" class="form-label">Complete Address *</label>
                                                <input type="text" class="form-control" id="party1Address" name="party1Address" required>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="party1Email" class="form-label">Email Address</label>
                                                <input type="email" class="form-control" id="party1Email" name="party1Email">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="party1Phone" class="form-label">Phone Number</label>
                                                <input type="tel" class="form-control" id="party1Phone" name="party1Phone">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Second Party -->
                                    <div class="party-info">
                                        <h6 class="party2-label">Second Party (Client/Tenant/Buyer/Employee)</h6>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="party2Name" class="form-label">Full Name/Company Name *</label>
                                                <input type="text" class="form-control" id="party2Name" name="party2Name" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="party2Address" class="form-label">Complete Address *</label>
                                                <input type="text" class="form-control" id="party2Address" name="party2Address" required>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="party2Email" class="form-label">Email Address</label>
                                                <input type="email" class="form-control" id="party2Email" name="party2Email">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="party2Phone" class="form-label">Phone Number</label>
                                                <input type="tel" class="form-control" id="party2Phone" name="party2Phone">
                                            </div>
                                        </div>  
                                    </div>
                                </div>
                                
                                <!-- Document-Specific Fields -->
                                <div id="specificFields" class="mb-4">
                                    <!-- Dynamic fields will be inserted here based on document type -->
                                </div>

                                <button type="submit" class="btn btn-primary btn-lg w-100">
                                    <i class="fas fa-file-contract me-2"></i> Generate Complete Legal Document
                                </button>
                            </form>
                        </div>
                        
                        <!-- Translation Section -->
                        <div id="translateSection" class="tab-content">
                            <form id="translationForm">
                                <div class="mb-4">
                                    <label class="form-label fw-bold">Upload Document or Paste Text</label>
                                    
                                    <!-- File Upload Option -->
                                    <div class="mb-3">
                                        <label for="documentFile" class="form-label">Upload Document (Optional)</label>
                                        <input type="file" class="form-control" id="documentFile" accept=".txt,.doc,.docx,.pdf">
                                        <div class="form-text">Supported formats: TXT, DOC, DOCX, PDF</div>
                                    </div>
                                    
                                    <!-- Text Input Option -->
                                    <div class="mb-3">
                                        <label for="originalDocument" class="form-label">Or Paste Document Text</label>
                                        <textarea class="form-control" id="originalDocument" rows="8" placeholder="Paste your legal document text here for professional translation..."></textarea>
                                        <div class="form-text">Professional legal translation with terminology preservation</div>
                                    </div>
                                </div>

                                <!-- Source Language Selection -->
                                <div class="mb-4">
                                    <label class="form-label fw-bold">Source Language</label>
                                    <div class="row">
                                        <div class="col-md-3 mb-3">
                                            <div class="language-option source-language selected" data-lang="en" data-name="English">
                                                <i class="fas fa-flag mb-2" style="color: #1f77b4;"></i>
                                                <div>English</div>
                                                <small class="text-muted">Auto-detect</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="language-option source-language" data-lang="es" data-name="Spanish">
                                                <i class="fas fa-flag mb-2" style="color: #ff6b6b;"></i>
                                                <div>Spanish</div>
                                                <small class="text-muted">Español</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="language-option source-language" data-lang="fr" data-name="French">
                                                <i class="fas fa-flag mb-2" style="color: #4ecdc4;"></i>
                                                <div>French</div>
                                                <small class="text-muted">Français</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="language-option source-language" data-lang="de" data-name="German">
                                                <i class="fas fa-flag mb-2" style="color: #ffe66d;"></i>
                                                <div>German</div>
                                                <small class="text-muted">Deutsch</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="language-option source-language" data-lang="zh" data-name="Chinese">
                                                <i class="fas fa-flag mb-2" style="color: #ff8b94;"></i>
                                                <div>Chinese</div>
                                                <small class="text-muted">中文</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="language-option source-language" data-lang="sw" data-name="Swahili">
                                                <i class="fas fa-flag mb-2" style="color: #2ecc71;"></i>
                                                <div>Swahili</div>
                                                <small class="text-muted">Kiswahili</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="language-option source-language" data-lang="ar" data-name="Arabic">
                                                <i class="fas fa-flag mb-2" style="color: #00b894;"></i>
                                                <div>Arabic</div>
                                                <small class="text-muted">العربية</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="language-option source-language" data-lang="pt" data-name="Portuguese">
                                                <i class="fas fa-flag mb-2" style="color: #ffd93d;"></i>
                                                <div>Portuguese</div>
                                                <small class="text-muted">Português</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Language Direction Toggle -->
                                <div class="mb-4 text-center">
                                    <button type="button" class="btn btn-outline-primary" id="swapLanguages">
                                        <i class="fas fa-exchange-alt me-2"></i> Swap Languages
                                    </button>
                                </div>

                                <!-- Target Language Selection -->
                                <div class="mb-4">
                                    <label class="form-label fw-bold">Target Language</label>
                                    <div class="row">
                                        <div class="col-md-3 mb-3">
                                            <div class="language-option target-language" data-lang="en" data-name="English">
                                                <i class="fas fa-flag mb-2" style="color: #1f77b4;"></i>
                                                <div>English</div>
                                                <small class="text-muted">English</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="language-option target-language selected" data-lang="es" data-name="Spanish">
                                                <i class="fas fa-flag mb-2" style="color: #ff6b6b;"></i>
                                                <div>Spanish</div>
                                                <small class="text-muted">Español</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="language-option target-language" data-lang="fr" data-name="French">
                                                <i class="fas fa-flag mb-2" style="color: #4ecdc4;"></i>
                                                <div>French</div>
                                                <small class="text-muted">Français</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="language-option target-language" data-lang="de" data-name="German">
                                                <i class="fas fa-flag mb-2" style="color: #ffe66d;"></i>
                                                <div>German</div>
                                                <small class="text-muted">Deutsch</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="language-option target-language" data-lang="zh" data-name="Chinese">
                                                <i class="fas fa-flag mb-2" style="color: #ff8b94;"></i>
                                                <div>Chinese</div>
                                                <small class="text-muted">中文</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="language-option target-language" data-lang="sw" data-name="Swahili">
                                                <i class="fas fa-flag mb-2" style="color: #2ecc71;"></i>
                                                <div>Swahili</div>
                                                <small class="text-muted">Kiswahili</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="language-option target-language" data-lang="ar" data-name="Arabic">
                                                <i class="fas fa-flag mb-2" style="color: #00b894;"></i>
                                                <div>Arabic</div>
                                                <small class="text-muted">العربية</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="language-option target-language" data-lang="pt" data-name="Portuguese">
                                                <i class="fas fa-flag mb-2" style="color: #ffd93d;"></i>
                                                <div>Portuguese</div>
                                                <small class="text-muted">Português</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <input type="hidden" id="selectedSourceLanguage" name="sourceLanguage" value="en">
                                <input type="hidden" id="selectedTargetLanguage" name="targetLanguage" value="es">

                                <div class="mb-4">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="maintainLegalTerms" checked>
                                        <label class="form-check-label" for="maintainLegalTerms">
                                            Maintain legal terminology accuracy
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="includeOriginal">
                                        <label class="form-check-label" for="includeOriginal">
                                            Include original text alongside translation
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="detectLanguage" checked>
                                        <label class="form-check-label" for="detectLanguage">
                                            Auto-detect source language
                                        </label>
                                    </div>
                                </div>

                                <button type="submit" class="btn btn-primary btn-lg w-100">
                                    <i class="fas fa-language me-2"></i> Generate Professional Translation
                                </button>
                            </form>
                            
                            <!-- Translation Results -->
                            <div id="translationResults" class="mt-4" style="display: none;">
                                <h5 class="mb-3">Professional Translation Results</h5>
                                
                                <!-- Language Detection Result -->
                                <div id="detectionResult" class="alert alert-info" style="display: none;">
                                    <i class="fas fa-search me-2"></i>
                                    <strong>Detected Language:</strong> <span id="detectedLanguageName"></span>
                                </div>

                                <!-- Translation Progress -->
                                <div id="translationProgress" class="translation-progress" style="display: none;">
                                    <div class="translation-progress-bar" id="progressBar"></div>
                                    <div id="progressText" class="text-center small mt-1">Preparing professional translation...</div>
                                </div>
                                
                                <div class="document-preview mb-4" id="translationPreview">
                                    <!-- Translation will appear here -->
                                </div>
                                
                                <div class="export-options">
                                    <div class="export-option" id="downloadTranslationWord">
                                        <i class="fas fa-file-word"></i>
                                        <div>Download Word</div>
                                        <small class="text-muted">Professional .docx</small>
                                    </div>
                                    <div class="export-option" id="downloadTranslationPDF">
                                        <i class="fas fa-file-pdf"></i>
                                        <div>Download PDF</div>
                                        <small class="text-muted">Court-ready .pdf</small>
                                    </div>
                                    <div class="export-option" id="copyTranslation">
                                        <i class="fas fa-copy"></i>
                                        <div>Copy Text</div>
                                        <small class="text-muted">To clipboard</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Results Container -->
                        <div id="resultsContainer" class="content-card" style="display: none;">
                            <h4 class="mb-4">Your Professional Legal Document</h4>
                            
                            <!-- Document Preview -->
                            <div class="document-preview mb-4" id="documentPreview">
                                <!-- Generated document will appear here -->
                            </div>
                            
                            <!-- Export Options -->
                            <div class="export-options">
                                <div class="export-option" id="exportWord">
                                    <i class="fas fa-file-word"></i>
                                    <div>Download Word</div>
                                    <small class="text-muted">Professional .docx</small>
                                </div>
                                <div class="export-option" id="exportPDF">
                                    <i class="fas fa-file-pdf"></i>
                                    <div>Download PDF</div>
                                    <small class="text-muted">Court-ready .pdf</small>
                                </div>
                                <div class="export-option" id="copyDocument">
                                    <i class="fas fa-copy"></i>
                                    <div>Copy Text</div>
                                    <small class="text-muted">To clipboard</small>
                                </div>
                            </div>
                            
                            <div class="mt-4 d-flex gap-2">
                                <button class="btn btn-outline-primary" id="editDocumentBtn">
                                    <i class="fas fa-edit me-1"></i> Edit Document
                                </button>
                                <button class="btn btn-outline-secondary" id="newDocumentBtn">
                                    <i class="fas fa-plus me-1"></i> Create New Document
                                </button>
                            </div>
                        </div>
                        
                        <!-- Loading Spinner -->
                        <div class="loading-spinner" id="loadingSpinner"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- CTA Section -->
        <section class="py-5 mt-5" style="background-color: #f9f9f9;">
            <div class="container text-center">
                <h2 class="mb-4">Ready to create <span style="color: #14697D;">professional</span> legal documents?</h2>
                <p class="lead mb-4">Join thousands of professionals who trust Elevify's LegalEase for comprehensive legal document generation.</p>
                <a href="/#pricing" class="btn btn-primary btn-lg">
                    <i class="fas fa-rocket me-2"></i> Start Creating Professional Documents
                </a>
            </div>
        </section>
    </main>
    
    <footer class="py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <h1 class="brand-logo" style="font-size: 1.8rem;">elevify<span class="accent-dot" style="color: #FFbf23;">.</span></h1>
                    <p>Elevate your potential with AI-powered tools that help you work smarter, not harder.</p>
                </div>
                <div class="col-md-4 mb-3">
                    <h5>Quick Links</h5>
                    <ul class="list-unstyled">
                        <li><a href="/">Home</a></li>
                        <li><a href="/#tools">Tools</a></li>
                        <li><a href="/#pricing">Pricing</a></li>
                        <li><a href="/#contact">Contact</a></li>
                    </ul>
                </div>
                <div class="col-md-4 mb-3">
                    <h5>Connect With Us</h5>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-linkedin"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-12 text-center">
                    <p>&copy; 2025 by Elo.</p>
                </div>
            </div>
        </div>
    </footer>
     <!-- Upgrade Modal -->
<div class="modal fade" id="upgradeModal" tabindex="-1" aria-labelledby="upgradeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content" style="border-radius: 20px; border: none;">
            <div class="modal-header" style="border-bottom: 1px solid #e0e0e0;">
                <h5 class="modal-title" id="upgradeModalLabel" style="font-family: 'Antic Slab', serif; color: #14697D;">
                    <i class="fas fa-crown me-2" style="color: #FFbf23;"></i>Upgrade for Unlimited Access
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4">
                <p class="text-center mb-4" style="font-family: 'Quicksand', sans-serif; color: #666;">
                    Choose the plan that works best for you and unlock unlimited access.
                </p>
                
                <!-- Pricing Cards Container -->
                <div class="row g-3 mb-4">
                    <!-- Pay As You Go -->
                    <div class="col-12 col-md-6 col-lg-4">
                        <div class="pricing-tier-card brand-type-card card h-100" data-tier="payasyougo" data-url="https://elevify.net?wanted=https://elevify.net/writesuite">
                            <div class="card-body text-center p-3">
                                <i class="fas fa-gift mb-2" style="color: #14697D; font-size: 2rem;"></i>
                                <h6>Pay As You Go </h6>
                                <small class="text-muted mb-3 d-block">24 Hour Access for WriterSuite</small>
                                <div class="price-display mb-3">
                                    <span style="font-size: 2rem; font-weight: bold; color: #14697D;">$1</span>
                                </div>
                                <div class="features-list text-start">
                                    <div class="mb-1"><i class="fas fa-check text-success me-2"></i><small>24-hour unlimited access to WriteSuite</small></div>
                                    <div class="mb-1"><i class="fas fa-check text-success me-2"></i><small>All writing tools included (Write, Edit, Proofread, Summarize, Rewrite)</small></div>
                                    <div class="mb-1"><i class="fas fa-times text-muted me-2"></i><small>No monthly commitment - pay only when you need it</small></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 24 Hour Pass -->
                    <div class="col-12 col-md-6 col-lg-4">
                        <div class="pricing-tier-card brand-type-card card h-100" data-tier="24hourpass" data-url="https://elevify.gumroad.com/l/hngcmx?wanted=https://elevify.net/writesuite">
                            <div class="card-body text-center p-3 position-relative">
                                <span class="badge position-absolute" style="top: 10px; right: 10px; background-color: #FFbf23; color: #000; font-size: 0.7rem;">Popular</span>
                                <i class="fas fa-clock mb-2" style="color: #14697D; font-size: 2rem;"></i>
                                <h6>24-Hour Pass</h6>
                                <small class="text-muted mb-3 d-block">All tools unlimited for 24 hours</small>
                                <div class="price-display mb-3">
                                    <span style="font-size: 2rem; font-weight: bold; color: #14697D;">$2</span>
                                </div>
                                <div class="features-list text-start">
                                    <div class="mb-1"><i class="fas fa-check text-success me-2"></i><small>Unlimited access to ALL Elevify tools for 24 hours</small></div>
                                    <div class="mb-1"><i class="fas fa-check text-success me-2"></i><small>No daily limits - generate as much as you need</small></div>
                                    <div class="mb-1"><i class="fas fa-check text-success me-2"></i><small>Batch processing - work on multiple projects</small></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pro Tier -->
                    <div class="col-12 col-md-12 col-lg-4">
                        <div class="pricing-tier-card brand-type-card card h-100" data-tier="pro" data-url="https://elevify.gumroad.com/l/flbal?wanted=https://elevify.net/writesuite">
                            <div class="card-body text-center p-3 position-relative">
                                <span class="badge position-absolute" style="top: 10px; right: 10px; background-color: #14697D; color: white; font-size: 0.7rem;">Best Value</span>
                                <i class="fas fa-crown mb-2" style="color: #14697D; font-size: 2rem;"></i>
                                <h6>Pro Monthly</h6>
                                <small class="text-muted mb-3 d-block">Full unlimited access</small>
                                <div class="price-display mb-3">
                                    <span style="font-size: 2rem; font-weight: bold; color: #14697D;">$15</span>
                                    <small class="text-muted">/month</small>
                                </div>
                                <div class="features-list text-start">
                                    <div class="mb-1"><i class="fas fa-check text-success me-2"></i><small>Unlimited monthly usage across all tools</small></div>
                                    <div class="mb-1"><i class="fas fa-check text-success me-2"></i><small>Brand consistency tools - maintain your voice across all content</small></div>
                                    <div class="mb-1"><i class="fas fa-check text-success me-2"></i><small>Bulk operations - process multiple documents at once</small></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Hidden input to track selection -->
                <input type="hidden" id="selectedPricingTier" name="pricingTier" required>
                
                <!-- Get Button -->
                <button type="button" class="btn btn-primary btn-lg w-100" id="getSelectedPlan" disabled>
                    <i class="fas fa-shopping-cart me-2"></i>Get Selected Plan
                </button>
                
                <div class="text-center mt-3">
                    <small class="text-muted">Secure payment powered by Gumroad</small>
                </div>
            </div>
        </div>
    </div>
</div>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jsPDF Library for PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <script>
        // ============================================================================
// SECTION 1: CONFIGURATION AND DOCUMENT TYPES
// ============================================================================

// Enhanced document party labels configuration
const documentPartyLabels = {
    'service_agreement': { 
        party1: 'Service Provider', 
        party2: 'Client',
        party1Description: 'The party providing professional services',
        party2Description: 'The party receiving professional services'
    },
    'rental_lease': { 
        party1: 'Landlord/Lessor', 
        party2: 'Tenant/Lessee',
        party1Description: 'The property owner or lessor',
        party2Description: 'The tenant or lessee'
    },
    'nda': { 
        party1: 'Disclosing Party', 
        party2: 'Receiving Party',
        party1Description: 'The party sharing confidential information',
        party2Description: 'The party receiving confidential information'
    },
    'employment': { 
        party1: 'Employer', 
        party2: 'Employee',
        party1Description: 'The hiring company or organization',
        party2Description: 'The individual being hired'
    },
    'partnership': { 
        party1: 'Partner 1', 
        party2: 'Partner 2',
        party1Description: 'First business partner',
        party2Description: 'Second business partner'
    },
    'will_testament': { 
        party1: 'Testator', 
        party2: 'Executor',
        party1Description: 'The person creating the will',
        party2Description: 'The person executing the will'
    },
    'general_contract': { 
        party1: 'First Party', 
        party2: 'Second Party',
        party1Description: 'Primary contracting party',
        party2Description: 'Secondary contracting party'
    },
    'sale_of_goods': { 
        party1: 'Seller', 
        party2: 'Buyer',
        party1Description: 'The party selling goods',
        party2Description: 'The party purchasing goods'
    },
    'loan_agreement': { 
        party1: 'Lender', 
        party2: 'Borrower',
        party1Description: 'The party providing the loan',
        party2Description: 'The party receiving the loan'
    },
    'ip_license': { 
        party1: 'Licensor', 
        party2: 'Licensee',
        party1Description: 'The intellectual property owner',
        party2Description: 'The party receiving the license'
    },
    'consulting_agreement': { 
        party1: 'Consultant', 
        party2: 'Client',
        party1Description: 'The consulting professional',
        party2Description: 'The client receiving consulting services'
    }
};

// Enhanced document-specific fields configuration
const documentSpecificFields = {
    'service_agreement': {
        title: 'Service Agreement Details',
        icon: 'fas fa-handshake',
        fields: [
            {
                group: 'Service Details',
                icon: 'fas fa-clipboard-list',
                fields: [
                    {
                        id: 'serviceDescription',
                        label: 'Comprehensive Service Description',
                        type: 'textarea',
                        required: true,
                        rows: 4,
                        placeholder: 'Provide detailed description of all services including scope, deliverables, timeline, quality standards, and performance metrics...',
                        help: 'Be specific about what services will be provided, how they will be delivered, and what constitutes successful completion'
                    },
                    {
                        id: 'serviceCategory',
                        label: 'Primary Service Category',
                        type: 'select',
                        required: true,
                        options: [
                            { value: '', text: 'Select service category' },
                            { value: 'consulting', text: 'Professional Consulting' },
                            { value: 'design', text: 'Design Services' },
                            { value: 'development', text: 'Development/Programming' },
                            { value: 'marketing', text: 'Marketing/Advertising' },
                            { value: 'legal', text: 'Legal Services' },
                            { value: 'accounting', text: 'Accounting/Financial' },
                            { value: 'maintenance', text: 'Maintenance/Support' },
                            { value: 'training', text: 'Training/Education' },
                            { value: 'other', text: 'Other Professional Services' }
                        ],
                        help: 'Select the primary category that best describes your services'
                    }
                ]
            },
            {
                group: 'Financial Terms',
                icon: 'fas fa-dollar-sign',
                fields: [
                    {
                        id: 'compensationAmount',
                        label: 'Compensation Amount',
                        type: 'text',
                        required: true,
                        placeholder: 'e.g., $75/hour, $5,000 total, $1,500/month',
                        help: 'Specify the exact amount and currency'
                    },
                    {
                        id: 'paymentSchedule',
                        label: 'Payment Schedule',
                        type: 'select',
                        required: true,
                        options: [
                            { value: '', text: 'Select payment schedule' },
                            { value: 'upfront', text: 'Full Payment Upfront' },
                            { value: 'completion', text: 'Payment Upon Completion' },
                            { value: 'milestone', text: 'Milestone-based Payments' },
                            { value: 'monthly', text: 'Monthly Payments' },
                            { value: 'bi_weekly', text: 'Bi-weekly Payments' },
                            { value: '50_50', text: '50% Upfront, 50% on Completion' }
                        ]
                    }
                ]
            },
            {
                group: 'Timeline',
                icon: 'fas fa-calendar-alt',
                fields: [
                    {
                        id: 'projectStartDate',
                        label: 'Project Start Date',
                        type: 'date',
                        required: true,
                        help: 'When will the services begin?'
                    },
                    {
                        id: 'projectEndDate',
                        label: 'Expected Completion Date',
                        type: 'date',
                        help: 'When should the project be completed?'
                    }
                ]
            }
        ]
    },
    'rental_lease': {
        title: 'Rental/Lease Agreement Details',
        icon: 'fas fa-home',
        fields: [
            {
                group: 'Property Information',
                icon: 'fas fa-building',
                fields: [
                    {
                        id: 'propertyAddress',
                        label: 'Complete Property Address',
                        type: 'text',
                        required: true,
                        placeholder: 'Full address including unit number, city, state, ZIP code',
                        help: 'Provide the complete legal address of the rental property'
                    },
                    {
                        id: 'propertyDescription',
                        label: 'Property Description',
                        type: 'textarea',
                        rows: 3,
                        placeholder: 'Describe the property including bedrooms, bathrooms, square footage, amenities...',
                        help: 'Detailed description of the rental property'
                    }
                ]
            },
            {
                group: 'Financial Terms',
                icon: 'fas fa-dollar-sign',
                fields: [
                    {
                        id: 'monthlyRent',
                        label: 'Monthly Rent Amount',
                        type: 'number',
                        required: true,
                        placeholder: '2500',
                        step: '0.01',
                        help: 'Monthly rent amount in dollars'
                    },
                    {
                        id: 'securityDeposit',
                        label: 'Security Deposit',
                        type: 'number',
                        required: true,
                        placeholder: '2500',
                        step: '0.01',
                        help: 'Security deposit amount'
                    },
                    {
                        id: 'utilitiesResponsible',
                        label: 'Utilities Responsibility',
                        type: 'select',
                        required: true,
                        options: [
                            { value: '', text: 'Select utility arrangement' },
                            { value: 'tenant_all', text: 'Tenant pays all utilities' },
                            { value: 'landlord_all', text: 'Landlord pays all utilities' },
                            { value: 'split', text: 'Split utility costs' },
                            { value: 'tenant_electric_gas', text: 'Tenant pays electric/gas only' }
                        ]
                    }
                ]
            },
            {
                group: 'Lease Terms',
                icon: 'fas fa-calendar-check',
                fields: [
                    {
                        id: 'leaseStartDate',
                        label: 'Lease Start Date',
                        type: 'date',
                        required: true,
                        help: 'When does the lease begin?'
                    },
                    {
                        id: 'leaseTermMonths',
                        label: 'Lease Term (Months)',
                        type: 'number',
                        required: true,
                        placeholder: '12',
                        min: '1',
                        max: '60',
                        help: 'Duration of the lease in months'
                    },
                    {
                        id: 'renewalOptions',
                        label: 'Renewal Options',
                        type: 'select',
                        options: [
                            { value: '', text: 'Select renewal option' },
                            { value: 'automatic', text: 'Automatic renewal' },
                            { value: 'option_to_renew', text: 'Option to renew' },
                            { value: 'no_renewal', text: 'No automatic renewal' }
                        ]
                    }
                ]
            }
        ]
    },
    'nda': {
        title: 'Non-Disclosure Agreement Details',
        icon: 'fas fa-user-secret',
        fields: [
            {
                group: 'Confidentiality Terms',
                icon: 'fas fa-lock',
                fields: [
                    {
                        id: 'ndaType',
                        label: 'NDA Type',
                        type: 'select',
                        required: true,
                        options: [
                            { value: '', text: 'Select NDA type' },
                            { value: 'unilateral', text: 'Unilateral (One-way disclosure)' },
                            { value: 'mutual', text: 'Mutual (Two-way disclosure)' },
                            { value: 'multilateral', text: 'Multilateral (Multiple parties)' }
                        ]
                    },
                    {
                        id: 'confidentialInfo',
                        label: 'Confidential Information Description',
                        type: 'textarea',
                        required: true,
                        rows: 4,
                        placeholder: 'Describe the type of confidential information to be protected...',
                        help: 'Be specific about what information is considered confidential'
                    },
                    {
                        id: 'ndaDuration',
                        label: 'Confidentiality Duration',
                        type: 'select',
                        required: true,
                        options: [
                            { value: '', text: 'Select duration' },
                            { value: '1_year', text: '1 Year' },
                            { value: '2_years', text: '2 Years' },
                            { value: '3_years', text: '3 Years' },
                            { value: '5_years', text: '5 Years' },
                            { value: '10_years', text: '10 Years' },
                            { value: 'indefinite', text: 'Indefinite/Perpetual' }
                        ]
                    }
                ]
            }
        ]
    },
    'employment': {
        title: 'Employment Agreement Details',
        icon: 'fas fa-briefcase',
        fields: [
            {
                group: 'Position Details',
                icon: 'fas fa-user-tie',
                fields: [
                    {
                        id: 'jobTitle',
                        label: 'Job Title/Position',
                        type: 'text',
                        required: true,
                        placeholder: 'e.g., Senior Software Developer',
                        help: 'Official job title'
                    },
                    {
                        id: 'jobDescription',
                        label: 'Job Description & Responsibilities',
                        type: 'textarea',
                        rows: 4,
                        placeholder: 'Describe main duties, responsibilities, and expectations...',
                        help: 'Detailed description of job responsibilities'
                    },
                    {
                        id: 'department',
                        label: 'Department/Division',
                        type: 'text',
                        placeholder: 'e.g., Engineering, Marketing, Sales',
                        help: 'Which department will the employee work in?'
                    }
                ]
            },
            {
                group: 'Compensation & Benefits',
                icon: 'fas fa-dollar-sign',
                fields: [
                    {
                        id: 'salary',
                        label: 'Annual Salary',
                        type: 'text',
                        required: true,
                        placeholder: 'e.g., $75,000 annually',
                        help: 'Annual compensation amount'
                    },
                    {
                        id: 'payFrequency',
                        label: 'Pay Frequency',
                        type: 'select',
                        required: true,
                        options: [
                            { value: '', text: 'Select pay frequency' },
                            { value: 'weekly', text: 'Weekly' },
                            { value: 'bi_weekly', text: 'Bi-weekly' },
                            { value: 'semi_monthly', text: 'Semi-monthly' },
                            { value: 'monthly', text: 'Monthly' }
                        ]
                    },
                    {
                        id: 'benefits',
                        label: 'Benefits Package',
                        type: 'textarea',
                        rows: 3,
                        placeholder: 'Describe health insurance, retirement, vacation, etc...',
                        help: 'Detail the benefits provided'
                    }
                ]
            },
            {
                group: 'Employment Terms',
                icon: 'fas fa-calendar-check',
                fields: [
                    {
                        id: 'startDate',
                        label: 'Employment Start Date',
                        type: 'date',
                        required: true,
                        help: 'When does employment begin?'
                    },
                    {
                        id: 'employmentType',
                        label: 'Employment Type',
                        type: 'select',
                        required: true,
                        options: [
                            { value: '', text: 'Select employment type' },
                            { value: 'full_time', text: 'Full-time' },
                            { value: 'part_time', text: 'Part-time' },
                            { value: 'contract', text: 'Contract' },
                            { value: 'temporary', text: 'Temporary' },
                            { value: 'at_will', text: 'At-will' }
                        ]
                    },
                    {
                        id: 'workingHours',
                        label: 'Working Hours',
                        type: 'text',
                        placeholder: 'e.g., Monday-Friday 9:00 AM - 5:00 PM',
                        help: 'Standard working hours and schedule'
                    }
                ]
            }
        ]
    },
    'partnership': {
        title: 'Partnership Agreement Details',
        icon: 'fas fa-users',
        fields: [
            {
                group: 'Business Information',
                icon: 'fas fa-building',
                fields: [
                    {
                        id: 'businessName',
                        label: 'Partnership/Business Name',
                        type: 'text',
                        required: true,
                        placeholder: 'Legal name of the partnership',
                        help: 'Official business name'
                    },
                    {
                        id: 'businessPurpose',
                        label: 'Business Purpose',
                        type: 'textarea',
                        required: true,
                        rows: 3,
                        placeholder: 'Describe the main business activities and purpose...',
                        help: 'What is the primary purpose of the partnership?'
                    },
                    {
                        id: 'businessType',
                        label: 'Partnership Type',
                        type: 'select',
                        required: true,
                        options: [
                            { value: '', text: 'Select partnership type' },
                            { value: 'general', text: 'General Partnership' },
                            { value: 'limited', text: 'Limited Partnership' },
                            { value: 'llp', text: 'Limited Liability Partnership' },
                            { value: 'joint_venture', text: 'Joint Venture' }
                        ]
                    }
                ]
            },
            {
                group: 'Financial Terms',
                icon: 'fas fa-chart-pie',
                fields: [
                    {
                        id: 'capitalContribution',
                        label: 'Capital Contribution Details',
                        type: 'textarea',
                        required: true,
                        rows: 3,
                        placeholder: 'Describe each partner\'s financial contribution...',
                        help: 'Detail what each partner is contributing financially'
                    },
                    {
                        id: 'profitSharing',
                        label: 'Profit Sharing Arrangement',
                        type: 'text',
                        placeholder: 'e.g., 50/50 split, 60/40 split, equal shares',
                        help: 'How will profits be distributed?'
                    },
                    {
                        id: 'lossSharing',
                        label: 'Loss Sharing Arrangement',
                        type: 'text',
                        placeholder: 'e.g., proportional to investment, equal shares',
                        help: 'How will losses be shared?'
                    }
                ]
            }
        ]
    },
    'loan_agreement': {
        title: 'Loan Agreement Details',
        icon: 'fas fa-money-bill-wave',
        fields: [
            {
                group: 'Loan Terms',
                icon: 'fas fa-calculator',
                fields: [
                    {
                        id: 'loanAmount',
                        label: 'Principal Loan Amount',
                        type: 'number',
                        required: true,
                        placeholder: '75000.00',
                        step: '0.01',
                        help: 'Total amount being borrowed'
                    },
                    {
                        id: 'interestRate',
                        label: 'Annual Interest Rate (%)',
                        type: 'number',
                        required: true,
                        placeholder: '6.5',
                        step: '0.01',
                        min: '0',
                        max: '50',
                        help: 'Annual percentage rate'
                    },
                    {
                        id: 'loanTerm',
                        label: 'Loan Term',
                        type: 'text',
                        required: true,
                        placeholder: 'e.g., 36 months, 5 years',
                        help: 'Duration of the loan'
                    }
                ]
            },
            {
                group: 'Repayment Terms',
                icon: 'fas fa-calendar-alt',
                fields: [
                    {
                        id: 'repaymentSchedule',
                        label: 'Payment Frequency',
                        type: 'select',
                        required: true,
                        options: [
                            { value: '', text: 'Select payment frequency' },
                            { value: 'monthly', text: 'Monthly' },
                            { value: 'bi_weekly', text: 'Bi-weekly' },
                            { value: 'quarterly', text: 'Quarterly' },
                            { value: 'annually', text: 'Annually' }
                        ]
                    },
                    {
                        id: 'firstPaymentDate',
                        label: 'First Payment Date',
                        type: 'date',
                        required: true,
                        help: 'When is the first payment due?'
                    },
                    {
                        id: 'collateral',
                        label: 'Collateral/Security',
                        type: 'textarea',
                        rows: 3,
                        placeholder: 'Describe any collateral securing the loan...',
                        help: 'What assets secure this loan?'
                    }
                ]
            }
        ]
    },
    'sale_of_goods': {
        title: 'Sale of Goods Agreement Details',
        icon: 'fas fa-shopping-cart',
        fields: [
            {
                group: 'Product Details',
                icon: 'fas fa-box',
                fields: [
                    {
                        id: 'goodsDescription',
                        label: 'Detailed Description of Goods',
                        type: 'textarea',
                        required: true,
                        rows: 4,
                        placeholder: 'Provide comprehensive description including specifications, model numbers, quantities...',
                        help: 'Be specific about what is being sold'
                    },
                    {
                        id: 'quantity',
                        label: 'Quantity',
                        type: 'text',
                        required: true,
                        placeholder: 'e.g., 100 units, 50 pieces',
                        help: 'Total quantity being sold'
                    },
                    {
                        id: 'condition',
                        label: 'Condition of Goods',
                        type: 'select',
                        required: true,
                        options: [
                            { value: '', text: 'Select condition' },
                            { value: 'new', text: 'New' },
                            { value: 'used_excellent', text: 'Used - Excellent' },
                            { value: 'used_good', text: 'Used - Good' },
                            { value: 'used_fair', text: 'Used - Fair' },
                            { value: 'refurbished', text: 'Refurbished' },
                            { value: 'as_is', text: 'As-Is' }
                        ]
                    }
                ]
            },
            {
                group: 'Pricing & Payment',
                icon: 'fas fa-dollar-sign',
                fields: [
                    {
                        id: 'unitPrice',
                        label: 'Unit Price',
                        type: 'number',
                        required: true,
                        placeholder: '150.00',
                        step: '0.01',
                        help: 'Price per unit'
                    },
                    {
                        id: 'totalPrice',
                        label: 'Total Sale Price',
                        type: 'number',
                        required: true,
                        placeholder: '15000.00',
                        step: '0.01',
                        help: 'Total amount for all goods'
                    },
                    {
                        id: 'paymentTerms',
                        label: 'Payment Terms',
                        type: 'select',
                        required: true,
                        options: [
                            { value: '', text: 'Select payment terms' },
                            { value: 'cash_on_delivery', text: 'Cash on Delivery' },
                            { value: 'payment_upfront', text: 'Full Payment Upfront' },
                            { value: 'net_30', text: 'Net 30 Days' },
                            { value: 'net_60', text: 'Net 60 Days' },
                            { value: 'installments', text: 'Installment Payments' }
                        ]
                    }
                ]
            },
            {
                group: 'Delivery Terms',
                icon: 'fas fa-truck',
                fields: [
                    {
                        id: 'deliveryDate',
                        label: 'Delivery Date',
                        type: 'date',
                        help: 'When will goods be delivered?'
                    },
                    {
                        id: 'deliveryLocation',
                        label: 'Delivery Location',
                        type: 'text',
                        placeholder: 'Complete delivery address',
                        help: 'Where will the goods be delivered?'
                    },
                    {
                        id: 'shippingTerms',
                        label: 'Shipping Terms',
                        type: 'select',
                        options: [
                            { value: '', text: 'Select shipping terms' },
                            { value: 'seller_pays', text: 'Seller Pays Shipping' },
                            { value: 'buyer_pays', text: 'Buyer Pays Shipping' },
                            { value: 'fob_origin', text: 'FOB Origin' },
                            { value: 'fob_destination', text: 'FOB Destination' }
                        ]
                    }
                ]
            }
        ]
    },
    'ip_license': {
        title: 'IP License Agreement Details',
        icon: 'fas fa-lightbulb',
        fields: [
            {
                group: 'Intellectual Property Details',
                icon: 'fas fa-copyright',
                fields: [
                    {
                        id: 'ipType',
                        label: 'Type of Intellectual Property',
                        type: 'select',
                        required: true,
                        options: [
                            { value: '', text: 'Select IP type' },
                            { value: 'copyright', text: 'Copyright' },
                            { value: 'trademark', text: 'Trademark' },
                            { value: 'patent', text: 'Patent' },
                            { value: 'trade_secret', text: 'Trade Secret' },
                            { value: 'software', text: 'Software/Source Code' },
                            { value: 'know_how', text: 'Know-how' }
                        ]
                    },
                    {
                        id: 'ipDescription',
                        label: 'IP Description',
                        type: 'textarea',
                        required: true,
                        rows: 4,
                        placeholder: 'Provide detailed description of the intellectual property...',
                        help: 'Describe the IP being licensed'
                    },
                    {
                        id: 'ipRegistration',
                        label: 'Registration Details',
                        type: 'text',
                        placeholder: 'Patent/Trademark/Copyright registration number',
                        help: 'If registered, provide registration details'
                    }
                ]
            },
            {
                group: 'License Terms',
                icon: 'fas fa-key',
                fields: [
                    {
                        id: 'licenseType',
                        label: 'License Type',
                        type: 'select',
                        required: true,
                        options: [
                            { value: '', text: 'Select license type' },
                            { value: 'exclusive', text: 'Exclusive License' },
                            { value: 'non_exclusive', text: 'Non-Exclusive License' },
                            { value: 'sole', text: 'Sole License' }
                        ]
                    },
                    {
                        id: 'licenseScope',
                        label: 'License Scope',
                        type: 'textarea',
                        required: true,
                        rows: 3,
                        placeholder: 'Define the scope of the license grant...',
                        help: 'What rights are being granted?'
                    },
                    {
                        id: 'territory',
                        label: 'Geographic Territory',
                        type: 'text',
                        placeholder: 'e.g., Worldwide, United States, California',
                        help: 'Where can the IP be used?'
                    },
                    {
                        id: 'licenseDuration',
                        label: 'License Duration',
                        type: 'text',
                        placeholder: 'e.g., 5 years, perpetual, until patent expires',
                        help: 'How long does the license last?'
                    }
                ]
            },
            {
                group: 'Financial Terms',
                icon: 'fas fa-dollar-sign',
                fields: [
                    {
                        id: 'royaltyRate',
                        label: 'Royalty Rate/License Fee',
                        type: 'text',
                        placeholder: 'e.g., 5% of net sales, $10,000 upfront',
                        help: 'How much will be paid for the license?'
                    },
                    {
                        id: 'minimumRoyalty',
                        label: 'Minimum Royalty/Guarantee',
                        type: 'text',
                        placeholder: 'e.g., $5,000 annually',
                        help: 'Minimum payment required'
                    }
                ]
            }
        ]
    },
    'consulting_agreement': {
        title: 'Consulting Agreement Details',
        icon: 'fas fa-user-tie',
        fields: [
            {
                group: 'Consulting Services',
                icon: 'fas fa-briefcase',
                fields: [
                    {
                        id: 'consultingServices',
                        label: 'Consulting Services Description',
                        type: 'textarea',
                        required: true,
                        rows: 4,
                        placeholder: 'Provide detailed description of consulting services to be provided...',
                        help: 'What specific consulting services will be provided?'
                    },
                    {
                        id: 'consultingCategory',
                        label: 'Consulting Category',
                        type: 'select',
                        required: true,
                        options: [
                            { value: '', text: 'Select consulting category' },
                            { value: 'business_strategy', text: 'Business Strategy' },
                            { value: 'technology', text: 'Technology Consulting' },
                            { value: 'marketing', text: 'Marketing Consulting' },
                            { value: 'financial', text: 'Financial Consulting' },
                            { value: 'hr', text: 'Human Resources' },
                            { value: 'operations', text: 'Operations Consulting' },
                            { value: 'legal', text: 'Legal Consulting' },
                            { value: 'other', text: 'Other Specialized Consulting' }
                        ]
                    },
                    {
                        id: 'deliverables',
                        label: 'Expected Deliverables',
                        type: 'textarea',
                        rows: 3,
                        placeholder: 'List specific deliverables, reports, or outcomes...',
                        help: 'What will be delivered to the client?'
                    }
                ]
            },
            {
                group: 'Engagement Terms',
                icon: 'fas fa-handshake',
                fields: [
                    {
                        id: 'consultingFee',
                        label: 'Consulting Fee Structure',
                        type: 'text',
                        required: true,
                        placeholder: 'e.g., $150/hour, $10,000 project fee, $5,000/month',
                        help: 'How will consulting fees be structured?'
                    },
                    {
                        id: 'feeStructure',
                        label: 'Fee Structure Type',
                        type: 'select',
                        required: true,
                        options: [
                            { value: '', text: 'Select fee structure' },
                            { value: 'hourly', text: 'Hourly Rate' },
                            { value: 'fixed', text: 'Fixed Project Fee' },
                            { value: 'retainer', text: 'Monthly Retainer' },
                            { value: 'success_fee', text: 'Success/Performance Fee' },
                            { value: 'hybrid', text: 'Hybrid Structure' }
                        ]
                    },
                    {
                        id: 'consultingDuration',
                        label: 'Consulting Duration',
                        type: 'text',
                        placeholder: 'e.g., 3 months, 6 months, ongoing',
                        help: 'How long will the consulting engagement last?'
                    },
                    {
                        id: 'workLocation',
                        label: 'Work Location',
                        type: 'select',
                        options: [
                            { value: '', text: 'Select work location' },
                            { value: 'remote', text: 'Remote/Virtual' },
                            { value: 'client_site', text: 'Client Site' },
                            { value: 'consultant_office', text: 'Consultant Office' },
                            { value: 'hybrid', text: 'Hybrid (Mix of locations)' }
                        ]
                    }
                ]
            }
        ]
    },
    'will_testament': {
        title: 'Will & Testament Details',
        icon: 'fas fa-scroll',
        fields: [
            {
                group: 'Executor Information',
                icon: 'fas fa-user-check',
                fields: [
                    {
                        id: 'executor',
                        label: 'Primary Executor Name',
                        type: 'text',
                        required: true,
                        placeholder: 'Full legal name of executor',
                        help: 'Who will execute this will?'
                    },
                    {
                        id: 'executorAddress',
                        label: 'Executor Address',
                        type: 'text',
                        required: true,
                        placeholder: 'Complete address of executor',
                        help: 'Executor\'s full address'
                    },
                    {
                        id: 'alternateExecutor',
                        label: 'Alternate Executor',
                        type: 'text',
                        placeholder: 'Name of alternate executor',
                        help: 'Backup executor if primary is unavailable'
                    }
                ]
            },
            {
                group: 'Beneficiaries',
                icon: 'fas fa-users',
                fields: [
                    {
                        id: 'beneficiaries',
                        label: 'Primary Beneficiaries',
                        type: 'textarea',
                        required: true,
                        rows: 4,
                        placeholder: 'List each beneficiary with full name, relationship, and contact information...',
                        help: 'Who will inherit from this will?'
                    },
                    {
                        id: 'contingentBeneficiaries',
                        label: 'Contingent Beneficiaries',
                        type: 'textarea',
                        rows: 3,
                        placeholder: 'List backup beneficiaries...',
                        help: 'Who inherits if primary beneficiaries cannot?'
                    }
                ]
            },
            {
                group: 'Asset Distribution',
                icon: 'fas fa-chart-pie',
                fields: [
                    {
                        id: 'assetDistribution',
                        label: 'Detailed Asset Distribution',
                        type: 'textarea',
                        required: true,
                        rows: 5,
                        placeholder: 'Describe how assets should be distributed including specific bequests, percentages, etc...',
                        help: 'How should your assets be divided?'
                    },
                    {
                        id: 'specificBequests',
                        label: 'Specific Bequests',
                        type: 'textarea',
                        rows: 3,
                        placeholder: 'List specific items and who should receive them...',
                        help: 'Any specific items for specific people?'
                    },
                    {
                        id: 'residualEstate',
                        label: 'Residual Estate Distribution',
                        type: 'textarea',
                        rows: 2,
                        placeholder: 'How should remaining assets be distributed?',
                        help: 'What happens to everything else?'
                    }
                ]
            },
            {
                group: 'Special Provisions',
                icon: 'fas fa-baby',
                fields: [
                    {
                        id: 'guardianship',
                        label: 'Guardian for Minor Children',
                        type: 'text',
                        placeholder: 'Name of guardian for minor children',
                        help: 'Who will care for minor children?'
                    },
                    {
                        id: 'specialInstructions',
                        label: 'Special Instructions',
                        type: 'textarea',
                        rows: 3,
                        placeholder: 'Any special wishes, funeral arrangements, or other instructions...',
                        help: 'Any special requests or instructions?'
                    }
                ]
            }
        ]
    },
    'general_contract': {
        title: 'General Contract Details',
        icon: 'fas fa-file-signature',
        fields: [
            {
                group: 'Contract Information',
                icon: 'fas fa-info-circle',
                fields: [
                    {
                        id: 'contractSubject',
                        label: 'Contract Subject/Title',
                        type: 'text',
                        required: true,
                        placeholder: 'e.g., Website Development Agreement',
                        help: 'What is this contract about?'
                    },
                    {
                        id: 'contractPurpose',
                        label: 'Contract Purpose',
                        type: 'textarea',
                        required: true,
                        rows: 3,
                        placeholder: 'Describe the main purpose and objectives of this contract...',
                        help: 'Why is this contract being created?'
                    }
                ]
            },
            {
                group: 'Terms & Obligations',
                icon: 'fas fa-tasks',
                fields: [
                    {
                        id: 'obligations',
                        label: 'Detailed Obligations & Responsibilities',
                        type: 'textarea',
                        required: true,
                        rows: 5,
                        placeholder: 'Describe what each party is obligated to do...',
                        help: 'What must each party do under this contract?'
                    },
                    {
                        id: 'performanceStandards',
                        label: 'Performance Standards',
                        type: 'textarea',
                        rows: 3,
                        placeholder: 'Define quality standards and performance metrics...',
                        help: 'How will performance be measured?'
                    }
                ]
            },
            {
                group: 'Financial & Timeline',
                icon: 'fas fa-calendar-dollar',
                fields: [
                    {
                        id: 'contractValue',
                        label: 'Contract Value',
                        type: 'number',
                        placeholder: '10000',
                        step: '0.01',
                        help: 'Total value of the contract'
                    },
                    {
                        id: 'paymentTerms',
                        label: 'Payment Terms',
                        type: 'text',
                        placeholder: 'e.g., Net 30, 50% upfront',
                        help: 'How and when will payments be made?'
                    },
                    {
                        id: 'contractDuration',
                        label: 'Contract Duration',
                        type: 'text',
                        placeholder: 'e.g., 6 months, 1 year, ongoing',
                        help: 'How long will this contract last?'
                    }
                ]
            }
        ]
    }
};

// Global variables
let currentSelectedDocType = null;
let formElements = {};

// Initialize the enhanced LegalEase system
document.addEventListener('DOMContentLoaded', function() {
    console.log('🏛️ Initializing Enhanced LegalEase Professional...');
    
    // Initialize core components
    initializeDOMElements();
    setupDocumentTypeSelection();
    setupFormHandlers();
    setupTabSwitching();
    setupLanguageSelection();
    setupExportFunctions();
    
    // Test backend connection
    testBackendConnection();
    
    console.log('✅ Enhanced LegalEase Professional initialized successfully');
});
// ============================================================================
// SECTION 2: DOM INITIALIZATION AND DOCUMENT TYPE SELECTION
// ============================================================================

// Initialize DOM elements
function initializeDOMElements() {
    formElements = {
        documentTypeCards: document.querySelectorAll('.document-type-card'),
        selectedDocType: document.getElementById('selectedDocType'),
        specificFields: document.getElementById('specificFields'),
        legalDocumentForm: document.getElementById('legalDocumentForm'),
        loadingSpinner: document.getElementById('loadingSpinner'),
        resultsContainer: document.getElementById('resultsContainer'),
        documentPreview: document.getElementById('documentPreview'),
        party1Label: document.querySelector('.party1-label'),
        party2Label: document.querySelector('.party2-label'),
        docTabs: document.querySelectorAll('.doc-tab'),
        translationForm: document.getElementById('translationForm')
    };
    
    console.log('✅ DOM elements initialized');
}

// Setup document type selection with enhanced animations
function setupDocumentTypeSelection() {
    console.log('📋 Setting up document type selection...');
    
    formElements.documentTypeCards.forEach(card => {
        card.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Remove selected class from all cards
            formElements.documentTypeCards.forEach(c => {
                c.classList.remove('selected');
                c.style.transform = '';
            });
            
            // Add selected class with enhanced animation
            this.classList.add('selected');
            this.style.transform = 'scale(1.05)';
            
            const docType = this.dataset.type;
            currentSelectedDocType = docType;
            
            // Update hidden input
            if (formElements.selectedDocType) {
                formElements.selectedDocType.value = docType;
            }
            
            // Update party labels with smooth animation
            updatePartyLabels(docType);
            
            // Generate document-specific fields
            generateDocumentSpecificFields(docType);
            
            // Show success notification
            const docTypeName = this.querySelector('h6').textContent;
            showNotification(`Selected: ${docTypeName}`, 'success');
            
            console.log('✅ Document type selected:', docType);
        });
        
        // Enhanced hover effects
        card.addEventListener('mouseenter', function() {
            if (!this.classList.contains('selected')) {
                this.style.transform = 'translateY(-3px)';
            }
        });
        
        card.addEventListener('mouseleave', function() {
            if (!this.classList.contains('selected')) {
                this.style.transform = '';
            }
        });
    });
    
    console.log('✅ Document type selection setup completed');
}

// Update party labels with smooth animations
function updatePartyLabels(docType) {
    console.log('🏷️ Updating party labels for:', docType);
    
    const labels = documentPartyLabels[docType] || { 
        party1: 'First Party', 
        party2: 'Second Party' 
    };
    
    // Update party 1 label
    if (formElements.party1Label) {
        animateTextChange(formElements.party1Label, labels.party1);
    }
    
    // Update party 2 label
    if (formElements.party2Label) {
        animateTextChange(formElements.party2Label, labels.party2);
    }
    
    console.log('✅ Party labels updated:', labels);
}

// Animate text changes
function animateTextChange(element, newText) {
    element.style.opacity = '0.5';
    element.style.transform = 'scale(0.95)';
    
    setTimeout(() => {
        element.textContent = newText;
        element.style.opacity = '1';
        element.style.transform = 'scale(1)';
        element.style.transition = 'all 0.3s ease';
    }, 150);
}

// Generate document-specific fields
function generateDocumentSpecificFields(docType) {
    console.log('🔧 Generating specific fields for:', docType);
    
    if (!formElements.specificFields) {
        console.error('❌ Specific fields container not found');
        return;
    }
    
    const fieldConfig = documentSpecificFields[docType];
    if (!fieldConfig) {
        console.log('⚠️ No specific fields configured for:', docType);
        formElements.specificFields.style.display = 'none';
        return;
    }
    
    let fieldsHTML = `<h5><i class="${fieldConfig.icon} me-2"></i>${fieldConfig.title}</h5>`;
    
    fieldConfig.fields.forEach(group => {
        fieldsHTML += `
            <div class="field-group">
                <h6><i class="${group.icon} me-2"></i>${group.group}</h6>
                ${generateFieldsHTML(group.fields)}
            </div>
        `;
    });
    
    // Add smooth animation
    formElements.specificFields.style.opacity = '0';
    formElements.specificFields.style.transform = 'translateY(20px)';
    formElements.specificFields.innerHTML = fieldsHTML;
    formElements.specificFields.style.display = 'block';
    
    setTimeout(() => {
        formElements.specificFields.style.opacity = '1';
        formElements.specificFields.style.transform = 'translateY(0)';
        formElements.specificFields.style.transition = 'all 0.5s ease';
        formElements.specificFields.classList.add('show');
    }, 100);
    
    // Smooth scroll to fields
    setTimeout(() => {
        formElements.specificFields.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start' 
        });
    }, 200);
    
    console.log('✅ Document-specific fields generated');
}

// Generate HTML for individual fields
function generateFieldsHTML(fields) {
    return fields.map(field => {
        const required = field.required ? '*' : '';
        const helpText = field.help ? `<div class="form-text">${field.help}</div>` : '';
        
        let fieldHTML = `
            <div class="mb-3">
                <label for="${field.id}" class="form-label">${field.label} ${required}</label>
        `;
        
        switch (field.type) {
            case 'textarea':
                fieldHTML += `
                    <textarea 
                        class="form-control" 
                        id="${field.id}" 
                        name="${field.id}"
                        rows="${field.rows || 3}"
                        placeholder="${field.placeholder || ''}"
                        ${field.required ? 'required' : ''}
                    ></textarea>
                `;
                break;
                
            case 'select':
                fieldHTML += `<select class="form-select" id="${field.id}" name="${field.id}" ${field.required ? 'required' : ''}>`;
                if (field.options) {
                    field.options.forEach(option => {
                        fieldHTML += `<option value="${option.value}">${option.text}</option>`;
                    });
                }
                fieldHTML += `</select>`;
                break;
                
            case 'date':
                fieldHTML += `
                    <input 
                        type="date" 
                        class="form-control" 
                        id="${field.id}" 
                        name="${field.id}"
                        ${field.required ? 'required' : ''}
                    >
                `;
                break;
                
            case 'number':
                fieldHTML += `
                    <input 
                        type="number" 
                        class="form-control" 
                        id="${field.id}" 
                        name="${field.id}"
                        placeholder="${field.placeholder || ''}"
                        ${field.step ? `step="${field.step}"` : ''}
                        ${field.min ? `min="${field.min}"` : ''}
                        ${field.max ? `max="${field.max}"` : ''}
                        ${field.required ? 'required' : ''}
                    >
                `;
                break;
                
            default: // text
                fieldHTML += `
                    <input 
                        type="text" 
                        class="form-control" 
                        id="${field.id}" 
                        name="${field.id}"
                        placeholder="${field.placeholder || ''}"
                        ${field.required ? 'required' : ''}
                    >
                `;
                break;
        }
        
        fieldHTML += helpText + `</div>`;
        return fieldHTML;
    }).join('');
}
// ============================================================================
// SECTION 3: FORM HANDLING AND VALIDATION (FIXED FOR RENDER BACKEND)
// ============================================================================

// Backend configuration - UPDATE THIS WITH YOUR RENDER URL
const BACKEND_CONFIG = {
    // Replace 'your-app-name' with your actual Render app name
    RENDER_URL: 'https://elevify.onrender.com',
    // Fallback to local development
    LOCAL_URL: 'http://localhost:5000',
    // Auto-detect environment
    getBaseURL: function() {
        // If running on localhost, try local first, then Render
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            return this.LOCAL_URL;
        }
        // If deployed, use Render URL
        return this.RENDER_URL;
    }
};

// Get the current backend URL
const BACKEND_URL = BACKEND_CONFIG.getBaseURL();

console.log('🌐 Backend URL configured:', BACKEND_URL);

// Setup form handlers - FIXED to connect to Render backend
function setupFormHandlers() {
    console.log('📋 Setting up form handlers...');
    
    // Legal document form submission - FIXED
    if (formElements.legalDocumentForm) {
        formElements.legalDocumentForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (validateForm()) {
                generateLegalDocument(); // This now calls the Render backend API
            }
        });
    }
    
    // Translation form submission
    if (formElements.translationForm) {
        formElements.translationForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (validateTranslationForm()) {
                generateTranslation();
            }
        });
    }
    
    console.log('✅ Form handlers setup completed');
}

// Enhanced form validation
function validateForm() {
    console.log('🔍 Validating form...');
    
    // Check if document type is selected
    if (!currentSelectedDocType) {
        showError('Please select a document type first.');
        return false;
    }
    
    // Check required basic fields
    const requiredFields = [
        { id: 'jurisdiction', name: 'Legal Jurisdiction' },
        { id: 'party1Name', name: 'First Party Name' },
        { id: 'party2Name', name: 'Second Party Name' },
        { id: 'party1Address', name: 'First Party Address' },
        { id: 'party2Address', name: 'Second Party Address' }
    ];
    
    for (let field of requiredFields) {
        const element = document.getElementById(field.id);
        if (!element || !element.value.trim()) {
            showError(`Please fill in: ${field.name}`);
            if (element) {
                element.focus();
                element.classList.add('is-invalid');
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            return false;
        } else {
            element.classList.remove('is-invalid');
        }
    }
    
    // Validate document-specific required fields
    const fieldConfig = documentSpecificFields[currentSelectedDocType];
    if (fieldConfig) {
        for (let group of fieldConfig.fields) {
            for (let field of group.fields) {
                if (field.required) {
                    const element = document.getElementById(field.id);
                    if (!element || !element.value.trim()) {
                        showError(`Please fill in: ${field.label}`);
                        if (element) {
                            element.focus();
                            element.classList.add('is-invalid');
                            element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                        return false;
                    } else {
                        element.classList.remove('is-invalid');
                    }
                }
            }
        }
    }
    
    console.log('✅ Form validation passed');
    return true;
}

// FIXED: Generate legal document - now calls Render backend
async function generateLegalDocument() {
    console.log('⚖️ Generating legal document via Render backend...');
    console.log('🌐 Using backend URL:', BACKEND_URL);
    
    showLoadingSpinner(true);
    
    try {
        // Collect all form data properly
        const formData = new FormData(formElements.legalDocumentForm);
        const documentData = {};
        
        // Convert FormData to object
        for (let [key, value] of formData.entries()) {
            if (value && value.trim()) {
                documentData[key] = value;
            }
        }
        
        // Add document type
        documentData.documentType = currentSelectedDocType;
        
        console.log('📊 Sending document data to backend:', documentData);
        
        // Prepare the request payload
        const requestPayload = {
            action: 'generate_document',
            document_type: currentSelectedDocType,
            document_data: documentData
        };
        
        console.log('📤 Request payload:', requestPayload);
        
        // Try multiple backend configurations
        const endpointsToTry = [
            `${BACKEND_URL}/api/legalease/generate`,
            `${BACKEND_URL}/api/legalease`,
            `${BACKEND_URL}/legalease/generate`,
            // Fallback to other backend if configured
            `${BACKEND_CONFIG.RENDER_URL}/api/legalease/generate`,
            `${BACKEND_CONFIG.LOCAL_URL}/api/legalease/generate`
        ];
        
        let response = null;
        let workingEndpoint = null;
        let lastError = null;
        
        // Test each endpoint
        for (const endpoint of endpointsToTry) {
            try {
                console.log(`🔄 Trying endpoint: ${endpoint}`);
                
                response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        // Add CORS headers for cross-origin requests
                        'Origin': window.location.origin
                    },
                    body: JSON.stringify(requestPayload),
                    // Add timeout for Render (which can be slow on cold starts)
                    signal: AbortSignal.timeout(60000) // 60 second timeout
                });
                
                console.log(`📡 Response from ${endpoint}:`, response.status, response.statusText);
                
                if (response.status !== 404) {
                    workingEndpoint = endpoint;
                    break;
                }
            } catch (fetchError) {
                console.log(`❌ Fetch failed for ${endpoint}:`, fetchError.message);
                lastError = fetchError;
                
                // If this is a timeout or network error and we're trying Render, 
                // show a specific message about cold starts
                if (fetchError.name === 'TimeoutError' && endpoint.includes('onrender.com')) {
                    showNotification('Render backend is starting up (cold start). This may take up to 60 seconds...', 'info');
                }
                continue;
            }
        }
        
        if (!response || response.status === 404) {
            throw new Error(`API endpoint not found. Tried: ${endpointsToTry.join(', ')}. Please check your Render deployment.`);
        }
        
        if (!response.ok) {
            let errorMessage = `HTTP ${response.status}: ${response.statusText}`;
            
            try {
                const errorData = await response.json();
                errorMessage = errorData.message || errorData.error || errorMessage;
            } catch (e) {
                // If we can't parse the error response, use the status text
            }
            
            throw new Error(errorMessage);
        }
        
        const result = await response.json();
        console.log('✅ Backend response:', result);
        
        if (result.success) {
            // Display the AI-generated document
            displayGeneratedDocument(result.document);
            showNotification('Complete legal document generated successfully!', 'success');
            
            console.log('✅ Document generated successfully');
            console.log('📄 Document metadata:', result.metadata);
            
            // Track successful generation
            trackEvent('document_generated', {
                documentType: currentSelectedDocType,
                endpoint: workingEndpoint,
                action: 'success'
            });
        } else {
            throw new Error(result.error || result.message || 'Failed to generate document');
        }
        
    } catch (error) {
        console.error('❌ Error generating document:', error);
        
        // Provide specific error messages based on the error type
        let userMessage = error.message;
        
        if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
            userMessage = 'Cannot connect to the backend server on Render. Please check if your Render deployment is active and the URL is correct.';
        } else if (error.message.includes('404') || error.message.includes('not found')) {
            userMessage = 'API endpoint not found on Render. Please check if your backend is deployed correctly and the routes are working.';
        } else if (error.message.includes('500')) {
            userMessage = 'Server error on Render. Please check the Render deployment logs for details.';
        } else if (error.message.includes('timeout') || error.name === 'TimeoutError') {
            userMessage = 'Request timed out. Render services can take time to start up (cold start). Please try again in a few moments.';
        } else if (error.message.includes('CORS')) {
            userMessage = 'Cross-origin request blocked. Please check your Render backend CORS configuration.';
        }
        
        showError(`Failed to generate document: ${userMessage}`);
        
        // Track failed generation
        trackEvent('document_generation_failed', {
            documentType: currentSelectedDocType,
            error: error.message,
            action: 'error'
        });
        
        // Offer backend troubleshooting for Render
        setTimeout(() => {
            showRenderTroubleshooting();
        }, 2000);
    } finally {
        showLoadingSpinner(false);
    }
}

// FIXED: Display generated document - enhanced for real AI content
function displayGeneratedDocument(documentContent) {
    console.log('📄 Displaying generated document...');
    
    if (!formElements.documentPreview) {
        console.error('❌ Document preview element not found');
        return;
    }
    
    // Format the document for display
    const formattedContent = formatDocumentForDisplay(documentContent);
    formElements.documentPreview.innerHTML = formattedContent;
    
    // Show results container
    if (formElements.resultsContainer) {
        formElements.resultsContainer.style.display = 'block';
        formElements.resultsContainer.scrollIntoView({ behavior: 'smooth' });
    }
    
    console.log('✅ Document displayed successfully');
}

// Enhanced format document for display - handles real legal documents
function formatDocumentForDisplay(content) {
    let formatted = content;
    
    // Convert markdown-style headers
    formatted = formatted.replace(/^### (.*$)/gim, '<h5 style="color: #14697D; margin-top: 2rem;">$1</h5>');
    formatted = formatted.replace(/^## (.*$)/gim, '<h4 style="color: #14697D; margin-top: 2.5rem;">$1</h4>');
    formatted = formatted.replace(/^# (.*$)/gim, '<h3 style="color: #14697D; text-align: center; margin-bottom: 2rem;">$1</h3>');
    
    // Format bold text
    formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong style="color: #14697D;">$1</strong>');
    
    // Format signature lines
    formatted = formatted.replace(/_{10,}/g, '<span style="border-bottom: 2px solid #14697D; display: inline-block; width: 200px;"></span>');
    
    // Format legal document structure
    formatted = formatted.replace(/^(WHEREAS|NOW, THEREFORE|IN WITNESS WHEREOF)/gm, '<strong style="color: #14697D;">$1</strong>');
    formatted = formatted.replace(/^(Article|Section|Clause)\s+(\d+)/gm, '<h5 style="color: #14697D; margin-top: 1.5rem;">$1 $2</h5>');
    
    // Convert line breaks properly
    formatted = formatted.replace(/\n\n/g, '</p><p>');
    formatted = formatted.replace(/\n/g, '<br>');
    formatted = '<p>' + formatted + '</p>';
    
    // Clean up empty paragraphs
    formatted = formatted.replace(/<p><\/p>/g, '');
    formatted = formatted.replace(/<p><br><\/p>/g, '');
    
    return formatted;
}

// Enhanced backend connection test for Render
async function testBackendConnection(verbose = false) {
    console.log('🔗 Testing Render backend connection...');
    console.log('🌐 Backend URL:', BACKEND_URL);
    
    if (verbose) {
        showNotification('Testing Render backend connection...', 'info');
    }
    
    const endpointsToTest = [
        { url: `${BACKEND_URL}/api/test`, description: 'Main API test endpoint' },
        { url: `${BACKEND_URL}/health`, description: 'Health check endpoint' },
        { url: `${BACKEND_URL}/api/legalease/generate`, description: 'LegalEase generate endpoint' },
        { url: `${BACKEND_URL}/api/elevify/tools`, description: 'Tools overview endpoint' }
    ];
    
    const results = [];
    
    for (const endpoint of endpointsToTest) {
        try {
            console.log(`🔄 Testing: ${endpoint.url}`);
            
            const response = await fetch(endpoint.url, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Origin': window.location.origin
                },
                signal: AbortSignal.timeout(30000) // 30 second timeout for Render
            });
            
            const status = response.status;
            const statusText = response.statusText;
            
            results.push({
                endpoint: endpoint.url,
                description: endpoint.description,
                status: status,
                success: status < 400,
                message: `${status} ${statusText}`
            });
            
            console.log(`🔗 ${endpoint.url}: ${status} ${statusText}`);
            
        } catch (error) {
            results.push({
                endpoint: endpoint.url,
                description: endpoint.description,
                status: 'ERROR',
                success: false,
                message: error.message
            });
            
            console.error(`❌ ${endpoint.url}: ${error.message}`);
        }
    }
    
    // Analyze results
    const successfulEndpoints = results.filter(r => r.success);
    const failedEndpoints = results.filter(r => !r.success);
    
    if (verbose) {
        if (successfulEndpoints.length > 0) {
            console.log('✅ Working endpoints:', successfulEndpoints);
            showNotification(`Render backend connection successful! ${successfulEndpoints.length}/${results.length} endpoints working.`, 'success');
            
            // Check specifically for the LegalEase endpoint
            const legalEaseEndpoint = results.find(r => r.endpoint.includes('legalease'));
            if (legalEaseEndpoint && legalEaseEndpoint.success) {
                showNotification('LegalEase API endpoint is accessible on Render!', 'success');
            } else {
                showWarning('LegalEase endpoint may not be properly configured on Render. Check your deployment.');
            }
        } else {
            console.error('❌ No endpoints accessible:', failedEndpoints);
            showError('Cannot connect to Render backend. Please check if your deployment is active.');
        }
    }
    
    return results;
}

// Test document generation on Render
async function testDocumentGeneration() {
    try {
        showNotification('Testing document generation on Render...', 'info');
        
        const testData = {
            action: 'generate_document',
            document_type: 'general_contract',
            document_data: {
                documentType: 'general_contract',
                jurisdiction: 'us_general',
                party1Name: 'Test Company Inc.',
                party2Name: 'Test Client LLC',
                party1Address: '123 Test Street, Test City, TC 12345',
                party2Address: '456 Client Avenue, Client City, CC 67890',
                contractSubject: 'Test Agreement',
                contractPurpose: 'This is a test document generation request'
            }
        };
        
        const response = await fetch(`${BACKEND_URL}/api/legalease/generate`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json',
                'Origin': window.location.origin
            },
            body: JSON.stringify(testData),
            signal: AbortSignal.timeout(60000) // 60 second timeout for Render
        });
        
        console.log('Test response status:', response.status);
        
        if (response.ok) {
            const result = await response.json();
            console.log('Test result:', result);
            
            if (result.success) {
                showNotification('Document generation test successful on Render!', 'success');
                return true;
            } else {
                showError(`Test failed: ${result.error || 'Unknown error'}`);
                return false;
            }
        } else {
            const errorText = await response.text();
            showError(`Test failed with status ${response.status}: ${errorText}`);
            return false;
        }
        
    } catch (error) {
        console.error('Test error:', error);
        if (error.name === 'TimeoutError') {
            showError('Test timed out. Render may be experiencing a cold start. Please try again.');
        } else {
            showError(`Test failed: ${error.message}`);
        }
        return false;
    }
}

/*
// Show Render-specific troubleshooting
function showRenderTroubleshooting() {
    const troubleshootingHTML = `
        <div class="alert alert-warning render-troubleshooting" style="margin-top: 1rem;">
            <h6><i class="fas fa-cloud me-2"></i>Render Backend Troubleshooting:</h6>
            <ol style="margin: 0.5rem 0;">
                <li><strong>Check Render Deployment:</strong> Ensure your app is deployed and active on Render</li>
                <li><strong>Verify URL:</strong> Update <code>BACKEND_CONFIG.RENDER_URL</code> with your actual Render URL</li>
                <li><strong>Cold Start:</strong> Render free tier has cold starts - first request may take 60+ seconds</li>
                <li><strong>Check Logs:</strong> View logs in your Render dashboard for errors</li>
                <li><strong>CORS Configuration:</strong> Ensure your Flask app has proper CORS setup</li>
                <li><strong>Environment Variables:</strong> Check if all required env vars are set in Render</li>
            </ol>
            
            <div class="mt-3">
                <button class="btn btn-sm btn-primary" onclick="testBackendConnection(true)">
                    <i class="fas fa-wifi me-1"></i>Test Render Connection
                </button>
                <button class="btn btn-sm btn-info ms-2" onclick="testDocumentGeneration()">
                    <i class="fas fa-vial me-1"></i>Test Generation
                </button>
                <button class="btn btn-sm btn-secondary ms-2" onclick="this.parentElement.parentElement.remove()">
                    <i class="fas fa-times me-1"></i>Dismiss
                </button>
            </div>
            
            <div class="mt-2">
                <small class="text-muted">
                    <strong>Current Backend URL:</strong> <code>${BACKEND_URL}</code><br>
                    <strong>Common Issues:</strong><br>
                    • Wrong URL in BACKEND_CONFIG<br>
                    • Render service is sleeping (free tier)<br>
                    • CORS not configured for your domain<br>
                    • Environment variables missing in Render
                </small>
            </div>
        </div>
    `;
    
    // Remove existing troubleshooting panels
    const existingPanels = document.querySelectorAll('.render-troubleshooting');
    existingPanels.forEach(panel => panel.remove());
    
    const resultsContainer = document.getElementById('resultsContainer') || formElements.legalDocumentForm;
    if (resultsContainer) {
        resultsContainer.insertAdjacentHTML('afterend', troubleshootingHTML);
        
        // Scroll to troubleshooting panel
        setTimeout(() => {
            const panel = document.querySelector('.render-troubleshooting');
            if (panel) {
                panel.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }, 100);
    }
}

// Add a test button for Render backend
function addTestButton() {
    const testButton = document.createElement('button');
    testButton.type = 'button';
    testButton.className = 'btn btn-outline-info btn-sm me-2';
    testButton.innerHTML = '<i class="fas fa-cloud me-1"></i>Test Render API';
    testButton.onclick = () => testDocumentGeneration();
    
    const submitButton = document.querySelector('button[type="submit"]');
    if (submitButton && submitButton.parentNode) {
        submitButton.parentNode.insertBefore(testButton, submitButton);
    }
}

// Initialize for Render backend
document.addEventListener('DOMContentLoaded', function() {
    console.log('🚀 Initializing for Render backend...');
    console.log('🌐 Backend URL:', BACKEND_URL);
    
    // Add test button
    setTimeout(addTestButton, 1000);
    
    // Test connection on load
    setTimeout(() => {
        testBackendConnection(false);
    }, 2000);
});
*/

// Validate translation form
function validateTranslationForm() {
    const originalDocument = document.getElementById('originalDocument');
    const documentFile = document.getElementById('documentFile');
    
    if ((!originalDocument || !originalDocument.value.trim()) && 
        (!documentFile || !documentFile.files.length)) {
        showError('Please provide text to translate or upload a document.');
        return false;
    }
    
    return true;
}
// ============================================================================
// SECTION 4: TAB SWITCHING AND LANGUAGE SELECTION
// ============================================================================

// Setup tab switching
function setupTabSwitching() {
    console.log('🔄 Setting up tab switching...');
    
    formElements.docTabs.forEach(tab => {
        tab.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Remove active class from all tabs
            formElements.docTabs.forEach(t => t.classList.remove('active'));
            
            // Add active class to clicked tab
            this.classList.add('active');
            
            // Hide all tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
                content.style.display = 'none';
            });
            
            // Show selected tab content
            const targetTab = this.dataset.tab;
            const targetContent = document.getElementById(targetTab + 'Section');
            
            if (targetContent) {
                targetContent.style.display = 'block';
                targetContent.classList.add('active');
            }
            
            console.log('✅ Switched to tab:', targetTab);
        });
    });
}

// Setup language selection
function setupLanguageSelection() {
    console.log('🌐 Setting up language selection...');
    
    // Source language selection
    document.querySelectorAll('.source-language').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('.source-language').forEach(opt => opt.classList.remove('selected'));
            this.classList.add('selected');
            
            const selectedInput = document.getElementById('selectedSourceLanguage');
            if (selectedInput) {
                selectedInput.value = this.dataset.lang;
            }
            
            showNotification(`Source language: ${this.dataset.name}`, 'success');
        });
    });
    
    // Target language selection
    document.querySelectorAll('.target-language').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('.target-language').forEach(opt => opt.classList.remove('selected'));
            this.classList.add('selected');
            
            const selectedInput = document.getElementById('selectedTargetLanguage');
            if (selectedInput) {
                selectedInput.value = this.dataset.lang;
            }
            
            showNotification(`Target language: ${this.dataset.name}`, 'success');
        });
    });
    
    // Language swap functionality
    const swapBtn = document.getElementById('swapLanguages');
    if (swapBtn) {
        swapBtn.addEventListener('click', function() {
            const sourceInput = document.getElementById('selectedSourceLanguage');
            const targetInput = document.getElementById('selectedTargetLanguage');
            
            if (sourceInput && targetInput) {
                const tempValue = sourceInput.value;
                sourceInput.value = targetInput.value;
                targetInput.value = tempValue;
                
                // Update visual selection
                document.querySelectorAll('.source-language').forEach(opt => opt.classList.remove('selected'));
                document.querySelectorAll('.target-language').forEach(opt => opt.classList.remove('selected'));
                
                const newSource = document.querySelector(`.source-language[data-lang="${sourceInput.value}"]`);
                const newTarget = document.querySelector(`.target-language[data-lang="${targetInput.value}"]`);
                
                if (newSource) newSource.classList.add('selected');
                if (newTarget) newTarget.classList.add('selected');
                
                showNotification('Languages swapped!', 'success');
            }
        });
    }
}

// Generate translation - FIXED to call backend API
async function generateTranslation() {
    console.log('🌐 Generating translation via backend API...');
    
    showLoadingSpinner(true);
    
    try {
        // Get form data
        const originalText = document.getElementById('originalDocument').value;
        const sourceLanguage = document.getElementById('selectedSourceLanguage').value;
        const targetLanguage = document.getElementById('selectedTargetLanguage').value;
        const maintainLegalTerms = document.getElementById('maintainLegalTerms').checked;
        const includeOriginal = document.getElementById('includeOriginal').checked;
        const detectLanguage = document.getElementById('detectLanguage').checked;
        
        if (!originalText.trim()) {
            showError('Please provide text to translate.');
            return;
        }
        
        // Prepare translation request
        const translationData = {
            action: 'translate_document',
            original_text: originalText,
            source_language: sourceLanguage,
            target_language: targetLanguage,
            maintain_legal_terms: maintainLegalTerms,
            include_original: includeOriginal,
            detect_language: detectLanguage
        };
        
        console.log('📊 Sending translation data to backend:', translationData);
        
        // Call backend API for translation
        const response = await fetch('/api/legalease/generate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(translationData)
        });
        
        if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        
        if (result.success) {
            // Display translation results
            displayTranslationResults(result);
            showNotification('Translation completed successfully!', 'success');
        } else {
            throw new Error(result.error || 'Translation failed');
        }
        
    } catch (error) {
        console.error('❌ Translation error:', error);
        showError(`Translation failed: ${error.message}`);
        
        // Fallback to demo translation if backend unavailable
        if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
            console.log('🔄 Falling back to demo translation...');
            await generateDemoTranslation();
        }
    } finally {
        showLoadingSpinner(false);
    }
}

// Fallback demo translation when backend is unavailable
async function generateDemoTranslation() {
    const originalText = document.getElementById('originalDocument').value;
    const sourceLanguage = document.getElementById('selectedSourceLanguage').value;
    const targetLanguage = document.getElementById('selectedTargetLanguage').value;
    
    // Show progress animation
    showTranslationProgress();
    
    // Simulate processing time
    await new Promise(resolve => setTimeout(resolve, 2000));
    
    const demoResult = {
        success: true,
        translated_text: `[DEMO TRANSLATION]\n\nOriginal (${sourceLanguage}): ${originalText}\n\nTranslated to ${targetLanguage}:\n\n${originalText}\n\n[This is a demo translation. The actual system would provide professional legal translation using AI services.]`,
        source_language_detected: sourceLanguage,
        target_language: targetLanguage,
        metadata: {
            translation_type: 'demo',
            word_count: originalText.split(' ').length,
            character_count: originalText.length
        }
    };
    
    displayTranslationResults(demoResult);
    showNotification('Demo translation completed (backend unavailable)', 'warning');
}

// Display translation results
function displayTranslationResults(result) {
    const translationPreview = document.getElementById('translationPreview');
    const translationResults = document.getElementById('translationResults');
    const detectionResult = document.getElementById('detectionResult');
    const detectedLanguageName = document.getElementById('detectedLanguageName');
    
    if (translationPreview && translationResults) {
        // Show detected language if available
        if (result.source_language_detected && detectionResult && detectedLanguageName) {
            detectedLanguageName.textContent = result.source_language_detected;
            detectionResult.style.display = 'block';
        }
        
        // Format and display translation
        const formattedTranslation = formatDocumentForDisplay(result.translated_text || result.document);
        translationPreview.innerHTML = formattedTranslation;
        
        // Show results container
        translationResults.style.display = 'block';
        translationResults.scrollIntoView({ behavior: 'smooth' });
        
        // Hide progress if shown
        hideTranslationProgress();
    }
}

// Show translation progress
function showTranslationProgress() {
    const progressElement = document.getElementById('translationProgress');
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    
    if (progressElement && progressBar && progressText) {
        progressElement.style.display = 'block';
        progressBar.style.width = '0%';
        progressText.textContent = 'Preparing professional translation...';
        
        // Animate progress
        let progress = 0;
        const progressInterval = setInterval(() => {
            progress += Math.random() * 20;
            if (progress > 90) progress = 90;
            
            progressBar.style.width = progress + '%';
            
            if (progress > 30) progressText.textContent = 'Processing legal terminology...';
            if (progress > 60) progressText.textContent = 'Finalizing translation...';
            
            if (progress >= 90) {
                clearInterval(progressInterval);
                progressBar.style.width = '100%';
                progressText.textContent = 'Translation complete!';
            }
        }, 200);
        
        // Store interval for cleanup
        window.translationProgressInterval = progressInterval;
    }
}

// Hide translation progress
function hideTranslationProgress() {
    const progressElement = document.getElementById('translationProgress');
    
    if (progressElement) {
        progressElement.style.display = 'none';
    }
    
    // Clear interval if exists
    if (window.translationProgressInterval) {
        clearInterval(window.translationProgressInterval);
        delete window.translationProgressInterval;
    }
}
// ============================================================================
// SECTION 5: EXPORT FUNCTIONS AND DOCUMENT ACTIONS (COMPLETE WITH EDIT FIX)
// ============================================================================

// Setup export functions
function setupExportFunctions() {
    console.log('📤 Setting up export functions...');
    
    // Document export
    const exportWord = document.getElementById('exportWord');
    const exportPDF = document.getElementById('exportPDF');
    const copyDocument = document.getElementById('copyDocument');
    
    if (exportWord) {
        exportWord.addEventListener('click', () => exportToWord());
    }
    
    if (exportPDF) {
        exportPDF.addEventListener('click', () => exportToPDF());
    }
    
    if (copyDocument) {
        copyDocument.addEventListener('click', () => copyToClipboard());
    }
    
    // Translation export
    const downloadTranslationWord = document.getElementById('downloadTranslationWord');
    const downloadTranslationPDF = document.getElementById('downloadTranslationPDF');
    const copyTranslation = document.getElementById('copyTranslation');
    
    if (downloadTranslationWord) {
        downloadTranslationWord.addEventListener('click', () => exportTranslationToWord());
    }
    
    if (downloadTranslationPDF) {
        downloadTranslationPDF.addEventListener('click', () => exportTranslationToPDF());
    }
    
    if (copyTranslation) {
        copyTranslation.addEventListener('click', () => copyTranslationToClipboard());
    }
    
    // Edit buttons
    const editBtn = document.getElementById('editDocumentBtn');
    const newBtn = document.getElementById('newDocumentBtn');
    
    if (editBtn) {
        editBtn.addEventListener('click', () => editDocument());
    }
    
    if (newBtn) {
        newBtn.addEventListener('click', () => createNewDocument());
    }
}

// Export to Word document
function exportToWord() {
    console.log('📄 Exporting to Word...');
    
    const content = formElements.documentPreview?.innerHTML || '';
    const cleanContent = stripHtmlTags(content);
    
    // Create a more structured Word document
    const wordContent = `
LEGAL DOCUMENT
Generated by LegalEase Professional
${new Date().toLocaleDateString()}

${cleanContent}

---
This document was generated using LegalEase Professional AI Legal Assistant.
Please review with qualified legal counsel before execution.
    `.trim();
    
    const blob = new Blob([wordContent], { 
        type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' 
    });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `legal_document_${getCurrentDateString()}.doc`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showNotification('Document exported to Word format!', 'success');
}

// Export to PDF
function exportToPDF() {
    console.log('📄 Exporting to PDF...');
    
    const content = formElements.documentPreview?.innerHTML || '';
    const printWindow = window.open('', '_blank');
    
    if (!printWindow) {
        showError('Pop-up blocked. Please allow pop-ups for this site and try again.');
        return;
    }
    
    printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>Legal Document - LegalEase Professional</title>
            <style>
                body { 
                    font-family: 'Times New Roman', serif; 
                    margin: 1in; 
                    line-height: 1.6;
                    color: #000;
                }
                h1, h2, h3, h4, h5, h6 { 
                    color: #000; 
                    page-break-after: avoid;
                }
                .header {
                    text-align: center;
                    border-bottom: 2px solid #000;
                    padding-bottom: 1rem;
                    margin-bottom: 2rem;
                }
                .footer {
                    position: fixed;
                    bottom: 0.5in;
                    left: 0;
                    right: 0;
                    text-align: center;
                    font-size: 10px;
                    color: #666;
                }
                @media print { 
                    @page { 
                        margin: 1in; 
                        size: letter;
                    }
                    body { margin: 0; }
                    .no-print { display: none; }
                }
            </style>
        </head>
        <body>
            <div class="header">
                <h2>LEGAL DOCUMENT</h2>
                <p>Generated by LegalEase Professional | ${new Date().toLocaleDateString()}</p>
            </div>
            ${content}
            <div class="footer">
                Generated by LegalEase Professional AI Legal Assistant - Please review with qualified legal counsel
            </div>
        </body>
        </html>
    `);
    
    printWindow.document.close();
    
    // Wait a moment for content to load, then print
    setTimeout(() => {
        printWindow.print();
        // Don't close immediately - let user save/cancel
    }, 500);
    
    showNotification('Document ready for PDF export! Use your browser\'s print dialog to save as PDF.', 'success');
}

// Copy document to clipboard
function copyToClipboard() {
    console.log('📋 Copying to clipboard...');
    
    const content = formElements.documentPreview?.innerText || '';
    
    if (!content.trim()) {
        showError('No document content to copy.');
        return;
    }
    
    // Add header to copied content
    const fullContent = `LEGAL DOCUMENT
Generated by LegalEase Professional
${new Date().toLocaleDateString()}

${content}

---
This document was generated using LegalEase Professional AI Legal Assistant.
Please review with qualified legal counsel before execution.`;
    
    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(fullContent).then(() => {
            showNotification('Document copied to clipboard!', 'success');
        }).catch(err => {
            console.error('Clipboard write failed:', err);
            fallbackCopyToClipboard(fullContent);
        });
    } else {
        fallbackCopyToClipboard(fullContent);
    }
}

// Fallback copy method for older browsers
function fallbackCopyToClipboard(text) {
    const textArea = document.createElement('textarea');
    textArea.value = text;
    textArea.style.position = 'fixed';
    textArea.style.top = '-9999px';
    textArea.style.left = '-9999px';
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
        const successful = document.execCommand('copy');
        if (successful) {
            showNotification('Document copied to clipboard!', 'success');
        } else {
            showError('Failed to copy to clipboard. Please select and copy manually.');
        }
    } catch (err) {
        console.error('Fallback copy failed:', err);
        showError('Copy to clipboard not supported. Please select and copy manually.');
    }
    
    document.body.removeChild(textArea);
}

// Export translation to Word
function exportTranslationToWord() {
    console.log('📄 Exporting translation to Word...');
    
    const content = document.getElementById('translationPreview')?.innerHTML || '';
    const cleanContent = stripHtmlTags(content);
    
    const wordContent = `
LEGAL DOCUMENT TRANSLATION
Generated by LegalEase Professional
${new Date().toLocaleDateString()}

${cleanContent}

---
This translation was generated using LegalEase Professional AI Legal Assistant.
Please review with qualified legal counsel and professional translators before use.
    `.trim();
    
    const blob = new Blob([wordContent], { 
        type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' 
    });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `legal_translation_${getCurrentDateString()}.doc`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showNotification('Translation exported to Word format!', 'success');
}

// Export translation to PDF
function exportTranslationToPDF() {
    console.log('📄 Exporting translation to PDF...');
    
    const content = document.getElementById('translationPreview')?.innerHTML || '';
    const printWindow = window.open('', '_blank');
    
    if (!printWindow) {
        showError('Pop-up blocked. Please allow pop-ups for this site and try again.');
        return;
    }
    
    printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>Legal Document Translation - LegalEase Professional</title>
            <style>
                body { 
                    font-family: 'Times New Roman', serif; 
                    margin: 1in; 
                    line-height: 1.6;
                    color: #000;
                }
                h1, h2, h3, h4, h5, h6 { 
                    color: #000; 
                    page-break-after: avoid;
                }
                .header {
                    text-align: center;
                    border-bottom: 2px solid #000;
                    padding-bottom: 1rem;
                    margin-bottom: 2rem;
                }
                @media print { 
                    @page { 
                        margin: 1in; 
                        size: letter;
                    }
                    body { margin: 0; }
                }
            </style>
        </head>
        <body>
            <div class="header">
                <h2>LEGAL DOCUMENT TRANSLATION</h2>
                <p>Generated by LegalEase Professional | ${new Date().toLocaleDateString()}</p>
            </div>
            ${content}
        </body>
        </html>
    `);
    
    printWindow.document.close();
    
    setTimeout(() => {
        printWindow.print();
    }, 500);
    
    showNotification('Translation ready for PDF export!', 'success');
}

// Copy translation to clipboard
function copyTranslationToClipboard() {
    console.log('📋 Copying translation to clipboard...');
    
    const content = document.getElementById('translationPreview')?.innerText || '';
    
    if (!content.trim()) {
        showError('No translation content to copy.');
        return;
    }
    
    const fullContent = `LEGAL DOCUMENT TRANSLATION
Generated by LegalEase Professional
${new Date().toLocaleDateString()}

${content}

---
This translation was generated using LegalEase Professional AI Legal Assistant.
Please review with qualified legal counsel and professional translators before use.`;
    
    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(fullContent).then(() => {
            showNotification('Translation copied to clipboard!', 'success');
        }).catch(err => {
            console.error('Clipboard write failed:', err);
            fallbackCopyToClipboard(fullContent);
        });
    } else {
        fallbackCopyToClipboard(fullContent);
    }
}

// FIXED: Edit document - now edits the generated text directly
function editDocument() {
    console.log('✏️ Enabling document editing...');
    
    const documentPreview = formElements.documentPreview;
    if (!documentPreview) {
        showError('No document to edit.');
        return;
    }
    
    // Get the current document content
    const currentContent = documentPreview.innerHTML;
    const plainTextContent = documentPreview.innerText || documentPreview.textContent;
    
    // Create editable version
    const editableContainer = document.createElement('div');
    editableContainer.className = 'document-editor';
    editableContainer.innerHTML = `
        <div class="editing-toolbar mb-3">
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="formatText('bold')" title="Bold">
                    <i class="fas fa-bold"></i>
                </button>
                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="formatText('italic')" title="Italic">
                    <i class="fas fa-italic"></i>
                </button>
                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="formatText('underline')" title="Underline">
                    <i class="fas fa-underline"></i>
                </button>
            </div>
            <div class="btn-group ms-2" role="group">
                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="formatText('insertUnorderedList')" title="Bullet List">
                    <i class="fas fa-list-ul"></i>
                </button>
                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="formatText('insertOrderedList')" title="Numbered List">
                    <i class="fas fa-list-ol"></i>
                </button>
            </div>
            <div class="btn-group ms-2" role="group">
                <button type="button" class="btn btn-sm btn-success" onclick="saveDocumentEdits()">
                    <i class="fas fa-save me-1"></i>Save Changes
                </button>
                <button type="button" class="btn btn-sm btn-secondary" onclick="cancelDocumentEdits()">
                    <i class="fas fa-times me-1"></i>Cancel
                </button>
            </div>
        </div>
        <div 
            id="documentEditor" 
            class="rich-text-editor form-control" 
            contenteditable="true" 
            style="min-height: 400px; max-height: 600px; overflow-y: auto; font-family: 'Times New Roman', serif; line-height: 1.8; padding: 2rem;"
        >
            ${currentContent}
        </div>
        <div class="mt-2">
            <small class="text-muted">
                <i class="fas fa-info-circle me-1"></i>
                Click in the text area above to edit your document. Use the toolbar to format text.
            </small>
        </div>
    `;
    
    // Store original content for cancel functionality
    window.originalDocumentContent = currentContent;
    
    // Replace the preview with the editor
    documentPreview.style.display = 'none';
    documentPreview.parentNode.insertBefore(editableContainer, documentPreview.nextSibling);
    
    // Focus on the editor
    const editor = document.getElementById('documentEditor');
    if (editor) {
        editor.focus();
        
        // Place cursor at the end
        const range = document.createRange();
        const selection = window.getSelection();
        range.selectNodeContents(editor);
        range.collapse(false);
        selection.removeAllRanges();
        selection.addRange(range);
        
        // Add event listeners for editor
        editor.addEventListener('paste', handlePasteInEditor);
        editor.addEventListener('input', handleEditorInput);
    }
    
    // Hide export options while editing
    const exportOptions = document.querySelector('.export-options');
    if (exportOptions) {
        exportOptions.style.display = 'none';
    }
    
    // Hide edit/new buttons while editing
    const editBtn = document.getElementById('editDocumentBtn');
    const newBtn = document.getElementById('newDocumentBtn');
    if (editBtn) editBtn.style.display = 'none';
    if (newBtn) newBtn.style.display = 'none';
    
    showNotification('Document editing enabled! Make your changes and click "Save Changes" when done.', 'info');
}

// Create new document
function createNewDocument() {
    console.log('🆕 Creating new document...');
    
    // Show confirmation dialog
    if (formElements.resultsContainer && formElements.resultsContainer.style.display !== 'none') {
        const confirmed = confirm('Are you sure you want to create a new document? Your current document will be cleared.');
        if (!confirmed) {
            return;
        }
    }
    
    // Reset form
    if (formElements.legalDocumentForm) {
        formElements.legalDocumentForm.reset();
    }
    
    // Clear selections
    formElements.documentTypeCards.forEach(card => {
        card.classList.remove('selected');
        card.style.transform = '';
    });
    
    // Hide results
    if (formElements.resultsContainer) {
        formElements.resultsContainer.style.display = 'none';
    }
    
    // Hide specific fields
    if (formElements.specificFields) {
        formElements.specificFields.style.display = 'none';
        formElements.specificFields.classList.remove('show');
    }
    
    // Reset party labels
    if (formElements.party1Label) {
        formElements.party1Label.textContent = 'First Party';
    }
    if (formElements.party2Label) {
        formElements.party2Label.textContent = 'Second Party';
    }
    
    // Reset variables
    currentSelectedDocType = null;
    
    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });
    
    showNotification('Ready to create a new legal document', 'success');
}

// Format text in the document editor
function formatText(command) {
    document.execCommand(command, false, null);
    const editor = document.getElementById('documentEditor');
    if (editor) {
        editor.focus();
    }
}

// Save document edits
function saveDocumentEdits() {
    console.log('💾 Saving document edits...');
    
    const editor = document.getElementById('documentEditor');
    const documentPreview = formElements.documentPreview;
    
    if (!editor || !documentPreview) {
        showError('Editor not found.');
        return;
    }
    
    // Get edited content
    const editedContent = editor.innerHTML;
    
    // Validate content
    if (!editedContent.trim()) {
        showError('Document cannot be empty.');
        return;
    }
    
    // Update the document preview with edited content
    documentPreview.innerHTML = editedContent;
    
    // Remove the editor
    const editorContainer = document.querySelector('.document-editor');
    if (editorContainer) {
        editorContainer.remove();
    }
    
    // Show the updated document
    documentPreview.style.display = 'block';
    
    // Show export options again
    const exportOptions = document.querySelector('.export-options');
    if (exportOptions) {
        exportOptions.style.display = 'flex';
    }
    
    // Show edit/new buttons again
    const editBtn = document.getElementById('editDocumentBtn');
    const newBtn = document.getElementById('newDocumentBtn');
    if (editBtn) editBtn.style.display = 'inline-block';
    if (newBtn) newBtn.style.display = 'inline-block';
    
    // Clear stored original content
    delete window.originalDocumentContent;
    
    // Clear editing draft since we've saved
    clearEditingDraft();
    
    showNotification('Document changes saved successfully!', 'success');
    
    // Scroll to show the updated document
    documentPreview.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// Cancel document edits
function cancelDocumentEdits() {
    console.log('❌ Cancelling document edits...');
    
    const documentPreview = formElements.documentPreview;
    
    if (!documentPreview) {
        showError('Document preview not found.');
        return;
    }
    
    // Restore original content if available
    if (window.originalDocumentContent) {
        documentPreview.innerHTML = window.originalDocumentContent;
        delete window.originalDocumentContent;
    }
    
    // Remove the editor
    const editorContainer = document.querySelector('.document-editor');
    if (editorContainer) {
        editorContainer.remove();
    }
    
    // Show the original document
    documentPreview.style.display = 'block';
    
    // Show export options again
    const exportOptions = document.querySelector('.export-options');
    if (exportOptions) {
        exportOptions.style.display = 'flex';
    }
    
    // Show edit/new buttons again
    const editBtn = document.getElementById('editDocumentBtn');
    const newBtn = document.getElementById('newDocumentBtn');
    if (editBtn) editBtn.style.display = 'inline-block';
    if (newBtn) newBtn.style.display = 'inline-block';
    
    // Clear editing draft
    clearEditingDraft();
    
    showNotification('Edit cancelled. Document restored to original state.', 'info');
}

// Handle paste in editor (clean up formatting)
function handlePasteInEditor(event) {
    event.preventDefault();
    
    // Get plain text from clipboard
    const text = (event.clipboardData || window.clipboardData).getData('text');
    
    // Insert as plain text, preserving line breaks
    const formattedText = text.replace(/\n/g, '<br>');
    document.execCommand('insertHTML', false, formattedText);
}

// Handle editor input (for auto-save or validation)
function handleEditorInput(event) {
    // Optional: Add auto-save functionality
    const editor = event.target;
    
    // Basic validation - ensure minimum content
    if (editor.innerText.trim().length < 10) {
        editor.style.borderColor = '#dc3545';
    } else {
        editor.style.borderColor = '#14697D';
    }
    
    // Optional: Auto-save draft every 5 seconds
    clearTimeout(window.editorAutoSaveTimeout);
    window.editorAutoSaveTimeout = setTimeout(() => {
        // Save to localStorage as draft
        const content = editor.innerHTML;
        if (content.trim()) {
            saveToLocalStorage('legalease_editing_draft', {
                content: content,
                timestamp: new Date().toISOString()
            });
            console.log('📝 Editor content auto-saved');
        }
    }, 5000);
}

// Load editing draft if available
function loadEditingDraft() {
    const draft = loadFromLocalStorage('legalease_editing_draft');
    if (draft && draft.content) {
        const timeDiff = new Date() - new Date(draft.timestamp);
        const hoursDiff = timeDiff / (1000 * 60 * 60);
        
        // Only offer to restore if draft is less than 1 hour old
        if (hoursDiff < 1) {
            const restore = confirm('Found an unsaved editing draft. Would you like to restore it?');
            if (restore) {
                const editor = document.getElementById('documentEditor');
                if (editor) {
                    editor.innerHTML = draft.content;
                    showNotification('Editing draft restored!', 'success');
                }
            }
        }
        
        // Clear old drafts
        if (hoursDiff >= 1) {
            removeFromLocalStorage('legalease_editing_draft');
        }
    }
}

// Clear editing draft when saving
function clearEditingDraft() {
    removeFromLocalStorage('legalease_editing_draft');
    if (window.editorAutoSaveTimeout) {
        clearTimeout(window.editorAutoSaveTimeout);
    }
}

// Add keyboard shortcuts for editing
function setupEditingKeyboardShortcuts() {
    document.addEventListener('keydown', function(event) {
        const editor = document.getElementById('documentEditor');
        if (!editor || document.activeElement !== editor) return;
        
        // Ctrl+S or Cmd+S: Save document edits
        if ((event.ctrlKey || event.metaKey) && event.key === 's') {
            event.preventDefault();
            saveDocumentEdits();
        }
        
        // Escape: Cancel editing
        if (event.key === 'Escape') {
            event.preventDefault();
            const confirmCancel = confirm('Are you sure you want to cancel editing? Unsaved changes will be lost.');
            if (confirmCancel) {
                cancelDocumentEdits();
            }
        }
        
        // Ctrl+B or Cmd+B: Bold
        if ((event.ctrlKey || event.metaKey) && event.key === 'b') {
            event.preventDefault();
            formatText('bold');
        }
        
        // Ctrl+I or Cmd+I: Italic
        if ((event.ctrlKey || event.metaKey) && event.key === 'i') {
            event.preventDefault();
            formatText('italic');
        }
        
        // Ctrl+U or Cmd+U: Underline
        if ((event.ctrlKey || event.metaKey) && event.key === 'u') {
            event.preventDefault();
            formatText('underline');
        }
    });
}

// Initialize editing features
document.addEventListener('DOMContentLoaded', function() {
    setupEditingKeyboardShortcuts();
    
    // Check for editing draft periodically
    setTimeout(loadEditingDraft, 1000);
});

// Utility functions
function stripHtmlTags(html) {
    const tmp = document.createElement('div');
    tmp.innerHTML = html;
    return tmp.textContent || tmp.innerText || '';
}

function getCurrentDateString() {
    const now = new Date();
    return now.toISOString().split('T')[0]; // YYYY-MM-DD format
}
// ============================================================================
// SECTION 6: UTILITY FUNCTIONS AND NOTIFICATIONS
// ============================================================================

// Show/hide loading spinner
function showLoadingSpinner(show) {
    if (formElements.loadingSpinner) {
        formElements.loadingSpinner.style.display = show ? 'block' : 'none';
    }
    
    // Also disable/enable form submission during loading
    const submitBtn = document.querySelector('button[type="submit"]');
    if (submitBtn) {
        submitBtn.disabled = show;
        if (show) {
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Generating Document...';
        } else {
            submitBtn.innerHTML = '<i class="fas fa-file-contract me-2"></i>Generate Complete Legal Document';
        }
    }
}

// Enhanced notification system
function showNotification(message, type = 'success') {
    console.log(`📢 ${type.toUpperCase()}: ${message}`);
    
    // Remove existing notifications
    const existingNotifications = document.querySelectorAll('.popup-notification');
    existingNotifications.forEach(notification => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 300);
    });
    
    // Create new notification
    const notification = document.createElement('div');
    notification.className = `popup-notification ${type}`;
    
    const icon = getNotificationIcon(type);
    
    notification.innerHTML = `
        <div class="popup-notification-content">
            <i class="popup-notification-icon ${icon}"></i>
            <div class="popup-notification-text">${message}</div>
            <button class="popup-notification-close" onclick="this.parentElement.parentElement.remove()">
                <i class="fas fa-times"></i>
            </button>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // Show notification with animation
    setTimeout(() => notification.classList.add('show'), 100);
    
    // Auto-hide after delay (longer for errors)
    const hideDelay = type === 'error' ? 8000 : type === 'warning' ? 6000 : 5000;
    setTimeout(() => {
        if (notification.parentElement) {
            notification.classList.remove('show');
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 300);
        }
    }, hideDelay);
}

// Get notification icon based on type
function getNotificationIcon(type) {
    const icons = {
        'success': 'fas fa-check-circle',
        'error': 'fas fa-exclamation-triangle',
        'warning': 'fas fa-exclamation-circle',
        'info': 'fas fa-info-circle'
    };
    return icons[type] || icons['info'];
}

// Show error notification
function showError(message) {
    console.error(`❌ ERROR: ${message}`);
    showNotification(message, 'error');
}

// Show warning notification
function showWarning(message) {
    console.warn(`⚠️ WARNING: ${message}`);
    showNotification(message, 'warning');
}

// Show info notification
function showInfo(message) {
    console.info(`ℹ️ INFO: ${message}`);
    showNotification(message, 'info');
}

// Debounce function for API calls
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Throttle function for frequent events
function throttle(func, limit) {
    let inThrottle;
    return function() {
        const args = arguments;
        const context = this;
        if (!inThrottle) {
            func.apply(context, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
        }
    }
}

// Format currency values
function formatCurrency(amount, currency = 'USD') {
    try {
        return new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: currency
        }).format(amount);
    } catch (error) {
        return `$${amount}`;
    }
}

// Format dates for legal documents
function formatLegalDate(date) {
    if (!date) return '';
    
    try {
        const dateObj = new Date(date);
        return dateObj.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
    } catch (error) {
        return date;
    }
}

// Validate email format
function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

// Validate phone number format
function isValidPhone(phone) {
    const phoneRegex = /^[\+]?[1-9][\d]{0,15}$/;
    return phoneRegex.test(phone.replace(/[\s\-\(\)]/g, ''));
}

// Sanitize input text
function sanitizeInput(input) {
    if (typeof input !== 'string') return input;
    
    return input
        .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '')
        .replace(/<[^>]+>/g, '')
        .trim();
}

// Generate unique ID
function generateUniqueId(prefix = 'id') {
    return `${prefix}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
}

// Check if element is in viewport
function isInViewport(element) {
    const rect = element.getBoundingClientRect();
    return (
        rect.top >= 0 &&
        rect.left >= 0 &&
        rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
        rect.right <= (window.innerWidth || document.documentElement.clientWidth)
    );
}

// Smooth scroll to element
function smoothScrollTo(element, offset = 0) {
    if (!element) return;
    
    const elementPosition = element.getBoundingClientRect().top + window.pageYOffset;
    const offsetPosition = elementPosition - offset;
    
    window.scrollTo({
        top: offsetPosition,
        behavior: 'smooth'
    });
}

// Local storage helpers (with error handling)
function saveToLocalStorage(key, data) {
    try {
        localStorage.setItem(key, JSON.stringify(data));
        return true;
    } catch (error) {
        console.warn('Failed to save to localStorage:', error);
        return false;
    }
}

function loadFromLocalStorage(key, defaultValue = null) {
    try {
        const item = localStorage.getItem(key);
        return item ? JSON.parse(item) : defaultValue;
    } catch (error) {
        console.warn('Failed to load from localStorage:', error);
        return defaultValue;
    }
}

function removeFromLocalStorage(key) {
    try {
        localStorage.removeItem(key);
        return true;
    } catch (error) {
        console.warn('Failed to remove from localStorage:', error);
        return false;
    }
}

// Auto-save form data (drafts)
function autoSaveFormData() {
    if (!formElements.legalDocumentForm) return;
    
    try {
        const formData = new FormData(formElements.legalDocumentForm);
        const saveData = {
            documentType: currentSelectedDocType,
            timestamp: new Date().toISOString(),
            formFields: {}
        };
        
        // Convert FormData to object
        for (let [key, value] of formData.entries()) {
            if (value && value.trim()) {
                saveData.formFields[key] = value;
            }
        }
        
        // Only save if there's meaningful data
        if (Object.keys(saveData.formFields).length > 0) {
            saveToLocalStorage('legalease_draft', saveData);
            console.log('✅ Form data auto-saved');
        }
    } catch (error) {
        console.warn('Auto-save failed:', error);
    }
}

// Load saved form data
function loadSavedFormData() {
    const savedData = loadFromLocalStorage('legalease_draft');
    
    if (!savedData || !savedData.formFields) return false;
    
    try {
        // Check if saved data is recent (within 24 hours)
        const savedTime = new Date(savedData.timestamp);
        const now = new Date();
        const hoursDiff = (now - savedTime) / (1000 * 60 * 60);
        
        if (hoursDiff > 24) {
            removeFromLocalStorage('legalease_draft');
            return false;
        }
        
        // Ask user if they want to restore
        const restore = confirm(`Found a saved draft from ${savedTime.toLocaleString()}. Would you like to restore it?`);
        
        if (restore) {
            // Restore document type selection
            if (savedData.documentType) {
                const docTypeCard = document.querySelector(`[data-type="${savedData.documentType}"]`);
                if (docTypeCard) {
                    docTypeCard.click();
                }
            }
            
            // Restore form fields
            setTimeout(() => {
                for (const [fieldId, value] of Object.entries(savedData.formFields)) {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.value = value;
                    }
                }
                showNotification('Draft restored successfully!', 'success');
            }, 500);
            
            return true;
        }
    } catch (error) {
        console.warn('Failed to load saved data:', error);
        removeFromLocalStorage('legalease_draft');
    }
    
    return false;
}

// Clear saved draft
function clearSavedDraft() {
    removeFromLocalStorage('legalease_draft');
    console.log('✅ Saved draft cleared');
}

// Error boundary for JavaScript errors
function setupErrorBoundary() {
    window.addEventListener('error', function(event) {
        console.error('JavaScript Error:', event.error);
        
        // Don't show errors for minor issues
        if (event.error && event.error.message) {
            const message = event.error.message.toLowerCase();
            const ignoredErrors = [
                'non-error promise rejection',
                'loading css chunk',
                'network error',
                'script error'
            ];
            
            const shouldIgnore = ignoredErrors.some(ignored => message.includes(ignored));
            
            if (!shouldIgnore) {
                showError('An unexpected error occurred. Please refresh the page and try again.');
            }
        }
    });
    
    // Handle unhandled promise rejections
    window.addEventListener('unhandledrejection', function(event) {
        console.error('Unhandled Promise Rejection:', event.reason);
        
        // Don't show notification for every promise rejection
        if (event.reason && typeof event.reason === 'string' && event.reason.includes('fetch')) {
            // This is likely a network error, which is already handled elsewhere
            return;
        }
        
        showWarning('A background operation failed. Some features may not work properly.');
    });
}

// Performance monitoring
function measurePerformance(operationName, operation) {
    const startTime = performance.now();
    
    const finish = () => {
        const endTime = performance.now();
        const duration = endTime - startTime;
        console.log(`⏱️ ${operationName} took ${duration.toFixed(2)}ms`);
        
        // Log slow operations
        if (duration > 1000) {
            console.warn(`🐌 Slow operation detected: ${operationName} (${duration.toFixed(2)}ms)`);
        }
    };
    
    // Handle both sync and async operations
    try {
        const result = operation();
        
        if (result && typeof result.then === 'function') {
            // Async operation
            return result.finally(finish);
        } else {
            // Sync operation
            finish();
            return result;
        }
    } catch (error) {
        finish();
        throw error;
    }
}

// Analytics and tracking (privacy-focused)
function trackEvent(eventName, eventData = {}) {
    // Only track general usage patterns, no personal data
    try {
        const trackingData = {
            event: eventName,
            timestamp: new Date().toISOString(),
            documentType: eventData.documentType || 'unknown',
            action: eventData.action || 'unknown',
            // No personal information is tracked
        };
        
        console.log('📊 Event tracked:', trackingData);
        
        // In a real implementation, you might send this to your analytics service
        // fetch('/api/analytics', { method: 'POST', body: JSON.stringify(trackingData) });
    } catch (error) {
        // Fail silently - analytics should never break the app
        console.warn('Analytics tracking failed:', error);
    }
}

// Feature detection and fallbacks
function checkBrowserFeatures() {
    const features = {
        localStorage: typeof Storage !== 'undefined',
        fetch: typeof fetch !== 'undefined',
        promises: typeof Promise !== 'undefined',
        clipboard: navigator.clipboard && navigator.clipboard.writeText,
        serviceWorker: 'serviceWorker' in navigator
    };
    
    console.log('🔍 Browser features:', features);
    
    // Warn about missing features
    if (!features.fetch) {
        showWarning('Your browser may not support all features. Please update to a modern browser.');
    }
    
    if (!features.clipboard) {
        console.warn('Clipboard API not available, using fallback copy method');
    }
    
    return features;
}

// Initialize browser features check
const browserFeatures = checkBrowserFeatures();

// Keyboard shortcuts
function setupKeyboardShortcuts() {
    document.addEventListener('keydown', function(event) {
        // Ctrl+S or Cmd+S: Auto-save draft
        if ((event.ctrlKey || event.metaKey) && event.key === 's') {
            event.preventDefault();
            autoSaveFormData();
            showNotification('Draft saved!', 'info');
        }
        
        // Ctrl+Enter or Cmd+Enter: Submit form
        if ((event.ctrlKey || event.metaKey) && event.key === 'Enter') {
            const activeElement = document.activeElement;
            if (activeElement && (activeElement.tagName === 'TEXTAREA' || activeElement.tagName === 'INPUT')) {
                event.preventDefault();
                if (formElements.legalDocumentForm && validateForm()) {
                    generateLegalDocument();
                }
            }
        }
        
        // Escape: Close notifications
        if (event.key === 'Escape') {
            const notifications = document.querySelectorAll('.popup-notification');
            notifications.forEach(notification => notification.remove());
        }
    });
}

// Network status monitoring
function setupNetworkMonitoring() {
    function updateNetworkStatus() {
        if (navigator.onLine) {
            console.log('🌐 Network: Online');
            // Remove any offline warnings
            const offlineWarnings = document.querySelectorAll('.offline-warning');
            offlineWarnings.forEach(warning => warning.remove());
        } else {
            console.log('📴 Network: Offline');
            showWarning('You appear to be offline. Some features may not work properly.');
        }
    }
    
    window.addEventListener('online', updateNetworkStatus);
    window.addEventListener('offline', updateNetworkStatus);
    
    // Initial check
    updateNetworkStatus();
}

// Memory cleanup
function cleanup() {
    // Clear any intervals
    if (window.translationProgressInterval) {
        clearInterval(window.translationProgressInterval);
    }
    
    // Clear auto-save interval if it exists
    if (window.autoSaveInterval) {
        clearInterval(window.autoSaveInterval);
    }
    
    // Remove event listeners that might cause memory leaks
    window.removeEventListener('beforeunload', cleanup);
    
    console.log('🧹 Cleanup completed');
}

// Setup cleanup on page unload
window.addEventListener('beforeunload', cleanup);

// Initialize all utility systems
function initializeUtilities() {
    setupErrorBoundary();
    setupKeyboardShortcuts();
    setupNetworkMonitoring();
    
    // Auto-save every 30 seconds
    window.autoSaveInterval = setInterval(autoSaveFormData, 30000);
    
    // Try to load saved data after a short delay
    setTimeout(() => {
        loadSavedFormData();
    }, 1000);
    
    console.log('🔧 Utilities initialized');
}

// Show troubleshooting information when backend connection fails
function showBackendTroubleshooting() {
    const troubleshootingHTML = `
        <div class="alert alert-warning" style="margin-top: 1rem;">
            <h6><i class="fas fa-tools me-2"></i>Troubleshooting Steps:</h6>
            <ol style="margin: 0.5rem 0;">
                <li>Ensure your backend server is running (usually <code>python app.py</code>)</li>
                <li>Check if the server is accessible at <code>http://localhost:5000</code></li>
                <li>Verify the API endpoint exists: <code>/api/legalease/generate</code></li>
                <li>Check browser console (F12) for detailed error messages</li>
                <li>Check backend server logs for errors</li>
            </ol>
            <button class="btn btn-sm btn-primary" onclick="testBackendConnection(true)">
                <i class="fas fa-wifi me-1"></i>Test Backend Connection
            </button>
            <button class="btn btn-sm btn-secondary ms-2" onclick="this.parentElement.remove()">
                <i class="fas fa-times me-1"></i>Dismiss
            </button>
        </div>
    `;
    
    const resultsContainer = document.getElementById('resultsContainer') || formElements.legalDocumentForm;
    if (resultsContainer) {
        resultsContainer.insertAdjacentHTML('afterend', troubleshootingHTML);
    }
}
// ============================================================================
// SECTION 7: PRICING MODAL AND FINAL INITIALIZATION
// ============================================================================

// Pricing tier selection with enhanced animation
document.addEventListener('DOMContentLoaded', function() {
    // Initialize all systems
    initializeUtilities();
    
    // Pricing card selection in modal
    document.querySelectorAll('#upgradeModal .pricing-tier-card').forEach(card => {
        card.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Remove selected class from all pricing cards with animation
            document.querySelectorAll('#upgradeModal .pricing-tier-card').forEach(c => {
                c.classList.remove('selected');
                c.style.zIndex = '1';
            });
            
            // Add selected class to clicked card with enhanced animation
            this.classList.add('selected');
            this.style.zIndex = '10';
            
            // Update hidden input
            const selectedTierInput = document.getElementById('selectedPricingTier');
            if (selectedTierInput) {
                selectedTierInput.value = this.dataset.tier;
            }
            
            // Enable the Get button with animation
            const getButton = document.getElementById('getSelectedPlan');
            if (getButton) {
                getButton.disabled = false;
                
                // Update button text based on selection
                const tier = this.dataset.tier;
                const tierNames = {
                    'payasyougo': 'Get Pay-As-You-Go - $1',
                    '24hourpass': 'Get 24-Hour Pass - $2',
                    'pro': 'Get Pro Monthly - $15'
                };
                
                // Animate button text change
                getButton.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    getButton.innerHTML = `<i class="fas fa-shopping-cart me-2"></i>${tierNames[tier]}`;
                    getButton.style.transform = 'scale(1)';
                }, 100);
            }
        });
        
        // Add subtle hover effect enhancement
        card.addEventListener('mouseenter', function() {
            if (!this.classList.contains('selected')) {
                this.style.transform = 'translateY(-3px)';
            }
        });
        
        card.addEventListener('mouseleave', function() {
            if (!this.classList.contains('selected')) {
                this.style.transform = 'translateY(0)';
            }
        });
    });
});

// Handle Get Selected Plan button click
function handleGetSelectedPlan() {
    const getButton = document.getElementById('getSelectedPlan');
    const selectedCard = document.querySelector('#upgradeModal .pricing-tier-card.selected');
    
    if (getButton && selectedCard) {
        const url = selectedCard.dataset.url;
        
        // Add click animation
        getButton.style.transform = 'scale(0.98)';
        
        setTimeout(() => {
            // Close the modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('upgradeModal'));
            if (modal) {
                modal.hide();
            }
            
            // Redirect to Gumroad
            window.open(url, '_blank');
            
            // Track the upgrade attempt
            trackEvent('upgrade_attempt', {
                tier: selectedCard.dataset.tier,
                action: 'clicked_get_plan'
            });
        }, 150);
    }
}

// Setup Get Selected Plan button
document.addEventListener('DOMContentLoaded', function() {
    const getButton = document.getElementById('getSelectedPlan');
    if (getButton) {
        getButton.addEventListener('click', handleGetSelectedPlan);
    }
});

// Show upgrade modal function
function showUpgradeModal() {
    const upgradeModal = document.getElementById('upgradeModal');
    if (upgradeModal) {
        const modal = new bootstrap.Modal(upgradeModal);
        modal.show();
        
        // Track modal opening
        trackEvent('upgrade_modal_opened', {
            action: 'show_pricing'
        });
    }
}

// Reset modal state when closed
document.addEventListener('DOMContentLoaded', function() {
    const upgradeModal = document.getElementById('upgradeModal');
    if (upgradeModal) {
        upgradeModal.addEventListener('hidden.bs.modal', function() {
            // Remove all selections with reset animation
            document.querySelectorAll('#upgradeModal .pricing-tier-card').forEach(c => {
                c.classList.remove('selected');
                c.style.zIndex = '1';
                c.style.transform = '';
            });
            
            // Clear hidden input
            const selectedTierInput = document.getElementById('selectedPricingTier');
            if (selectedTierInput) {
                selectedTierInput.value = '';
            }
            
            // Disable and reset the Get button
            const getButton = document.getElementById('getSelectedPlan');
            if (getButton) {
                getButton.disabled = true;
                getButton.innerHTML = '<i class="fas fa-shopping-cart me-2"></i>Get Selected Plan';
                getButton.style.transform = '';
            }
        });
    }
});

// Add CSS for enhanced animations and styling
const enhancedCSS = `
@keyframes fadeInOut {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
    20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
}

.suggestion-item {
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 1px solid #e9ecef;
    background: white;
    position: relative;
    overflow: hidden;
}

.suggestion-item:hover {
    background-color: #f8f9fa;
    border-color: #14697D;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(20, 105, 125, 0.15);
}

.suggestion-item:hover::before {
    content: "Click for more info";
    position: absolute;
    top: 5px;
    right: 10px;
    font-size: 0.7rem;
    color: #14697D;
    background: #f0f8ff;
    padding: 2px 6px;
    border-radius: 3px;
    animation: fadeIn 0.3s ease-in;
}

.suggestion-item strong {
    color: #14697D;
    font-weight: 600;
}

.suggestions-list {
    background: #f8f9fa;
    border-radius: 15px;
    padding: 20px;
    margin-top: 20px;
    border: 1px solid #e9ecef;
}

.suggestions-list h6 {
    color: #14697D;
    margin-bottom: 15px;
    font-weight: 600;
}

.spinner-border-sm {
    width: 1rem;
    height: 1rem;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.rich-text-editor {
    transition: all 0.3s ease;
}

.rich-text-editor:focus {
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

.editing-toolbar .btn.active {
    background-color: #007bff;
    color: white;
    border-color: #007bff;
}

.editing-toolbar .btn:hover {
    background-color: #e9ecef;
}

.alert.position-fixed {
    animation: slideInRight 0.3s ease-out;
}

@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.offline-warning {
    position: fixed;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 9999;
    background: #ff6b6b;
    color: white;
    padding: 10px 20px;
    border-radius: 5px;
    font-size: 14px;
}

.network-status {
    position: fixed;
    bottom: 20px;
    right: 20px;
    padding: 5px 10px;
    border-radius: 15px;
    font-size: 12px;
    z-index: 1000;
}

.network-status.online {
    background: #28a745;
    color: white;
}

.network-status.offline {
    background: #dc3545;
    color: white;
}

/* Loading states */
.form-loading {
    opacity: 0.6;
    pointer-events: none;
}

.form-loading::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.8);
    z-index: 100;
}

/* Enhanced focus states for accessibility */
.document-type-card:focus,
.language-option:focus,
.pricing-tier-card:focus {
    outline: 3px solid rgba(255, 191, 35, 0.5);
    outline-offset: 2px;
}

/* Print styles for documents */
@media print {
    .no-print,
    .content-card:not(.document-preview),
    .export-options,
    .popup-notification {
        display: none !important;
    }
    
    .document-preview {
        box-shadow: none;
        border: none;
        padding: 0;
        background: white;
    }
}
`;

// Add the enhanced CSS to the document
const style = document.createElement('style');
style.textContent = enhancedCSS;
document.head.appendChild(style);

// Final initialization and startup
document.addEventListener('DOMContentLoaded', function() {
    console.log('🚀 LegalEase Professional - Complete Document Generation System');
    console.log('✅ All systems initialized and ready');
    
    // Performance measurement
    measurePerformance('LegalEase Initialization', () => {
        // Initialize all components
        // (Already done in previous sections)
        
        // Track initialization
        trackEvent('app_initialized', {
            action: 'page_loaded',
            timestamp: new Date().toISOString()
        });
        
        // Show ready message
        setTimeout(() => {
            showNotification('LegalEase Professional ready! Select a document type to begin.', 'info');
        }, 2000);
    });
});

// Global error handler for development
if (typeof window !== 'undefined') {
    window.LegalEaseDebug = {
        currentDocType: () => currentSelectedDocType,
        formElements: () => formElements,
        showNotification: showNotification,
        generateDocument: generateLegalDocument,
        testBackend: testBackendConnection,
        clearDraft: clearSavedDraft,
        performance: measurePerformance,
        version: '2.0.0 - Complete Document Generation'
    };
    
    console.log('🔧 Debug tools available: window.LegalEaseDebug');
}

// Service Worker registration (if available)
if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
        navigator.serviceWorker.register('/sw.js')
            .then(function(registration) {
                console.log('ServiceWorker registration successful');
            })
            .catch(function(err) {
                console.log('ServiceWorker registration failed');
            });
    });
}

// Final console message
console.log(`
🏛️ LEGALEASE PROFESSIONAL - COMPLETE DOCUMENT GENERATION SYSTEM
================================================================
✅ Fixed Issues:
   • Backend API integration for real AI-generated documents
   • No more template placeholders - generates complete legal documents
   • Enhanced error handling and user feedback
   • Auto-save and draft restoration
   • Professional export options
   • Comprehensive validation system

🎯 Key Features:
   • Complete legal document generation (no templates)
   • Real-time validation and error handling
   • Auto-save drafts every 30 seconds
   • Professional export to Word/PDF
   • Translation capabilities
   • Responsive design with accessibility features
   • Network status monitoring
   • Performance tracking

🔧 Developer Tools:
   • window.LegalEaseDebug - Debug utilities
   • Browser feature detection
   • Error boundary protection
   • Performance monitoring
   • Analytics tracking (privacy-focused)

Ready to generate professional legal documents!
================================================================
`);

// Initialize the enhanced LegalEase system
console.log('✅ Enhanced LegalEase Professional JavaScript loaded successfully');
console.log('🚀 Ready to generate professional legal documents with complete AI integration!');
        
    </script>
</body>
</html>